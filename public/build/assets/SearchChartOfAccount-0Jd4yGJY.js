import{r as a,a as I,j as e}from"./app-CQ-G37p-.js";import{B as W}from"./button-ymMXdPy5.js";import{I as X}from"./input-BXXA-PDa.js";import{C as G,d as J}from"./card-Bq41eL_q.js";import{B as re}from"./badge-CsIJHFj0.js";import{L as V}from"./loader-circle-i2ANfqrZ.js";import{S as ae}from"./search-B9EA-nRY.js";import{X as ne}from"./x-D2Pel9EU.js";import{F as Y}from"./file-text-vhY6aTSF.js";function xe({onChange:v,value:j,nextRef:h,accountCodeRef:N,clearable:Z=!0}){const[i,u]=a.useState({id:"",code:"",name:""}),[b,x]=a.useState(!1),[C,l]=a.useState(""),[n,y]=a.useState([]),[p,m]=a.useState(!1),[g,f]=a.useState(-1),[H,T]=a.useState(1),[E,A]=a.useState(!0),[D,M]=a.useState(!1),[w,F]=a.useState(""),L=a.useRef(null),B=a.useRef(null),S=a.useRef([]),d=a.useRef();a.useEffect(()=>{j&&u({id:j.id||"",code:j.code||"",name:j.name||""})},[j]),a.useEffect(()=>{f(-1),S.current=[]},[n]);const K=a.useCallback(t=>{if(S.current[t]&&L.current){const s=S.current[t],r=L.current;if(s){const c=s.offsetTop,o=c+s.offsetHeight,k=r.scrollTop,se=k+r.clientHeight;c<k?r.scrollTop=c-8:o>se&&(r.scrollTop=o-r.clientHeight+8)}}},[]),$=a.useCallback(t=>{var s,r;if(!p||n.length===0){t.key==="Enter"&&((s=h==null?void 0:h.current)==null||s.focus());return}switch(t.key){case"ArrowDown":t.preventDefault(),f(c=>{const o=c<n.length-1?c+1:0;return setTimeout(()=>K(o),0),o});break;case"ArrowUp":t.preventDefault(),f(c=>{const o=c>0?c-1:n.length-1;return setTimeout(()=>K(o),0),o});break;case"Enter":t.preventDefault(),g>=0&&g<n.length?(U(n[g]),console.log("Selected account:",n[g]),(r=h==null?void 0:h.current)==null||r.focus()):t.currentTarget===document.activeElement&&(t.currentTarget.placeholder==="Kode Akun"?P(i.code??""):Q(i.name??""));break;case"Escape":t.preventDefault(),m(!1),f(-1);break}},[p,n,g,i.code,i.name]),q=t=>{const s=t.target.value;u(r=>({...r,code:s})),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{O(s)},300),l("")},R=t=>{const s=t.target.value;u(r=>({...r,name:s})),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{O(s)},300),l("")},O=a.useCallback(t=>{if(t.length<2){y([]),m(!1),F(""),T(1),A(!0);return}F(t),T(1),A(!0),_(t,1,!0)},[]),_=async(t,s,r=!1)=>{r?x(!0):M(!0);try{const o=(await I.get("/admin/chart-of-account/list",{params:{search:t,children:0,page:s,limit:10}})).data.data||[];y(r?o:k=>[...k,...o]),A(o.length===10),m(o.length>0||!r&&n.length>0)}catch(c){console.error("Error fetching chart of accounts:",c),l("Failed to fetch accounts")}finally{x(!1),M(!1)}},z=a.useCallback(()=>{if(!D&&E&&w){const t=H+1;T(t),_(w,t,!1)}},[D,E,w,H]),ee=a.useCallback(t=>{const s=t.currentTarget,{scrollTop:r,scrollHeight:c,clientHeight:o}=s;c-r-o<50&&z()},[z]),P=async t=>{if(t.trim()){x(!0),l("");try{const{data:s}=await I.get(`/admin/chart-of-account/search-by-code?search=${t}`);if(s.data){const r={id:s.data.id,code:s.data.code,name:s.data.name,description:s.data.description||"",type:s.data.type||"",parent_id:s.data.parent_id||""};u(r),v(r),m(!1)}else l("Account not found")}catch(s){l("Failed to search account"),console.error(s)}finally{x(!1)}}},Q=async t=>{if(t.trim()){x(!0),l("");try{const{data:s}=await I.get(`/admin/chart-of-account/search-by-name?search=${t}`);if(s.data){const r={id:s.data.id,code:s.data.code,name:s.data.name,description:s.data.description||"",type:s.data.type||"",parent_id:s.data.parent_id||""};u(r),v(r),m(!1)}else l("Account not found")}catch(s){l("Failed to search account"),console.error(s)}finally{x(!1)}}},te=()=>{i.code?P(i.code):i.name&&Q(i.name)},U=t=>{u(t),v(t),m(!1),y([]),f(-1)};return a.useEffect(()=>{const t=s=>{B.current&&!B.current.contains(s.target)&&(m(!1),f(-1))};if(p)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[p]),a.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),e.jsxs("div",{className:"space-y-3",ref:B,children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-0 border rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-ring",children:[e.jsx("div",{className:"flex-1",children:e.jsx(X,{className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kode Akun",ref:N,value:i.code,onChange:q,onKeyDown:$})}),e.jsx(W,{variant:"ghost",size:"sm",className:"rounded-none border-l border-r px-3",onClick:te,disabled:b,children:b?e.jsx(V,{className:"h-4 w-4 animate-spin"}):e.jsx(ae,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-[3]",children:e.jsx(X,{className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nama Akun",value:i.name,onChange:R,onKeyDown:$})}),Z&&e.jsx(W,{variant:"ghost",className:"rounded-none px-3 h-full",onClick:()=>{var t;u({id:"",code:"",name:""}),v({id:"",code:"",name:""}),l(""),(t=N==null?void 0:N.current)==null||t.focus()},children:e.jsx(ne,{className:"h-4 w-4"})})]}),p&&e.jsx(G,{className:"absolute top-full left-0 right-0 z-[9999] mt-1 shadow-xl border-2",children:e.jsx(J,{className:"p-0",children:e.jsx("div",{ref:L,className:"max-h-64 overflow-y-auto overscroll-contain",onScroll:ee,style:{scrollbarWidth:"thin",scrollbarColor:"#cbd5e1 #f1f5f9"},children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 px-2 sticky top-0 bg-white",children:["Chart of Accounts (",w,") - ",n.length," accounts"]}),n.map((t,s)=>e.jsxs("div",{ref:r=>S.current[s]=r,className:`flex items-center justify-between p-3 rounded-md cursor-pointer transition-colors ${g===s?"bg-primary/10 border border-primary/20":"hover:bg-accent"}`,onClick:()=>U(t),onMouseEnter:()=>f(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-md",children:e.jsx(Y,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:t.name}),e.jsx("div",{className:"text-xs text-muted-foreground flex gap-2",children:e.jsx("span",{children:t.code})})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm font-medium",children:t.code})})]},`${t.id}-${s}`)),D&&e.jsxs("div",{className:"flex items-center justify-center p-4 bg-gray-50",children:[e.jsx(V,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more accounts..."})]}),!E&&n.length>0&&e.jsxs("div",{className:"text-center p-4 text-xs text-muted-foreground bg-gray-50 border-t",children:["✅ All accounts loaded (",n.length," total)"]}),n.length===0&&!b&&e.jsx("div",{className:"text-center p-4 text-sm text-muted-foreground",children:"No accounts found"})]})})})}),C&&e.jsx("div",{className:"text-sm text-destructive mt-2 p-2 bg-destructive/10 rounded-md",children:C}),i.id&&!b&&!C&&e.jsx(G,{className:"mt-3",children:e.jsx(J,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-md",children:e.jsx(Y,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.name}),e.jsx("div",{className:"text-sm text-muted-foreground flex gap-2",children:e.jsx("span",{children:i.code})})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(re,{variant:"secondary",className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Account"})})]})})})]}),p&&n.length>0&&e.jsx("div",{className:"text-xs text-muted-foreground bg-muted/50 p-2 rounded-md",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("span",{children:"↑↓ Navigate"}),e.jsx("span",{children:"Enter Select"}),e.jsx("span",{children:"Esc Close"})]})})]})}export{xe as S};
