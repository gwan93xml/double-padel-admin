import{r,a as I,j as e}from"./app-CQ-G37p-.js";import{A as T}from"./AuthenticatedLayout-X6euxa7E.js";import{I as C}from"./input-BXXA-PDa.js";import{B as j}from"./button-ymMXdPy5.js";import{D as z,a as P,b as R,c as A}from"./dialog-CBBIkam9.js";import{t as M}from"./use-toast-XJEkqv7A.js";import{c as $}from"./can-DARgw7Bo.js";import{S as G}from"./search-B9EA-nRY.js";import{a as J}from"./createLucideIcon-iWXofaGH.js";import{S as E}from"./square-pen-Pz9x-bS-.js";import{S as K}from"./save-CHEDKyco.js";import{X as O}from"./x-D2Pel9EU.js";import"./index-D0iIn24t.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./moment-C5S46NFB.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=J("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);function W({warehouses:n}){const[k,h]=r.useState([]),[U,N]=r.useState(1),[o,F]=r.useState(""),[b,v]=r.useState(!1),[u,y]=r.useState(!0),[D,c]=r.useState(!1),[i,x]=r.useState(null),[m,p]=r.useState(""),[f,S]=r.useState(!1),w=r.useRef(null),q=$("update-item-stock");r.useEffect(()=>{g(1,o,!0)},[o]);const g=async(a,t,s=!1)=>{if(s&&y(!0),v(!0),!(!u&&!s))try{const l=await I.get("/admin/item-stock/list",{params:{page:a,search:t}});h(s?l.data.data:d=>[...d,...l.data.data]),y(l.data.next_page_url!==null)}finally{v(!1)}},_=()=>{const a=w.current;a&&a.scrollTop+a.clientHeight>=a.scrollHeight-200&&!b&&N(t=>{const s=t+1;return g(s,o),s})},L=(a,t,s)=>{q&&(x({itemId:a.id,itemCode:a.code,itemName:a.name,warehouseId:t.id,warehouseName:t.name,currentQuantity:s}),p(s.toString()),c(!0))},B=async()=>{if(i){S(!0);try{(await I.post("/admin/item-stock/update",{item_id:i.itemId,warehouse_id:i.warehouseId,quantity:parseFloat(m)})).data.success&&(h(t=>t.map(s=>{if(s.id===i.itemId){const l=s.warehouses.map(d=>d.id===i.warehouseId?{...d,quantity:parseFloat(m)}:d);return{...s,warehouses:l}}return s})),M({title:"Berhasil",description:"Stok berhasil diupdate"}),c(!1),x(null),p(""))}catch{M({title:"Error",description:"Gagal mengupdate stok",variant:"destructive"})}finally{S(!1)}}},H=()=>{c(!1),x(null),p("")};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Sisa Stok"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(C,{placeholder:"Cari kode/nama item",value:o,onChange:a=>{F(a.target.value),N(1)}}),e.jsx(j,{onClick:()=>g(1,o,!0),children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"overflow-x-auto",ref:w,onScroll:_,style:{maxHeight:"80vh"},children:[e.jsxs("div",{className:"grid",style:{gridTemplateColumns:`150px 200px 120px repeat(${n.length},150px)`,minWidth:"1200px"},children:[e.jsx("div",{className:"sticky left-0 top-0 z-30 border p-2 shadow-sm",children:"Kode"}),e.jsx("div",{className:"sticky left-[150px] top-0 z-30 border p-2 shadow-sm",children:"Nama"}),e.jsx("div",{className:"sticky left-[350px] top-0 z-30 border p-2 shadow-sm",children:"Stok Total"}),n.map(a=>e.jsx("div",{className:"sticky top-0 z-20 border p-2 font-bold text-center  shadow-sm",children:a.name},a.id)),k.map((a,t)=>a.is_linked?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky left-0 border p-2",children:a.code},`c-${t}`),e.jsx("div",{className:"sticky left-[150px] border p-2",children:a.name},`n-${t}`),e.jsx("div",{className:"sticky left-[350px] border p-2",style:{gridColumn:`3 / span ${n.length+1}`},children:e.jsxs("div",{className:"flex text-xs gap-x-1 text-blue-800 font-semibold",children:[e.jsx(Q,{}),e.jsxs("div",{children:[a.linked_item.code," ",a.linked_item.name]})]})},`s-${t}`)]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky left-0 border p-2",children:a.code},`c-${t}`),e.jsx("div",{className:"sticky left-[150px] border p-2",children:a.name},`n-${t}`),e.jsx("div",{className:"sticky left-[350px] border p-2",children:a.stock},`s-${t}`),a.warehouses.map((s,l)=>e.jsx("div",{className:"border p-2 text-right whitespace-nowrap hover:bg-blue-50 dark:hover:bg-blue-950 cursor-pointer transition-colors group",onClick:()=>L(a,n[l],s.quantity),title:"Klik untuk edit stok",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{children:s.quantity}),$("update-item-stock")&&e.jsx(E,{className:"h-3 w-3 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})},`w-${t}-${l}`))]}))]}),b&&u&&e.jsx("div",{className:"text-center py-4",children:"Memuat data..."}),!u&&k.length>0&&e.jsx("div",{className:"text-center py-4",children:"Tidak ada data lagi"})]}),e.jsx(z,{open:D,onOpenChange:c,children:e.jsxs(P,{className:"sm:max-w-md",children:[e.jsx(R,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Edit Stok"]})}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Item:"}),e.jsxs("div",{className:"text-sm bg-gray-50 p-2 rounded",children:[e.jsx("div",{className:"font-semibold",children:i.itemCode}),e.jsx("div",{className:"text-gray-600",children:i.itemName})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Gudang:"}),e.jsx("div",{className:"text-sm bg-gray-50 p-2 rounded font-semibold",children:i.warehouseName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Stok Saat Ini: ",e.jsx("span",{className:"font-semibold text-blue-600",children:i.currentQuantity})]}),e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Stok Baru:"}),e.jsx(C,{type:"number",value:m,onChange:a=>p(a.target.value),placeholder:"Masukkan jumlah stok baru",className:"w-full",step:"0.01",autoFocus:!0}),e.jsxs("div",{className:"text-xs text-gray-500 bg-yellow-50 p-2 rounded",children:[e.jsx("strong",{children:"Info:"})," Sistem menggunakan metode FIFO otomatis.",e.jsx("br",{}),"• Jika kurangi stok: batch lama akan dikurangi terlebih dahulu",e.jsx("br",{}),"• Jika tambah stok: batch baru akan dibuat dengan harga terakhir"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(j,{onClick:B,disabled:f||!m,className:"flex-1",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Simpan"]})}),e.jsxs(j,{variant:"outline",onClick:H,disabled:f,className:"flex-1",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Batal"]})]})]})]})})]})}W.layout=n=>e.jsx(T,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Laporan",href:"#"},{label:"Sisa Stok",href:"#"}],children:n});export{W as default};
