import{r,j as e,a as ee}from"./app-CQ-G37p-.js";import{B as C}from"./button-ymMXdPy5.js";import{T as es,a as ss,b as U,c as W,d as as,e as Y}from"./table-BSdxGOLt.js";import{I as Z}from"./input-BXXA-PDa.js";import{S as ts,a as rs,b as ls,c as ns,d as fe}from"./select-BSIJzAmS.js";import{C as $e,d as Ee,a as Re,b as ze,c as Be}from"./card-Bq41eL_q.js";import{B as O}from"./badge-CsIJHFj0.js";import{C as Es,a as is,e as ue,E as Ke,f as As,g as Ts,h as Fs,D as ie}from"./AuthenticatedLayout-X6euxa7E.js";import{h as P}from"./moment-C5S46NFB.js";import{s as qe,P as Is}from"./promise-alert-dialog-DMOGPPD8.js";import{D as pe,f as Os,a as ye,b as be,c as Ne,e as cs,d as Ys}from"./dialog-CBBIkam9.js";import{u as Ps,t as Ls}from"./use-toast-XJEkqv7A.js";import{F as V}from"./form-group-CHZXn8bM.js";import{S as Js}from"./SearchDivision-Budjprvk.js";import{H as Ae,S as Hs}from"./scroll-area-Db0TZtic.js";import{C as Ge}from"./chevron-right-DWL5tPD-.js";import{C as We}from"./chevron-down-BOk5s691.js";import{C as Qe}from"./circle-alert-DNqBTniX.js";import{C as Rs}from"./calendar-BV_-Gsoc.js";import{U as zs}from"./user-K2wipGb8.js";import{E as Bs}from"./eye-DwuHDobg.js";import{F as ds}from"./file-text-vhY6aTSF.js";import{C as Ks}from"./circle-check-big-DDOzmUMH.js";import{T as Fe}from"./trash-2-CvcuuDsN.js";import{S as os}from"./square-pen-Pz9x-bS-.js";import{P as ms}from"./plus-gEoqNGty.js";import{T as qs}from"./textarea-BvykTLwI.js";import{C as je}from"./currency-formatter-D5vTOkIG.js";import{L as Ie}from"./loader-circle-i2ANfqrZ.js";import{a as se}from"./createLucideIcon-iWXofaGH.js";import{F as Xe}from"./filter-BZN7rDIQ.js";import{S as Gs}from"./search-B9EA-nRY.js";import{D as Ws}from"./download-o5rqL5cq.js";import{E as Ze}from"./external-link-BJRrkVwF.js";import{L as Qs}from"./list-DIayZXqH.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=se("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=se("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=se("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=se("Logs",[["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M3 12h1",key:"lp3yf2"}],["path",{d:"M3 18h1",key:"1eiwyy"}],["path",{d:"M3 6h1",key:"rgxa97"}],["path",{d:"M8 12h1",key:"1con00"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M8 6h1",key:"tn6mkg"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=se("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=se("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function Us({onChange:x,value:t,nextRef:h,clearable:f=!1}){const[k,n]=r.useState([]),[S,c]=r.useState(!1),[w,m]=r.useState("");r.useEffect(()=>{(async()=>{c(!0),m("");try{const{data:u}=await ee.get("/admin/asset-type/list",{params:{take:1e3}}),D=u.data||[];n(D)}catch(u){console.error("Error fetching asset types:",u),m("Failed to fetch asset types"),n([])}finally{c(!1)}})()},[]);const y=p=>{if(p==="clear"&&f){x({id:"",name:"",description:""});return}const u=k.find(D=>D.id===p);u&&(x(u),h!=null&&h.current&&h.current.focus())},$=()=>!t||!t.id?"":t.id;return w?e.jsx("div",{className:"text-sm text-red-600 p-2 border border-red-200 rounded",children:w}):e.jsxs(ts,{value:$(),onValueChange:y,disabled:S,children:[e.jsx(rs,{children:e.jsx(ls,{placeholder:S?"Loading...":"Pilih jenis asset"})}),e.jsxs(ns,{children:[f&&e.jsx(fe,{value:"clear",children:e.jsx("span",{className:"text-gray-500",children:"Semua Tipe Aset"})}),k.map(p=>e.jsx(fe,{value:p.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:p.name}),p.description&&e.jsx("span",{className:"text-sm text-gray-500",children:p.description})]})},p.id))]})]})}const ea=({auditableType:x,auditableId:t,trigger:h,title:f="Riwayat Perubahan",description:k="Lihat semua perubahan yang telah dilakukan pada data ini"})=>{const[n,S]=r.useState(!1),[c,w]=r.useState([]),[m,y]=r.useState(!1),[$,p]=r.useState(null),[u,D]=r.useState(new Set),ae=async()=>{var a,o;y(!0),p(null);try{const v=await ee.get("/admin/audits",{params:{auditable_type:x,auditable_id:t}});w(v.data.data||[])}catch(v){p(((o=(a=v.response)==null?void 0:a.data)==null?void 0:o.message)||"Gagal memuat audit logs"),console.error("Error fetching audit logs:",v)}finally{y(!1)}};r.useEffect(()=>{n&&(ae(),D(new Set))},[n,x,t]);const te=a=>{switch(a){case"created":return e.jsx(ms,{className:"h-4 w-4 text-green-600"});case"updated":return e.jsx(os,{className:"h-4 w-4 text-blue-600"});case"deleted":return e.jsx(Fe,{className:"h-4 w-4 text-red-600"});case"restored":return e.jsx(Ks,{className:"h-4 w-4 text-green-600"});default:return e.jsx(ds,{className:"h-4 w-4 text-gray-600"})}},re=a=>{switch(a){case"created":return"bg-green-50 text-green-700 border-green-200";case"updated":return"bg-blue-50 text-blue-700 border-blue-200";case"deleted":return"bg-red-50 text-red-700 border-red-200";case"restored":return"bg-green-50 text-green-700 border-green-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},g=a=>a.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),b=a=>a==null?"-":typeof a=="boolean"?a?"Ya":"Tidak":typeof a=="object"?JSON.stringify(a,null,2):typeof a=="string"&&/^\d{4}-\d{2}-\d{2}/.test(a)?P(a).format("DD/MM/YYYY HH:mm"):String(a),E=()=>{u.size===c.length?D(new Set):D(new Set(c.map(a=>a.id)))},N=(a,o)=>{const v=new Set([...Object.keys(a||{}),...Object.keys(o||{})]);let _=0;return v.forEach(J=>{const z=a==null?void 0:a[J],X=o==null?void 0:o[J];JSON.stringify(z)!==JSON.stringify(X)&&_++}),_},R=a=>{D(o=>{const v=new Set(o);return v.has(a)?v.delete(a):v.add(a),v})},Q=(a,o)=>{const v=new Set([...Object.keys(a||{}),...Object.keys(o||{})]);return Array.from(v).map(_=>{const J=a==null?void 0:a[_],z=o==null?void 0:o[_];return JSON.stringify(J)!==JSON.stringify(z)?e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-sm text-gray-700 mb-2",children:g(_)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-red-600 font-medium mb-1",children:"Sebelum:"}),e.jsx("div",{className:"text-sm text-gray-600 bg-red-50 p-2 rounded border",children:b(J)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-green-600 font-medium mb-1",children:"Sesudah:"}),e.jsx("div",{className:"text-sm text-gray-600 bg-green-50 p-2 rounded border",children:b(z)})]})]})]},_):null}).filter(Boolean)},L=e.jsxs(C,{variant:"outline",size:"sm",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Riwayat"]});return e.jsxs(pe,{open:n,onOpenChange:S,children:[e.jsx(Os,{asChild:!0,children:h||L}),e.jsxs(ye,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),f]}),e.jsx(cs,{children:k})]}),!m&&!$&&c.length>0&&e.jsx(C,{variant:"outline",size:"sm",onClick:E,className:"ml-4",children:u.size===c.length?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Collapse All"]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Expand All"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[m&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Memuat riwayat..."})]}),$&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[e.jsx(Qe,{className:"h-5 w-5"}),$]}),!m&&!$&&c.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(Ae,{className:"h-12 w-12 mb-4 text-gray-300"}),e.jsx("p",{children:"Tidak ada riwayat perubahan"})]}),!m&&!$&&c.length>0&&e.jsxs(Hs,{className:"h-[60vh] pr-4",children:[e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-blue-700 font-medium",children:["ðŸ“Š Total ",c.length," riwayat perubahan"]}),e.jsxs("span",{className:"text-blue-600",children:[c.filter(a=>a.old_values||a.new_values).length," dengan detail perubahan"]})]})}),e.jsx("div",{className:"space-y-4",children:c.map((a,o)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[te(a.event),e.jsxs("div",{children:[e.jsx(O,{variant:"outline",className:re(a.event),children:a.event.toUpperCase()}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[a.auditable_type," #",a.auditable_id]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"h-4 w-4"}),P(a.created_at).format("DD/MM/YYYY")]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Es,{className:"h-4 w-4"}),P(a.created_at).format("HH:mm:ss")]})]})]}),a.user&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-2 bg-blue-50 rounded-lg",children:[e.jsx(zs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:a.user.name}),e.jsxs("span",{className:"text-sm text-blue-600",children:["(",a.user.email,")"]})]}),a.event==="deleted"&&a.delete_reason&&e.jsxs("div",{className:"flex items-start gap-2 mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Qe,{className:"h-4 w-4 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-red-700 mb-1",children:"Alasan Penghapusan:"}),e.jsx("div",{className:"text-sm text-red-600",children:a.delete_reason})]})]}),(a.old_values||a.new_values)&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{onClick:()=>R(a.id),className:"flex items-center gap-2 w-full text-left p-2 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[u.has(a.id)?e.jsx(We,{className:"h-4 w-4 text-gray-600"}):e.jsx(Ge,{className:"h-4 w-4 text-gray-600"}),e.jsx(Bs,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Perubahan Data"}),e.jsxs(O,{variant:"secondary",className:"ml-auto text-xs",children:[N(a.old_values||{},a.new_values||{})," perubahan"]})]}),u.has(a.id)&&e.jsx("div",{className:"mt-2 max-h-60 overflow-y-auto transition-all duration-300 ease-in-out",children:Q(a.old_values||{},a.new_values||{})})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["IP: ",a.ip_address]}),a.tags&&e.jsxs("div",{children:["Tag: ",a.tags]})]}),o<c.length-1&&e.jsx(is,{className:"mt-4"})]},a.id))})]})]})]})]})};let xs;function sa(){const[x,t]=r.useState(!1),[h,f]=r.useState(),[k,n]=r.useState({title:"",description:"",cancelText:"Cancel",confirmText:"Confirm"}),[S,c]=r.useState("");xs=m=>(n(m),c(""),t(!0),new Promise(y=>{f(()=>y)}));const w=m=>{t(!1),h==null||h({confirmed:m,reason:m?S:void 0})};return e.jsx(pe,{open:x,onOpenChange:t,children:e.jsxs(ye,{children:[e.jsxs(be,{children:[e.jsx(Ne,{children:k.title}),e.jsx(cs,{children:k.description})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Alasan"}),e.jsx(qs,{className:"w-full rounded-md border p-2 text-sm",value:S,onChange:m=>c(m.target.value),placeholder:"Tulis alasan di sini..."})]}),e.jsxs(Ys,{children:[e.jsx(C,{type:"button",variant:"ghost",onClick:()=>w(!1),children:k.cancelText}),e.jsx(C,{type:"button",variant:"destructive",onClick:()=>w(!0),disabled:!S.trim(),children:k.confirmText})]})]})})}const aa=()=>{const[x,t]=r.useState(!1),[h,f]=r.useState(),[k,n]=r.useState();return{isOpen:x,transactionId:h,transactionType:k,showJournal:(m,y)=>{f(m),n(y),t(!0)},hideJournal:()=>{t(!1),setTimeout(()=>{f(void 0),n(void 0)},300)},toggleJournal:()=>{t(!x)}}};function ta({open:x,onOpenChange:t,transactionId:h,transactionType:f,title:k="Detail Jurnal"}){const[n,S]=r.useState(null),[c,w]=r.useState(!1),[m,y]=r.useState(null),{toast:$}=Ps();r.useEffect(()=>{x&&h&&f&&p()},[x,h,f]),r.useEffect(()=>{x||(S(null),y(null))},[x]);const p=async()=>{var g;w(!0),y(null);try{const b=await ee.get("/admin/journal/find-by-transaction",{params:{transaction_id:h,transaction_type:f}});S(b.data.data)}catch(b){console.error("Error fetching journal:",b),((g=b.response)==null?void 0:g.status)===404?y("Jurnal tidak ditemukan untuk transaksi ini."):(y("Gagal memuat data jurnal. Silakan coba lagi."),$({variant:"destructive",title:"Error",description:"Gagal memuat data jurnal"}))}finally{w(!1)}},u=()=>{var g;return((g=n==null?void 0:n.transactions)==null?void 0:g.reduce((b,E)=>b+E.debit,0))||0},D=()=>{var g;return((g=n==null?void 0:n.transactions)==null?void 0:g.reduce((b,E)=>b+E.credit,0))||0},ae=()=>e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(Ie,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{children:"Memuat data jurnal..."})]}),te=()=>e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-red-500 mb-2",children:m}),e.jsx("button",{onClick:p,className:"text-blue-500 hover:text-blue-700 underline",children:"Coba lagi"})]}),re=()=>{var g,b,E;return n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold text-sm text-gray-600",children:"Nomor Jurnal:"}),e.jsx("p",{className:"font-mono",children:n.number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold text-sm text-gray-600",children:"Tanggal:"}),e.jsx("p",{children:P(n.date).format("DD MMMM YYYY")})]}),n.division&&e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold text-sm text-gray-600",children:"Divisi:"}),e.jsxs("p",{children:[((g=n.division)==null?void 0:g.code)??""," - ",((b=n.division)==null?void 0:b.name)??""]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold text-sm text-gray-600",children:"Keterangan:"}),e.jsx("p",{children:n.notes})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Detail Transaksi"}),e.jsxs(es,{children:[e.jsx(ss,{children:e.jsxs(U,{children:[e.jsx(W,{children:"Akun"}),e.jsx(W,{children:"Catatan"}),e.jsx(W,{className:"text-right",children:"Debit"}),e.jsx(W,{className:"text-right",children:"Kredit"})]})}),e.jsx(as,{children:(E=n.transactions)==null?void 0:E.map(N=>{var R,Q;return e.jsxs(U,{className:`${N.journal_id!==n.id?"bg-yellow-50":""}`,children:[e.jsx(Y,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((R=N.chart_of_account)==null?void 0:R.code)??""}),e.jsx("div",{className:"text-sm text-gray-500",children:((Q=N.chart_of_account)==null?void 0:Q.name)??""})]})}),e.jsx(Y,{children:N.notes}),e.jsx(Y,{className:"text-right",children:N.debit>0&&e.jsx(je,{amount:N.debit})}),e.jsx(Y,{className:"text-right",children:N.credit>0&&e.jsx(je,{amount:N.credit})})]},N.id)})})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Total:"}),e.jsxs("div",{className:"flex space-x-8",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Debit"}),e.jsx("div",{className:"font-semibold",children:e.jsx(je,{amount:u()})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Kredit"}),e.jsx("div",{className:"font-semibold",children:e.jsx(je,{amount:D()})})]})]})]})})]}):null};return e.jsx(pe,{open:x,onOpenChange:t,children:e.jsxs(ye,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(be,{children:e.jsxs(Ne,{children:[k,f&&h&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",f," #",h,")"]})]})}),e.jsxs("div",{className:"mt-4",children:[c&&ae(),m&&!c&&te(),n&&!c&&!m&&re()]})]})})}function Ja({columns:x,apiUrl:t,refreshTrigger:h,canCreate:f=!1,canUpdate:k=!1,canDelete:n=!1,onCreate:S,onEdit:c,onDelete:w,onDetail:m,onExport:y,onPrint:$,onPrintDelivery:p,isFilterDate:u,isFilterDivision:D,canForceDelete:ae=!1,title:te="Data Management",description:re="Manage your data with advanced filtering and actions",additionalFilters:g=[],withReason:b=!1,auditableType:E,transactionType:N,additionalActionButtons:R}){const Q=()=>{Object.keys(localStorage).forEach(i=>{i.startsWith(`${t}.`)&&localStorage.removeItem(i)})},[L,a]=r.useState([]),[o,v]=r.useState(!1),[_,J]=r.useState(!1),[z,X]=r.useState(null);r.useState([]);const[T,ve]=r.useState(null),[H,ce]=r.useState("asc"),[F,ke]=r.useState(""),[le,de]=r.useState(!0),[hs,ne]=r.useState(1),[Oe,gs]=r.useState(0),[Ye,Se]=r.useState(!1),[us,Pe]=r.useState(""),[B,we]=r.useState(null),[K,Ce]=r.useState(null),[I,De]=r.useState({id:"",code:"",name:""}),[M,_e]=r.useState({}),[js,fs]=r.useState({}),[oe,Me]=r.useState(!1),[me,Le]=r.useState(!1),{isOpen:ps,hideJournal:ys,showJournal:bs}=aa(),[Ns,vs]=r.useState();r.useEffect(()=>{(()=>{const i=localStorage.getItem(`${t}.startDate`),d=localStorage.getItem(`${t}.endDate`);i&&we(i),d&&Ce(d);const l=localStorage.getItem(`${t}.searchTerm`);l&&ke(l);const j=localStorage.getItem(`${t}.division`);if(j)try{const G=JSON.parse(j);De(G)}catch(G){console.error("Error parsing stored division:",G)}const A=localStorage.getItem(`${t}.additionalFilters`);if(A)try{const G=JSON.parse(A);_e(G)}catch(G){console.error("Error parsing stored additional filters:",G)}const He=localStorage.getItem(`${t}.sortColumn`),ge=localStorage.getItem(`${t}.sortOrder`);He&&ve(He),ge&&(ge==="asc"||ge==="desc")&&ce(ge),localStorage.getItem(`${t}.showFilters`)==="true"&&Me(!0),Le(!0)})()},[t]),r.useEffect(()=>{const s=async()=>{const i=g.filter(j=>j.apiUrl).map(async j=>{try{const A=await ee.get(j.apiUrl);return{key:j.key,options:A.data}}catch(A){return console.error(`Error loading options for ${j.key}:`,A),{key:j.key,options:[]}}}),d=await Promise.all(i),l={};d.forEach(j=>{l[j.key]=j.options}),fs(l)};g.length>0&&s()},[g]),r.useEffect(()=>{B?localStorage.setItem(`${t}.startDate`,B.toString()):localStorage.removeItem(`${t}.startDate`)},[B,t]),r.useEffect(()=>{K?localStorage.setItem(`${t}.endDate`,K.toString()):localStorage.removeItem(`${t}.endDate`)},[K,t]),r.useEffect(()=>{F?localStorage.setItem(`${t}.searchTerm`,F):localStorage.removeItem(`${t}.searchTerm`)},[F,t]),r.useEffect(()=>{I.id||I.code||I.name?localStorage.setItem(`${t}.division`,JSON.stringify(I)):localStorage.removeItem(`${t}.division`)},[I,t]),r.useEffect(()=>{Object.values(M).some(i=>i!==""&&i!==null&&i!==void 0&&i!=="all")?localStorage.setItem(`${t}.additionalFilters`,JSON.stringify(M)):localStorage.removeItem(`${t}.additionalFilters`)},[M,t]),r.useEffect(()=>{T?localStorage.setItem(`${t}.sortColumn`,T):localStorage.removeItem(`${t}.sortColumn`)},[T,t]),r.useEffect(()=>{localStorage.setItem(`${t}.sortOrder`,H)},[H,t]),r.useEffect(()=>{localStorage.setItem(`${t}.showFilters`,oe.toString())},[oe,t]);const xe=r.useRef(),ks=r.useCallback(s=>{o||_||(xe.current&&xe.current.disconnect(),xe.current=new IntersectionObserver(i=>{i[0].isIntersecting&&le&&Ss()}),s&&xe.current.observe(s))},[o,_,le]);r.useEffect(()=>{me&&(a([]),ne(1),de(!0),he(!0))},[t,T,H,F,h,B,K,I.id,M,me]),r.useEffect(()=>{me&&(a([]),ne(1),de(!0),he(!0))},[me]);const he=async(s=!1)=>{s?v(!0):J(!0),X(null);try{const i=s?1:hs,d=new URLSearchParams({take:"50",page:i.toString(),sort:T||"",order:H,search:F,division_id:D&&I.id?I.id:"",start_date:u&&B?P(B).format("YYYY-MM-DD"):"",end_date:u&&K?P(K).format("YYYY-MM-DD"):""});Object.entries(M).forEach(([j,A])=>{A!=null&&A!==""&&d.append(j,A.toString())});const{data:l}=await ee.get(`${t}/list?${d}`);a(s?l.data:j=>[...j,...l.data]),gs(l.total),de(l.current_page<l.last_page),ne(s?2:j=>j+1)}catch{X("An error occurred while fetching data")}finally{v(!1),J(!1)}},Ss=()=>{!_&&le&&he(!1)},ws=s=>{T===s?ce(H==="asc"?"desc":"asc"):(ve(s),ce("asc"))},Cs=s=>{ke(s.target.value)},Ds=s=>T!==s?e.jsx(Ve,{className:"ml-2 h-4 w-4 text-gray-400"}):H==="asc"?e.jsx(Zs,{className:"ml-2 h-4 w-4 text-blue-600"}):H==="desc"?e.jsx(Xs,{className:"ml-2 h-4 w-4 text-blue-600"}):e.jsx(Ve,{className:"ml-2 h-4 w-4 text-gray-400"}),Je=()=>{a([]),ne(1),de(!0),he(!0)},_s=()=>{ke(""),De({id:"",code:"",name:""}),we(null),Ce(null),ve(null),ce("asc"),_e({}),Me(!1),Q(),localStorage.setItem(`${t}.sortOrder`,"asc"),localStorage.setItem(`${t}.showFilters`,"false"),Le(!0)},q=(s,i)=>{_e(d=>({...d,[s]:i}))},Ms=s=>{const i=s.type==="select"?M[s.key]||"all":M[s.key]||"";switch(s.type){case"select":const d=s.options||js[s.key]||[];return e.jsx(V,{label:s.label,children:e.jsxs(ts,{value:i,onValueChange:l=>q(s.key,l==="all"?"":l),children:[e.jsx(rs,{children:e.jsx(ls,{placeholder:s.placeholder||`Pilih ${s.label}`})}),e.jsxs(ns,{children:[e.jsx(fe,{value:"all",children:s.placeholder||`All ${s.label}`}),d.map(l=>e.jsx(fe,{value:l.value??"",children:l.label},l.value))]})]})},s.key);case"input":return e.jsx(V,{label:s.label,children:e.jsx(Z,{placeholder:s.placeholder||`Enter ${s.label}`,value:i,onChange:l=>q(s.key,l.target.value)})},s.key);case"number":return e.jsx(V,{label:s.label,children:e.jsx(Z,{type:"number",placeholder:s.placeholder||`Enter ${s.label}`,value:i,onChange:l=>q(s.key,l.target.value)})},s.key);case"date":return e.jsx(V,{label:s.label,children:e.jsx(Z,{type:"date",value:i,onChange:l=>q(s.key,l.target.value)})},s.key);case"select-asset-type":return e.jsx(V,{label:s.label,children:e.jsx(Us,{value:M[s.key]?{id:M[s.key],name:M[s.key+"_name"]||"",description:M[s.key+"_description"]||""}:void 0,onChange:l=>{q(s.key,l.id),q(s.key+"_name",l.name),q(s.key+"_description",l.description)},clearable:!0})},s.key);default:return null}};function $s(s){qe({title:"Apakah Anda yakin?",description:"Tindakan ini tidak dapat dibatalkan. Ini akan menghapus data Anda secara permanen.",cancelText:"Batal",confirmText:"Ya, Hapus data"}).then(async i=>{if(i)try{await ee.delete(`${t}/${s}/force-delete`),a(d=>d.filter(l=>l.id!==s)),Ls({title:"Data berhasil dihapus",description:"Data telah dihapus secara permanen."})}catch{X("An error occurred while deleting the data")}})}return z?e.jsx($e,{className:"border-red-200 dark:border-red-800",children:e.jsxs(Ee,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx(ue,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-100 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 text-center mb-4",children:z}),e.jsxs(C,{onClick:Je,variant:"outline",className:"border-red-200 text-red-700 hover:bg-red-50 bg-transparent",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6 p-4 md:p-6 min-h-screen",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2  rounded-lg",children:e.jsx(ue,{className:"h-6 w-6 "})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:te}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:re})]})]})}),e.jsxs($e,{className:"shadow-lg  ",children:[e.jsxs(Re,{className:"border-b",children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"Filters & Actions"]}),e.jsx(Be,{className:"",children:"Search, filter, and manage your data"})]}),e.jsx(Ee,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Search Data"}),e.jsxs("div",{className:"relative",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Z,{placeholder:"Search records...",value:F,onChange:Cs,className:"pl-10 bg-white dark:bg-black"})]})]}),D&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"lg:col-span-5",children:e.jsx(V,{label:"Divisi",children:e.jsx(Js,{onChange:s=>{De(s)},value:I,clearable:!0})})})}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Start Date"}),e.jsx(Z,{type:"date",value:B??"",onChange:s=>we(s.target.value),className:""})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"End Date"}),e.jsx(Z,{type:"date",value:K??"",onChange:s=>Ce(s.target.value),className:""})]})]}),g.length>0&&e.jsxs("div",{className:"lg:col-span-12",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>Me(!oe),className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Additional Filters",e.jsx(O,{variant:"secondary",className:"ml-1",children:Object.values(M).filter(s=>s!==""&&s!==null&&s!==void 0&&s!=="all").length})]})}),oe&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4  rounded-lg border",children:g.map(s=>Ms(s))})]}),e.jsxs("div",{className:`${u?"lg:col-span-4":"lg:col-span-8"} flex gap-2`,children:[e.jsxs(C,{variant:"secondary",onClick:_s,children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Clear"]}),y&&e.jsxs(C,{variant:"outline",onClick:y,children:[e.jsx(Ws,{className:"h-4 w-4 mr-2"}),"Export"]}),f?e.jsxs(C,{onClick:S,children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Add New"]}):null]})]})})]}),e.jsxs($e,{className:"",children:[e.jsx(Re,{className:"border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs(ze,{className:"text-xl text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Data Records"]}),e.jsxs(Be,{className:"text-gray-600 dark:text-gray-400",children:[F&&`Filtered by: "${F}" | `,T&&`Sorted by: ${T} (${H}) | `,"Showing ",L.length," of ",Oe," records"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 md:mt-0",children:[le&&e.jsx(O,{variant:"outline",children:"More available"}),e.jsxs(C,{variant:"outline",size:"sm",onClick:Je,disabled:o,children:[e.jsx(Te,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]})]})]})}),e.jsxs(Ee,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(es,{children:[e.jsx(ss,{children:e.jsxs(U,{className:"",children:[e.jsx(W,{className:"w-[10px] font-semibold text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"flex items-center gap-2 p-2",children:e.jsx(Ke,{className:"h-4 w-4"})})}),x.map(s=>e.jsx(W,{className:`${s.className} font-semibold text-gray-900 dark:text-gray-100`,children:e.jsxs(C,{variant:"ghost",onClick:()=>ws(s.accessorKey),className:`w-full justify-between hover:bg-gray-100 dark:hover:bg-gray-600 ${T===s.accessorKey?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":""}`,children:[s.header,Ds(s.accessorKey)]})},s.accessorKey)),e.jsx(W,{className:"font-semibold text-gray-900 dark:text-gray-100"})]})}),e.jsx(as,{children:o&&L.length===0?e.jsx(U,{children:e.jsx(Y,{colSpan:x.length+2,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center",children:e.jsx(Ie,{className:"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading Data"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we fetch your data..."})]})]})})}):L.length===0?e.jsx(U,{children:e.jsx(Y,{colSpan:x.length+2,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center",children:e.jsx(ue,{className:"h-8 w-8 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Data Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:F?`No records match "${F}"`:"No data available"})]})]})})}):L.map((s,i)=>e.jsxs(U,{ref:i===L.length-1?ks:null,className:`
                          hover:bg-blue-50/50 dark:hover:bg-gray-700/50 transition-colors border-b border-gray-200 dark:border-gray-600
                          ${s.deleted_at?"bg-red-50 dark:bg-red-900/20":""}
                          ${s.is_pinned?"bg-yellow-200 dark:bg-yellow-900/20":""}
                        `,onDoubleClick:()=>{s.deleted_at?m&&m(s.id):c&&c(s.id)},children:[e.jsx(Y,{className:"",children:e.jsxs("div",{className:"relative flex items-center",children:[s.deleted_at==null&&e.jsxs(As,{children:[e.jsx(Ts,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-gray-100 dark:hover:bg-gray-600",children:e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsxs(Fs,{align:"end",className:"w-48",children:[k?e.jsxs(ie,{onClick:()=>c&&c(s.id),className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(os,{className:"h-4 w-4"}),"Edit",e.jsx("a",{className:"ml-auto hover:text-blue-500",target:"_blank",onClick:d=>d.stopPropagation(),href:`${t}/${s.id}/edit`,rel:"noreferrer",children:e.jsx(Ze,{className:"h-4 w-4"})})]}):null,N?e.jsxs(ie,{onClick:()=>{vs(s.id),bs(s.id,N)},className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Qs,{className:"h-4 w-4"}),"Journal"]}):null,$&&e.jsxs(ie,{onClick:()=>{Pe(`${t}/${s.id}/print`),Se(!0)},className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Print",e.jsx("a",{className:"ml-auto hover:text-blue-500",target:"_blank",onClick:d=>d.stopPropagation(),href:`${t}/${s.id}/print`,rel:"noreferrer",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),p&&e.jsxs(ie,{onClick:()=>{Pe(`${t}/${s.id}/print-delivery`),Se(!0)},className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ds,{className:"h-4 w-4"}),"Print Delivery"]}),R&&R(s),n?e.jsxs(e.Fragment,{children:[e.jsx(is,{}),e.jsxs(ie,{onClick:async()=>{if(b){const{confirmed:d,reason:l}=await xs({title:"Apakah Anda yakin?",description:"Tindakan ini tidak dapat dibatalkan. Ini akan menghapus data Anda secara permanen.",cancelText:"Batal",confirmText:"Ya, Hapus data"});d&&w(s.id,l)}else await qe({title:"Apakah Anda yakin?",description:"Tindakan ini tidak dapat dibatalkan. Ini akan menghapus data Anda secara permanen.",cancelText:"Batal",confirmText:"Ya, Hapus data"})&&w(s.id)},className:"flex items-center gap-2 cursor-pointer text-red-600 focus:text-red-600",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Delete"]})]}):null]})]}),s.deleted_at&&ae&&e.jsx(C,{variant:"destructive",size:"sm",onClick:()=>$s(s.id),className:"h-8 w-8 p-0",children:e.jsx(Fe,{className:"h-4 w-4"})}),s.deleted_at&&e.jsx(O,{variant:"destructive",className:"text-xs",children:"Deleted"})]})}),x.map(d=>e.jsx(Y,{className:d.className,children:d.cell(s)},d.accessorKey)),e.jsx(Y,{children:E?e.jsx(ea,{auditableType:E,auditableId:s.id,trigger:e.jsx(C,{variant:"outline",size:"sm",children:e.jsx(Vs,{className:"h-1 w-1 "})})}):e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",className:"text-xs",children:"Created"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.entry_by||"System"})]}),e.jsx("div",{className:"text-gray-500 dark:text-gray-500",children:s.entry_at?P(s.entry_at).format("DD/MM/YYYY HH:mm"):"-"}),s.last_edit_by&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",className:"text-xs",children:"Updated"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.last_edit_by})]}),e.jsx("div",{className:"text-gray-500 dark:text-gray-500",children:s.last_edit_at?P(s.last_edit_at).format("DD/MM/YYYY HH:mm"):"-"})]}),s.deleted_by&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",className:"text-xs",children:"Deleted"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.deleted_by})]}),e.jsx("div",{className:"text-gray-500 dark:text-gray-500",children:s.delete_reason?`${s.delete_reason}`:"No reason provided"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-500",children:s.deleted_at?P(s.deleted_at).format("DD/MM/YYYY HH:mm"):"-"})]})]})})]},i))})]})}),_&&e.jsx("div",{className:"flex items-center justify-center py-6 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),"Loading more data..."]})}),!le&&L.length>0&&e.jsx("div",{className:"text-center py-6 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(O,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-700",children:"All data loaded"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing all ",Oe.toLocaleString()," records"]})]})})]})]})]}),Ye&&e.jsx(pe,{open:Ye,onOpenChange:Se,children:e.jsxs(ye,{className:"max-w-7xl max-h-[90vh] overflow-auto",children:[e.jsx(be,{children:e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5"}),"Print Preview"]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("iframe",{src:us,className:"w-full h-[80vh] border-0",title:"Print Preview"})})]})}),e.jsx(Is,{}),e.jsx(sa,{}),e.jsx(ta,{open:ps,onOpenChange:ys,transactionId:Ns,transactionType:N,title:"Jurnal "+N})]})}export{Ja as E};
