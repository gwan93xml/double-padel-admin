import{r,j as d,a as f}from"./app-CQ-G37p-.js";import{B as y}from"./button-ymMXdPy5.js";import{I as b}from"./input-BXXA-PDa.js";import{S as K}from"./search-B9EA-nRY.js";import{X as B}from"./x-D2Pel9EU.js";function U({onChange:c,value:s,clearable:w}){const[n,i]=r.useState({id:0,code:"",name:""}),[o,l]=r.useState(!1),[u,t]=r.useState(""),x=r.useRef(!1),m=r.useRef(s);r.useEffect(()=>{s&&i({id:s.id||0,code:s.code||"",name:s.name||""})},[]),r.useEffect(()=>{var e,a,p;s&&(((e=m.current)==null?void 0:e.id)!==s.id||((a=m.current)==null?void 0:a.code)!==s.code||((p=m.current)==null?void 0:p.name)!==s.name)&&(i({id:s.id||0,code:s.code||"",name:s.name||""}),m.current=s)},[s]);const S=e=>{i({...n,code:e.target.value}),g(e.target.value),t("")},C=e=>{i({...n,name:e.target.value}),g(e.target.value),t("")},j=async e=>{if(e.trim()){l(!0),t("");try{const{data:a}=await f.get(`/admin/division/search-by-code?search=${e}`);a.data?(x.current=!0,i({id:a.data.id,code:a.data.code,name:a.data.name}),c({id:a.data.id,code:a.data.code,name:a.data.name})):t("Item not found")}catch(a){t("Failed to search division"),console.error(a)}finally{l(!1)}}},N=async e=>{if(e.trim()){l(!0),t("");try{const{data:a}=await f.get(`/admin/division/search-by-name?search=${e}`);a.data?(x.current=!0,i({id:a.data.id,code:a.data.code,name:a.data.name}),c({id:a.data.id,code:a.data.code,name:a.data.name})):t("Item not found")}catch(a){t("Failed to search division"),console.error(a)}finally{l(!1)}}},D=e=>{e.key==="Enter"&&j(n.code)},E=e=>{e.key==="Enter"&&N(n.name)},k=()=>{n.code?j(n.code):n.name&&N(n.name)},[v,h]=r.useState([]),g=e=>{if(e.length<2){h([]);return}f.get(`/admin/division/browse?search=${e}`).then(a=>{h(a.data.data)}).catch(a=>{console.error("Error fetching division:",a)})};function I(){i({id:"",code:"",name:""}),c({id:"",code:"",name:""}),h([]),t("")}return d.jsx("div",{className:"space-y-2 ",children:d.jsxs("div",{className:"relative",children:[d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"w-1/4",children:d.jsx(b,{className:"rounded-r-none ",placeholder:"Kode Divisi",value:n.code,onChange:S,onKeyDown:D,disabled:o})}),d.jsx("div",{children:d.jsx(y,{variant:"ghost",className:"rounded-none border",onClick:k,disabled:o,children:d.jsx(K,{className:"h-4 w-4 "})})}),d.jsx("div",{className:"w-3/4",children:d.jsx(b,{className:"rounded-l-none ",placeholder:"Nama Divisi",value:n.name,onChange:C,onKeyDown:E,disabled:o})}),w&&d.jsx(y,{onClick:I,variant:"outline",children:d.jsx(B,{className:"h-4 w-4"})})]}),d.jsx("div",{className:`absolute bg-blue-300 w-full p-2  ${v.length>0?"block z-10 rounded shadow-sm":"hidden"}`,children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:"text-left",children:"Kode"}),d.jsx("th",{className:"text-left",children:"Nama"})]})}),d.jsx("tbody",{children:v.map(e=>d.jsxs("tr",{className:"cursor-pointer hover:bg-blue-200",onClick:()=>{i({id:e.id,code:e.code,name:e.name}),c({id:e.id,code:e.code,name:e.name}),h([])},children:[d.jsx("td",{children:e.code}),d.jsx("td",{children:e.name})]},e.id))})]})}),o&&d.jsx("div",{className:"text-sm text-muted-foreground",children:"Searching..."}),u&&d.jsx("div",{className:"text-sm text-destructive",children:u})]})})}export{U as S};
