import{r as a,a as D,j as s}from"./app-CQ-G37p-.js";import{B as z}from"./button-ymMXdPy5.js";import{I as A}from"./input-BXXA-PDa.js";import{C as Z,d as q}from"./card-Bq41eL_q.js";import{L as G}from"./loader-circle-i2ANfqrZ.js";import{S as ee}from"./search-B9EA-nRY.js";function de({onChange:p,value:v,clearable:H}){const[r,l]=a.useState({id:"",code:"",name:""}),[C,u]=a.useState(!1),[K,o]=a.useState(""),[w,i]=a.useState([]),[_,n]=a.useState(!1),[m,f]=a.useState(1),[k,h]=a.useState(!0),[N,$]=a.useState(!1),[te,L]=a.useState(""),d=a.useRef(null),P=200,I=a.useRef(null),S=a.useRef(null),R=a.useRef(!1),j=a.useRef(null),y=a.useRef(null),[b,x]=a.useState(null);a.useEffect(()=>{v&&!R.current&&l({id:v.id||"",code:v.code||"",name:v.name||""})},[v]),a.useEffect(()=>{},[r,p]),a.useEffect(()=>{if(!C&&!N&&b){const t=setTimeout(()=>{b==="code"&&j.current?j.current.focus():b==="name"&&y.current&&y.current.focus()},0);return()=>clearTimeout(t)}},[C,N,b]),a.useEffect(()=>{const t=e=>{I.current&&!I.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const Q=t=>{const e=t.target.value;x("code"),l({...r,code:e}),L(e),O(e,!0),o("")},U=t=>{const e=t.target.value;x("name"),l({...r,name:e}),L(e),O(e,!0),o("")},F=async t=>{if(t.trim()){u(!0),o("");try{const{data:e}=await D.get(`/admin/warehouse/search-by-code?search=${t}`);e.data?(R.current=!0,l({id:e.data.id,code:e.data.code,name:e.data.name}),p({id:e.data.id,code:e.data.code,name:e.data.name}),n(!1)):o("Warehouse not found")}catch(e){o("Failed to search warehouse"),console.error(e)}finally{u(!1)}}},M=async t=>{if(t.trim()){u(!0),o("");try{const{data:e}=await D.get(`/admin/warehouse/search-by-name?search=${t}`);e.data?(R.current=!0,l({id:e.data.id,code:e.data.code,name:e.data.name}),p({id:e.data.id,code:e.data.code,name:e.data.name}),n(!1)):o("Warehouse not found")}catch(e){o("Failed to search warehouse"),console.error(e)}finally{u(!1)}}},W=t=>{t.key==="Enter"&&(F(r.code??""),n(!1),i([]))},Y=t=>{t.key==="Enter"&&(M(r.name??""),n(!1),i([]))},J=()=>{r.code?F(r.code):r.name&&M(r.name)},g=a.useCallback(async(t,e,B=!1)=>{e===1?u(!0):$(!0);try{const{data:c}=await D.get(`/admin/warehouse/browse?search=${t}&page=${e}&limit=20`);i(B||e===1?c.data||[]:E=>[...E,...c.data||[]]),h(c.next_page_url!==null),n(c.data&&c.data.length>0)}catch(c){console.error("Error fetching warehouses:",c),o("Failed to load warehouses")}finally{u(!1),$(!1)}},[]),O=a.useCallback((t,e=!1)=>{if(d.current&&clearTimeout(d.current),t.length<2){i([]),n(!1),f(1),h(!0);return}d.current=setTimeout(()=>{e&&(f(1),h(!0)),g(t,e?1:m,e)},P)},[g,m]);a.useCallback((t,e=!1)=>{if(d.current&&clearTimeout(d.current),t.length<2){i([]),n(!1),f(1),h(!0);return}e&&(f(1),h(!0)),g(t,e?1:m,e)},[g,m]);const T=a.useCallback(()=>{if(!S.current||N||!k)return;const{scrollTop:t,scrollHeight:e,clientHeight:B}=S.current;if(t+B>=e-5){const c=r.code||r.name;if(c&&c.length>=2){const E=m+1;f(E),g(c,E,!1)}}},[N,k,r.code,r.name,m,g]);a.useEffect(()=>{const t=S.current;if(t)return t.addEventListener("scroll",T),()=>t.removeEventListener("scroll",T)},[T]);const V=t=>{const e=b;l({id:t.id,code:t.code,name:t.name}),p({id:t.id,code:t.code,name:t.name}),i([]),n(!1),o(""),setTimeout(()=>{e==="code"&&j.current?j.current.focus():e==="name"&&y.current&&y.current.focus()},0)},X=()=>{d.current&&clearTimeout(d.current),l({id:"",code:"",name:""}),p({id:"",code:"",name:""}),L(""),i([]),n(!1),o(""),f(1),h(!0)};return a.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),s.jsxs("div",{className:"space-y-2 relative",ref:I,children:[s.jsxs("div",{className:"flex items-center space-x-0 border rounded-lg overflow-hidden bg-background",children:[s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx(A,{ref:j,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kode Gudang",value:r.code,onChange:Q,onKeyDown:W,onFocus:()=>{x("code"),w.length>0&&n(!0)},onBlur:()=>{setTimeout(()=>x(null),150)}})}),s.jsx("div",{className:"border-l border-r",children:s.jsx(z,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:J,disabled:C,children:C?s.jsx(G,{className:"h-4 w-4 animate-spin"}):s.jsx(ee,{className:"h-4 w-4"})})}),s.jsx("div",{className:"flex-[2] min-w-0",children:s.jsx(A,{ref:y,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nama Gudang",value:r.name,onChange:U,onKeyDown:Y,onFocus:()=>{x("name"),w.length>0&&n(!0)},onBlur:()=>{setTimeout(()=>x(null),150)}})}),H&&s.jsx("div",{className:"border-l",children:s.jsx(z,{variant:"ghost",size:"sm",className:"rounded-none  px-3",onClick:X,children:"Semua Gudang"})})]}),_&&w.length>0&&s.jsx(Z,{className:"absolute top-full left-0 right-0 z-50 mt-1 shadow-lg border",children:s.jsx(q,{className:"p-0",children:s.jsxs("div",{ref:S,className:"max-h-64 overflow-y-auto",children:[s.jsx("div",{className:"sticky top-0 bg-muted/50 border-b px-4 py-2",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-muted-foreground",children:[s.jsx("div",{children:"Kode"}),s.jsx("div",{children:"Nama"})]})}),s.jsxs("div",{className:"divide-y",children:[w.map((t,e)=>s.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>V(t),children:[s.jsx("div",{className:"text-sm font-medium truncate",children:t.code}),s.jsx("div",{className:"text-sm truncate col-span-3",children:t.name})]},`${t.id}-${e}`)),N&&s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(G,{className:"h-4 w-4 animate-spin mr-2"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more..."})]}),!k&&w.length>0&&s.jsx("div",{className:"text-center py-4 text-sm text-muted-foreground",children:"No more warehouses to load"})]})]})})}),K&&s.jsx("div",{className:"text-sm text-destructive bg-destructive/10 px-3 py-2 rounded-md",children:K})]})}export{de as S};
