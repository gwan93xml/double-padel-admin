import{W as g,r as m,j as e,a as te,y as V}from"./app-CQ-G37p-.js";import{h as j}from"./moment-C5S46NFB.js";import{t as _}from"./use-toast-XJEkqv7A.js";import{A as ie}from"./AuthenticatedLayout-X6euxa7E.js";import{B as G}from"./button-ymMXdPy5.js";import{T as de,a as ne,b as y,c as o,d as oe,e as i}from"./table-BSdxGOLt.js";import{I as W}from"./input-BXXA-PDa.js";import{F as c}from"./form-group-CHZXn8bM.js";import{T as le}from"./textarea-BvykTLwI.js";import{E as ce}from"./EmptyTable-CjEJGtgb.js";import{S as me}from"./SearchDivision-Budjprvk.js";import{S as pe}from"./SearchVendor-DVTa9TJs.js";import he from"./DebtList-DvVcUQ-R.js";import{C as p}from"./currency-formatter-D5vTOkIG.js";import xe from"./PayDebtForm-D2qyvNMe.js";import{P as ue}from"./ProcessingButton-Da7kiAJ4.js";import{T as je}from"./trash-C6VGYEst.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./checkbox-DaA1krf_.js";import"./index-CZ_DqijM.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";function be({division:h}){var T,k,C,Y,S,P,E,M,F,z,B,q,A,H;const{data:s,setData:d,errors:l,setError:$,clearErrors:J}=g({date:j().format("YYYY-MM-DD"),division_id:h.id,division:h,vendor_id:"",pay_debts:[]}),{data:ve,setData:K}=g({}),[O,D]=m.useState(!1),[Q,N]=m.useState({show:!1,isEdit:!1,itemInItemIndex:0}),U=async()=>{const a=s.pay_debts;a[b.index]=w,d({...s,pay_debts:a}),v({...b,show:!1,index:-1})},X=()=>e.jsx(he,{formDialog:Q,setFormDialog:N,vendor_id:s.vendor_id,onChange:a=>{const r=a.map(t=>({debt_id:t.id,debt:t,discount:0,paid_amount:t.remaining_amount}));d("pay_debts",[...s.pay_debts,...r])}}),Z=async()=>{var a,r,t;D(!0);try{J();const n=await te.post("/admin/pay-debt",{...s,date:j(s.date).format("YYYY-MM-DD")});if(s.pay_debts.reduce((x,u)=>x+(u.paid_amount??0),0)===0){_({title:"Berhasil",description:"Pembayaran hutang berhasil disimpan tanpa kas keluar"}),V.visit("/admin/pay-debt");return}V.visit(`/admin/cash-out/create?pay_debt_header=${n.data.data.id}`),_({title:"Berhasil",description:"Pembayaran hutang berhasil disimpan, silakan proses kas keluar."})}catch(n){((a=n.response)==null?void 0:a.status)==422?$(n.response.data.errors):_({variant:"destructive",title:"Gagal",description:((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)??n.message})}finally{D(!1)}};m.useEffect(()=>{const a=localStorage.getItem("pay_debt_header.date");a&&d("date",a)},[]),m.useEffect(()=>{localStorage.setItem("pay_debt_header.date",s.date)},[s.date]);const ee=()=>{K({item_id:"",item:{code:"",name:""},quantity:"0",price:"0",remarks:""}),N({show:!0,isEdit:!1,itemInItemIndex:0})},{data:w,setData:I}=g({}),[b,v]=m.useState({show:!1,index:-1}),ae=(a,r)=>{I(r),v({show:!0,index:a})},se=a=>{d({...s,pay_debts:s.pay_debts.filter((r,t)=>a!=t)})};return e.jsxs("div",{className:"pt-5  px-5",children:[e.jsxs("div",{className:"md:flex gap-x-1",children:[e.jsxs("div",{className:"w-full md:w-3/5",children:[e.jsx(c,{name:"division_id",label:"Divisi",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(me,{value:{id:s.division_id??"",code:((T=s.division)==null?void 0:T.code)??"",name:((k=s.division)==null?void 0:k.name)??""},onChange:a=>{d({...s,division_id:a.id,division:a})}})}),e.jsx(c,{name:"text",label:"Nomor",required:!0,error:l.number,horizontal:!0,children:e.jsx(W,{type:"text",disabled:!0,value:"???",onChange:a=>d("number",a.target.value)})}),e.jsx(c,{name:"date",label:"Tanggal",required:!0,error:l.date,horizontal:!0,children:e.jsx(W,{type:"date",value:s.date,onChange:a=>d("date",a.target.value)})}),e.jsx(c,{name:"vendor_id",label:"Vendor",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(pe,{value:{id:s.vendor_id??"",code:((C=s.vendor)==null?void 0:C.code)??"",name:((Y=s.vendor)==null?void 0:Y.name)??""},onChange:a=>{d({...s,vendor_id:a.id,vendor:a})}})}),e.jsx(c,{label:"Catatan",error:l.remarks,name:"remarks",horizontal:!0,children:e.jsx(le,{value:s.remarks,onChange:a=>d("remarks",a.target.value)})})]}),e.jsxs("div",{className:"w-full md:w-2/3 bg-blue-300 p-2 rounded",children:[e.jsx("div",{children:e.jsx("strong",{children:(S=s.vendor)==null?void 0:S.name})}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[15%]",children:"Telepon"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(P=s.vendor)==null?void 0:P.phone]}),e.jsx("td",{className:"w-[15%]",children:"Term Crd"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(E=s.vendor)==null?void 0:E.term_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Fax"}),e.jsxs("td",{children:[": ",(M=s.vendor)==null?void 0:M.fax]}),e.jsx("td",{children:"Max Crd"}),e.jsxs("td",{children:[": ",(F=s.vendor)==null?void 0:F.max_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Expired"}),e.jsxs("td",{children:[": ",(z=s.vendor)==null?void 0:z.expired]}),e.jsx("td",{}),e.jsx("td",{})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4 mb-3",children:[e.jsx("div",{className:"col-span-3"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-4/5",children:e.jsx(c,{error:l.pay_debts,children:e.jsxs(de,{children:[e.jsx(ne,{children:e.jsxs(y,{children:[e.jsx(o,{className:"w-1/5",children:"Nomor Invoice"}),e.jsx(o,{className:"text-right",children:"Discount"}),e.jsx(o,{className:"text-right",children:"Bayar"}),e.jsx(o,{className:"text-right",children:"Total"}),e.jsx(o,{className:"text-right",children:"Sisa Hutang"}),e.jsx(o,{children:"Tanggal"}),e.jsx(o,{children:"Vendor"}),e.jsx(o,{children:"Divisi"}),e.jsx(o,{className:"w-[100px]",children:"Aksi"})]})}),e.jsx(oe,{children:((B=s.pay_debts)==null?void 0:B.length)==0?e.jsx(y,{children:e.jsx(i,{colSpan:9,className:"text-center",children:e.jsx(ce,{})})}):(q=s.pay_debts)==null?void 0:q.map((a,r)=>{var t,n,f,x,u,L,R;return e.jsxs(y,{onClick:()=>ae(r,a),className:"cursor-pointer ",children:[e.jsxs(i,{children:[((t=a.debt)==null?void 0:t.invoice_number)??"",a.debt.purchase_deposit?a.debt.purchase_deposit.number:""]}),e.jsx(i,{children:e.jsx(p,{amount:a.discount})}),e.jsx(i,{children:e.jsx(p,{amount:a.paid_amount})}),e.jsx(i,{children:e.jsx(p,{amount:a.discount+a.paid_amount})}),e.jsx(i,{children:e.jsx(p,{amount:((n=a.debt)==null?void 0:n.remaining_amount)??0})}),e.jsxs(i,{children:[a.debt.purchase?j((f=a.debt)==null?void 0:f.purchase.purchase_date).format("DD/MM/YYYY"):"",a.debt.purchase_deposit?j((x=a.debt)==null?void 0:x.purchase_deposit.date).format("DD/MM/YYYY"):""]}),e.jsx(i,{children:(u=a.debt)==null?void 0:u.vendor.name}),e.jsx(i,{children:(R=(L=a.debt)==null?void 0:L.division)==null?void 0:R.name}),e.jsx(i,{children:e.jsx(G,{size:"sm",variant:"destructive",onClick:re=>{re.stopPropagation(),se(r)},children:e.jsx(je,{size:24})})})]},r)})})]})})}),e.jsxs("div",{className:"w-1/5 bg-green-500 p-2 rounded",children:[e.jsxs("div",{children:["Item : ",(A=s.pay_debts)==null?void 0:A.length]}),e.jsxs("div",{className:"flex gap-x-1",children:[e.jsx("div",{children:"Total :"}),e.jsx(p,{amount:(H=s.pay_debts)==null?void 0:H.reduce((a,r)=>a+(r.paid_amount??0),0)})]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(G,{onClick:ee,variant:"outline",disabled:s.vendor_id=="",children:"Tambah dari list"})})]})]}),e.jsx(ue,{type:"button",processing:O,label:"Simpan",processingLabel:"Menyimpan",onClick:Z}),X(),e.jsx(xe,{payDebtFormDialog:b,setPayDebtFormDialog:v,payDebt:w,setPayDebt:I,onSaveItem:U})]})}be.layout=h=>e.jsx(ie,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Akuntansi",href:"#"},{label:"Pembayaran Hutang",href:"/admin/pay-debt"},{label:"Tambah",href:"#"}],children:h});export{be as default};
