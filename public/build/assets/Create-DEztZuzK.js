import{r as o,W as S,j as t,a as f,y as q}from"./app-CQ-G37p-.js";import{h as C}from"./moment-C5S46NFB.js";import{t as D}from"./use-toast-XJEkqv7A.js";import{A as G}from"./AuthenticatedLayout-X6euxa7E.js";import{B as k}from"./button-ymMXdPy5.js";import{I as h}from"./input-BXXA-PDa.js";import{F as n}from"./form-group-CHZXn8bM.js";import{S as R}from"./select-remote-C3ahzpc3.js";import{T as $}from"./textarea-BvykTLwI.js";import{S as J}from"./SearchDivision-Budjprvk.js";import{S as U}from"./SearchVendor-DVTa9TJs.js";import{L as W}from"./label-Blk7FhF1.js";import{C as z}from"./checkbox-DaA1krf_.js";import H from"./PurchaseOrderItemForm-C6OyA6bu.js";import K from"./PurchaseOrderItemList-DfCcsB2y.js";import Q from"./PurchaseOrderTotal-D_pIvllm.js";import{P as X}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchSubUnit-CTrUekdR.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";import"./EmptyTable-CjEJGtgb.js";import"./table-BSdxGOLt.js";import"./pencil-XLeJOTln.js";import"./trash-C6VGYEst.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./lodash-Caeo88pO.js";function Z({division:m,warehouse:ee,defaultTypeOfTax:I}){var v,j,y,b;o.useState(!1);const{data:r,setData:a,errors:s,setError:E,clearErrors:P}=S({vendor_id:"",number:"",type_of_tax_id:I.id,division_id:m.id,division:m,discount:"0",discount_percent:0,for_recipients:"",date:C().format("YYYY-MM-DD"),note:"",items:[],tax:0,tax_is_auto:!0}),[T,x]=o.useState(!1),{data:c,setData:u}=S({is_stock:!0}),[N,_]=o.useState({}),[w,Y]=o.useState();o.useEffect(()=>{async function e(){const i=await f.get(`/admin/type-of-tax/${r.type_of_tax_id}`);Y(i.data.data)}e()},[r.type_of_tax_id]);const[d,p]=o.useState({open:!1,isEdit:!1,index:0}),O=async()=>{try{return await f.post("/admin/purchase-order/validate",c),_({}),!0}catch(e){return _(e.response.data.errors),!1}},M=async()=>{if(await O()){if(d.isEdit){const e=r.items;e[d.index]=c,a({...r,items:e})}else a("items",[...r.items,c]);p({...d,open:!1})}},F=async()=>{x(!0),P();try{const{data:e}=await f.post("/admin/purchase-order",{...r,date:C(r.date).format("YYYY-MM-DD")});l&&window.open(`/admin/purchase-order/${e.data.id}/print`,"_blank"),q.visit("/admin/purchase-order/create"),D({title:"Berhasil",description:"Purchase order berhasil disimpan"})}catch(e){e.response.status==422?E(e.response.data.errors):D({variant:"destructive",title:"Gagal",description:e.response.data.message})}finally{x(!1)}},L=()=>{u({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},price:"0",quantity:"0",subtotal:"0",discount:"0",discount_percent:0,total:"0",notes:"",is_stock:!0}),p({open:!0,isEdit:!1,index:0})},A=(e,i)=>{u(i),p({open:!0,isEdit:!0,index:e})},B=e=>{var i;a({...r,items:(i=r.items)==null?void 0:i.filter((te,V)=>e!=V)})},[l,g]=o.useState(!1);return o.useEffect(()=>{async function e(){const i=localStorage.getItem("purchase-order.print-dialog");g(i==="1")}e()},[]),o.useEffect(()=>{localStorage.setItem("purchase-order.print-dialog",l?"1":"0")},[l]),t.jsxs("div",{className:"pt-5  px-5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(n,{label:"Divisi",error:s.division_id,name:"division_id",children:t.jsx(J,{value:{id:r.division_id,code:(v=r.division)==null?void 0:v.code,name:(j=r.division)==null?void 0:j.name},onChange:e=>{a({...r,division_id:e.id,division:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(n,{label:"Vendor",error:s.vendor_id,name:"vendor_id",children:t.jsx(U,{value:{id:r.vendor_id,code:(y=r.vendor)==null?void 0:y.code,name:(b=r.vendor)==null?void 0:b.name},onChange:e=>{a({...r,vendor_id:e.id,vendor:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(n,{label:"Jenis Pajak",error:s.type_of_tax_id,name:"type_of_tax_id",children:t.jsx(R,{remoteConfig:{url:"/admin/type-of-tax/list",label:e=>e.name,value:e=>e.id.toString()},value:r.type_of_tax_id,onValueChange:e=>{a({...r,type_of_tax_id:e})}})}),t.jsx(n,{label:"Tanggal",error:s.date,name:"date",children:t.jsx(h,{type:"date",value:r.date,onChange:e=>{a({...r,date:e.target.value})}})}),t.jsx(n,{label:"Nomor",error:s.number,name:"number",required:!0,children:t.jsx(h,{type:"text",value:"???",disabled:!0,onChange:e=>{a({...r,number:e.target.value})}})}),t.jsx(n,{label:"UP",error:s.for_recipients,name:"for_recipients",children:t.jsx(h,{type:"text",value:r.for_recipients,onChange:e=>{a({...r,for_recipients:e.target.value})}})}),t.jsx("div",{className:"col-span-3",children:t.jsx(n,{label:"Catatan",error:s.remarks,name:"remarks",children:t.jsx($,{value:r.remarks,onChange:e=>{a({...r,remarks:e.target.value})}})})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(K,{items:r.items??[],onEdit:A,onDelete:B}),t.jsx(k,{className:"w-full",onClick:L,children:t.jsx(X,{})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(Q,{data:r,type_ofTax:w,setData:a})})]}),t.jsx("div",{className:"mb-3",children:t.jsxs(W,{className:"",children:[t.jsx(z,{className:"mr-2",checked:l,onCheckedChange:e=>{g(e)}}),t.jsx("span",{children:"Cetak setelah disimpan"})]})}),t.jsx(k,{type:"button",onClick:F,children:T?"Menyimpan...":"Simpan"}),t.jsx(H,{onSave:M,formDialog:d,data:c,setData:u,errors:N,onOpenChange:e=>{p({...d,open:e})}})]})}Z.layout=m=>t.jsx(G,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Purchase Order",href:"/admin/purchase-order"},{label:"Tambah",href:"#"}],children:m});export{Z as default};
