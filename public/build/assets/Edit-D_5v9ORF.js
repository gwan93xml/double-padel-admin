import{W as R,r as m,j as e,a as re,y as v}from"./app-CQ-G37p-.js";import{h as g}from"./moment-C5S46NFB.js";import{t as f}from"./use-toast-XJEkqv7A.js";import{A as te}from"./AuthenticatedLayout-X6euxa7E.js";import{B as V}from"./button-ymMXdPy5.js";import{T as ie,a as de,b as _,c as n,d as ne,e as i}from"./table-BSdxGOLt.js";import{I as $}from"./input-BXXA-PDa.js";import{F as c}from"./form-group-CHZXn8bM.js";import{T as oe}from"./textarea-BvykTLwI.js";import{E as le}from"./EmptyTable-CjEJGtgb.js";import{S as ce}from"./SearchDivision-Budjprvk.js";import{S as me}from"./SearchVendor-DVTa9TJs.js";import he from"./DebtList-DvVcUQ-R.js";import{C as h}from"./currency-formatter-D5vTOkIG.js";import pe from"./PayDebtForm-D2qyvNMe.js";import{P as xe}from"./ProcessingButton-Da7kiAJ4.js";import{T as ue}from"./trash-C6VGYEst.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./checkbox-DaA1krf_.js";import"./index-CZ_DqijM.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";function je({division:y,payDebtHeader:G}){var T,C,I,k,E,F,P,S,Y,M,z,B,A,H;const{data:s,setData:o,errors:l,setError:U,clearErrors:W}=R(G),[J,be]=m.useState(!1);m.useState({});const[K,D]=m.useState({show:!1,isEdit:!1,itemInItemIndex:0});m.useEffect(()=>{},[s.vendor_id]);const O=async()=>{const a=s.pay_debts;a[u.index]=N,o({...s,pay_debts:a}),j({...u,show:!1,index:-1})},Q=()=>e.jsx(he,{formDialog:K,setFormDialog:D,vendor_id:s.vendor_id,onChange:a=>{const r=a.map(t=>({debt_id:t.id,debt:t,discount:0,paid_amount:t.remaining_amount}));o("pay_debts",[...s.pay_debts,...r])},payDebtHeader:s}),X=async()=>{var a,r,t;try{W();const d=await re.put(`/admin/pay-debt/${s.id}`,{...s,date:g(s.date).format("YYYY-MM-DD")});if(s.pay_debts.reduce((p,x)=>p+(x.paid_amount??0),0)===0){f({title:"Berhasil",description:"Pembayaran hutang berhasil diubah tanpa kas keluar."}),v.visit("/admin/pay-debt");return}s.cash_out?v.visit(`/admin/cash-out/${s.cash_out.id}/edit`):v.visit(`/admin/cash-out/create?pay_debt_header=${d.data.data.id}`),f({title:"Berhasil",description:"Pembayaran hutang berhasil diubah."})}catch(d){((a=d.response)==null?void 0:a.status)==422?U(d.response.data.errors):f({variant:"destructive",title:"Gagal",description:((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.message)??d.message})}},Z=()=>{D({show:!0,isEdit:!1,itemInItemIndex:0})},{data:N,setData:w}=R({}),[u,j]=m.useState({show:!1,index:-1}),ee=(a,r)=>{w(r),j({show:!0,index:a})},ae=a=>{o({...s,pay_debts:s.pay_debts.filter((r,t)=>a!=t)})};return e.jsxs("div",{className:"pt-5  px-5",children:[e.jsxs("div",{className:"md:flex gap-x-1",children:[e.jsxs("div",{className:"w-full md:w-3/5",children:[e.jsx(c,{name:"division_id",label:"Divisi",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(ce,{value:{id:s.division_id??"",code:((T=s.division)==null?void 0:T.code)??"",name:((C=s.division)==null?void 0:C.name)??""},onChange:a=>{o({...s,division_id:a.id,division:a})}})}),e.jsx(c,{name:"text",label:"Nomor",required:!0,error:l.number,horizontal:!0,children:e.jsx($,{type:"text",value:s.number,onChange:a=>o("number",a.target.value)})}),e.jsx(c,{name:"date",label:"Tanggal",required:!0,error:l.date,horizontal:!0,children:e.jsx($,{type:"date",value:s.date,onChange:a=>o("date",a.target.value)})}),e.jsx(c,{name:"vendor_id",label:"Vendor",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(me,{value:{id:s.vendor_id??"",code:((I=s.vendor)==null?void 0:I.code)??"",name:((k=s.vendor)==null?void 0:k.name)??""},onChange:a=>{console.log(a),o({...s,vendor_id:a.id,vendor:a})}})}),e.jsx(c,{label:"Catatan",error:l.remarks,name:"remarks",horizontal:!0,children:e.jsx(oe,{value:s.remarks,onChange:a=>o("remarks",a.target.value)})})]}),e.jsxs("div",{className:"w-full md:w-2/3 bg-blue-300 p-2 rounded",children:[e.jsx("div",{children:e.jsx("strong",{children:(E=s.vendor)==null?void 0:E.name})}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[15%]",children:"Telepon"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(F=s.vendor)==null?void 0:F.phone]}),e.jsx("td",{className:"w-[15%]",children:"Term Crd"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(P=s.vendor)==null?void 0:P.term_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Fax"}),e.jsxs("td",{children:[": ",(S=s.vendor)==null?void 0:S.fax]}),e.jsx("td",{children:"Max Crd"}),e.jsxs("td",{children:[": ",(Y=s.vendor)==null?void 0:Y.max_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Expired"}),e.jsxs("td",{children:[": ",(M=s.vendor)==null?void 0:M.expired]}),e.jsx("td",{}),e.jsx("td",{})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4 mb-3",children:[e.jsx("div",{className:"col-span-3"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-4/5",children:e.jsx(c,{error:l.pay_debts,children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs(_,{children:[e.jsx(n,{className:"w-1/5",children:"No"}),e.jsx(n,{className:"text-right",children:"Discount"}),e.jsx(n,{className:"text-right",children:"Bayar"}),e.jsx(n,{className:"text-right",children:"Total"}),e.jsx(n,{className:"text-right",children:"Sisa Hutang"}),e.jsx(n,{children:"Tanggal"}),e.jsx(n,{children:"Vendor"}),e.jsx(n,{children:"Divisi"}),e.jsx(n,{className:"w-[100px]",children:"Aksi"})]})}),e.jsx(ne,{children:((z=s.pay_debts)==null?void 0:z.length)==0?e.jsx(_,{children:e.jsx(i,{colSpan:9,className:"text-center",children:e.jsx(le,{})})}):(B=s.pay_debts)==null?void 0:B.map((a,r)=>{var t,d,b,p,x,q,L;return e.jsxs(_,{onClick:()=>ee(r,a),className:"cursor-pointer",children:[e.jsx(i,{children:a.debt?e.jsxs(e.Fragment,{children:[((t=a.debt)==null?void 0:t.invoice_number)??"",(d=a.debt)!=null&&d.purchase_deposit?(b=a.debt)==null?void 0:b.purchase_deposit.number:""]}):e.jsx(e.Fragment,{children:"-"})}),e.jsx(i,{children:e.jsx(h,{amount:a.discount})}),e.jsx(i,{children:e.jsx(h,{amount:a.paid_amount})}),e.jsx(i,{children:e.jsx(h,{amount:a.discount+a.paid_amount})}),e.jsx(i,{children:e.jsx(h,{amount:((p=a.debt)==null?void 0:p.remaining_amount)??0})}),e.jsx(i,{children:a.debt?e.jsxs(e.Fragment,{children:[a.debt.purchase?g(a.debt.purchase.purchase_date).format("DD/MM/YYYY"):"",a.debt.purchase_deposit?g(a.debt.purchase_deposit.date).format("DD/MM/YYYY"):""]}):e.jsx(e.Fragment,{children:"-"})}),e.jsx(i,{children:(x=a.debt)==null?void 0:x.vendor.name}),e.jsx(i,{children:(L=(q=a.debt)==null?void 0:q.division)==null?void 0:L.name}),e.jsx(i,{children:e.jsx(V,{size:"sm",variant:"destructive",onClick:se=>{se.stopPropagation(),ae(r)},children:e.jsx(ue,{size:24})})})]},r)})})]})})}),e.jsxs("div",{className:"w-1/5 bg-green-500 p-2 rounded",children:[e.jsxs("div",{children:["Item : ",(A=s.pay_debts)==null?void 0:A.length]}),e.jsxs("div",{className:"flex gap-x-1",children:[e.jsx("div",{children:"Total :"}),e.jsx(h,{amount:(H=s.pay_debts)==null?void 0:H.reduce((a,r)=>a+(r.paid_amount??0),0)})]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(V,{onClick:Z,variant:"outline",disabled:s.vendor_id=="",children:"Tambah dari list"})})]})]}),e.jsx(xe,{type:"button",processing:J,label:"Ubah",processingLabel:"Mengubah",onClick:X}),Q(),e.jsx(pe,{payDebtFormDialog:u,setPayDebtFormDialog:j,payDebt:N,setPayDebt:w,onSaveItem:O})]})}je.layout=y=>e.jsx(te,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Akuntansi",href:"#"},{label:"Pembayaran Hutang",href:"/admin/pay-debt"},{label:"Edit",href:"#"}],children:y});export{je as default};
