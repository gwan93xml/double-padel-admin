import{q as N,j as e,c as b,r as l,W as A,Y as R}from"./app-CQ-G37p-.js";import{P as I}from"./ProcessingButton-Da7kiAJ4.js";import{F as h}from"./form-group-CHZXn8bM.js";import{I as j}from"./input-BXXA-PDa.js";import{L}from"./label-Blk7FhF1.js";import{S as T,a as S,b as _,c as P,j as F,d as w}from"./select-BSIJzAmS.js";import{C as G,a as U,d as z}from"./card-Bq41eL_q.js";import"./button-ymMXdPy5.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";function H({children:i}){const{setting:m}=N().props;return e.jsxs("div",{className:"flex min-h-screen flex-col items-center  sm:justify-center sm:pt-0",children:[e.jsx("div",{children:e.jsx(b,{href:"/",children:e.jsx("img",{src:`/storage/${m.logo}`,className:"flex h-32 items-center justify-center rounded-lg  text-sidebar-primary-foreground mb-3"})})}),e.jsxs(G,{className:"w-7xl mx-auto",children:[e.jsx(U,{}),e.jsx(z,{children:i})]})]})}function te({status:i,canResetPassword:m,group:v,turnstileSiteKey:c}){const t=l.useRef(null),p=l.useRef(!1),n=l.useRef(!1),{data:u,setData:o,post:C,processing:y,errors:d,reset:E}=A({group:v,email:"",password:"",remember:!1,"cf-turnstile-response":""}),k=s=>{if(s.preventDefault(),!u["cf-turnstile-response"]){alert("Please complete the captcha verification.");return}C(route("login"),{onFinish:()=>E("password")})};l.useEffect(()=>()=>{n.current=!1},[]);const g=l.useCallback(()=>{console.log("initializeCaptcha called for sitekey:",c),document.querySelectorAll(".cf-turnstile").forEach(r=>{r!==t.current&&r.parentNode&&r.parentNode.removeChild(r)}),t.current&&(t.current.innerHTML=""),n.current=!1;const f=()=>{if(console.log("renderWidget called"),console.log("window.turnstile exists:",!!window.turnstile),console.log("captchaRef.current exists:",!!t.current),console.log("widgetRenderedRef.current:",n.current),window.turnstile&&t.current&&!n.current){console.log("Rendering single widget..."),console.log("Using sitekey:",c||"0x4AAAAAAA_example_site_key");try{const r=window.turnstile.render(t.current,{sitekey:c||"0x4AAAAAAA_example_site_key",callback:x=>{console.log("Captcha token received:",x.substring(0,20)+"..."),o("cf-turnstile-response",x)},"error-callback":()=>{console.log("Captcha error callback triggered"),o("cf-turnstile-response","")},"expired-callback":()=>{console.log("Captcha expired callback triggered"),o("cf-turnstile-response","")}});n.current=!0,console.log("Widget rendered successfully with ID:",r)}catch(r){console.error("Error rendering turnstile widget:",r)}}else console.log("Cannot render widget - conditions not met")};if(window.turnstile){f();return}if(p.current){const r=setInterval(()=>{window.turnstile&&(clearInterval(r),f())},100);setTimeout(()=>{clearInterval(r)},1e4);return}p.current=!0;const a=document.createElement("script");a.src="https://challenges.cloudflare.com/turnstile/v0/api.js",a.async=!0,a.defer=!0,a.onload=()=>{console.log("Turnstile script loaded successfully"),f()},a.onerror=()=>{console.log("Turnstile script failed to load"),p.current=!1},document.head.appendChild(a)},[c]);return l.useEffect(()=>(console.log("Main useEffect running"),g(),()=>{console.log("Main useEffect cleanup"),n.current=!1}),[g]),l.useEffect(()=>()=>{console.log("Component unmounting cleanup"),n.current=!1},[]),e.jsxs(H,{children:[e.jsx(R,{title:"Log in"}),i&&e.jsx("div",{className:"mb-4 text-sm font-medium text-green-600",children:i}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(L,{htmlFor:"group",children:"Group"}),e.jsxs(T,{onValueChange:s=>o("group",s),defaultValue:u.group,children:[e.jsx(S,{children:e.jsx(_,{placeholder:"Pilih Group"})}),e.jsx(P,{children:e.jsxs(F,{children:[e.jsx(w,{value:"samplekps.xyz",children:"KPSI"}),e.jsx(w,{value:"hexa.samplekps.xyz",children:"HEXAPURE"})]})})]})]}),e.jsx(h,{label:"Username/Email",error:d.email,children:e.jsx(j,{id:"email",type:"text",name:"email",value:u.email,className:"mt-1 block w-full",autoComplete:"username",onChange:s=>o("email",s.target.value)})}),e.jsx(h,{className:"mt-4",label:"Password",error:d.password,children:e.jsx(j,{id:"password",type:"password",name:"password",value:u.password,className:"mt-1 block w-full",autoComplete:"current-password",onChange:s=>o("password",s.target.value)})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{ref:t,className:"cf-turnstile",style:{minHeight:"65px"}}),!c&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:"Using demo sitekey. Set TURNSTILE_SITE_KEY in .env for production."}),d["cf-turnstile-response"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d["cf-turnstile-response"]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end",children:[m&&e.jsx(b,{href:route("password.request"),children:"Forgot your password?"}),e.jsx(I,{type:"submit",label:"Login",processingLabel:"Logging in...",processing:y,className:"ms-4"})]})]})]})}export{te as default};
