import{r as s,W as E,j as t,a as h,y as x}from"./app-CQ-G37p-.js";import{h as u}from"./moment-C5S46NFB.js";import{t as I}from"./use-toast-XJEkqv7A.js";import{A as L}from"./AuthenticatedLayout-X6euxa7E.js";import{B as w}from"./button-ymMXdPy5.js";import{I as n}from"./input-BXXA-PDa.js";import{F as i}from"./form-group-CHZXn8bM.js";import{S as O}from"./select-remote-C3ahzpc3.js";import{T as $}from"./textarea-BvykTLwI.js";import{S as R}from"./SearchDivision-Budjprvk.js";import{S as W}from"./SearchCustomer-BbTZ5_2l.js";import{S as H}from"./SearchWarehouse-Bw-VGbhg.js";import{C as U}from"./CashCredit-BZxMHD02.js";import V from"./SaleItemForm-BzHc6leC.js";import z from"./SaleItemTotal-m3BHMHcm.js";import K from"./SaleItemList-BUU4L9yW.js";import{P as Q}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchItemNonStock-BQ2Ydllm.js";import"./SearchSubUnit-CTrUekdR.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./lodash-Caeo88pO.js";import"./EmptyTable-CjEJGtgb.js";import"./table-BSdxGOLt.js";import"./pencil-XLeJOTln.js";import"./trash-C6VGYEst.js";function X({sale:d}){var b,j,g,C,S,D;const[f,y]=s.useState(!1),{data:e,setData:r,errors:o,setError:T,clearErrors:Y}=E(d),{data:p,setData:_}=E({}),[N,v]=s.useState({}),[P,q]=s.useState();s.useEffect(()=>{async function a(){const m=await h.get(`/admin/type-of-tax/${e.type_of_tax_id}`);q(m.data.data)}a()},[e.type_of_tax_id]),s.useEffect(()=>{r({...e,due_date:u(e.sale_date).add(1,"month").format("YYYY-MM-DD"),due_date_days:u(e.sale_date).add(1,"month").diff(u(e.sale_date),"days")})},[e.sale_date]),s.useEffect(()=>{d.due_date_days&&r({...e,due_date:u(e.sale_date).add(d.due_date_days,"days").format("YYYY-MM-DD")})},[d.due_date_days]);const[l,c]=s.useState({open:!1,isEdit:!1,index:0}),k=async()=>{try{return await h.post("/admin/sale/validate",p),v({}),!0}catch(a){return v(a.response.data.errors),!1}},M=async()=>{if(await k()){if(l.isEdit){const a=e.items;a[l.index]=p,r({...e,items:a})}else r("items",[...e.items,p]);c({...l,open:!1})}},F=async()=>{y(!0);try{Y();const a=await h.put(`/admin/sale/${e.id}`,{...e,sale_date:u(e.sale_date).format("YYYY-MM-DD")});e.payment_method=="Cash"?e.cash_in?x.visit(`/admin/cash-in/${e.cash_in.id}/edit`):x.visit("/admin/cash-in/create?sale_id="+a.data.data.id):x.visit("/admin/sale"),I({title:"Berhasil",description:"Penjualan berhasil diubah"})}catch(a){a.response.status==422?T(a.response.data.errors):I({variant:"destructive",title:"Gagal",description:a.response.data.message})}finally{y(!1)}},A=()=>{_({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},price:"0",quantity:"0",unit:"",discount:"0",discount_percent:0,total:"0",subtotal:"0",notes:"",is_stock:!0}),c({open:!0,isEdit:!1,index:0})},B=(a,m)=>{_(m),c({open:!0,isEdit:!0,index:a})},G=a=>{var m;r({...e,items:(m=e.items)==null?void 0:m.filter((Z,J)=>a!=J)})};return t.jsxs("div",{className:"pt-5  px-5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(i,{label:"Pelanggan",error:o.customer_id,name:"customer_id",required:!0,children:t.jsx(W,{value:{id:e.customer_id??"",code:((b=e.customer)==null?void 0:b.code)??"",name:((j=e.customer)==null?void 0:j.name)??""},onChange:a=>{r({...e,customer_id:a.id,customer:a})}})}),t.jsx(i,{label:"Jenis Pajak",error:o.type_of_tax_id,name:"type_of_tax_id",required:!0,children:t.jsx(O,{value:e.type_of_tax_id,remoteConfig:{url:"/admin/type-of-tax/list",label:a=>a.name,value:a=>a.id.toString()},onValueChange:a=>{r({...e,type_of_tax_id:a})}})}),t.jsx(i,{label:"Gudang",error:o.warehouse_id,name:"warehouse_id",required:!0,children:t.jsx(H,{value:{id:e.warehouse_id??"",code:((g=e.warehouse)==null?void 0:g.code)??"",name:((C=e.warehouse)==null?void 0:C.name)??""},onChange:a=>{r({...e,warehouse_id:a.id,warehouse:a})}})}),t.jsx(i,{label:"Divisi",error:o.division_id,name:"division_id",required:!0,children:t.jsx(R,{value:{id:e.division_id??"",code:((S=e.division)==null?void 0:S.code)??"",name:((D=e.division)==null?void 0:D.name)??""},onChange:a=>{r({...e,division_id:a.id,division:a})},clearable:!0})}),t.jsx(i,{label:"Tanggal",error:o.sale_date,name:"sale_date",required:!0,children:t.jsx(n,{type:"date",value:e.sale_date,onChange:a=>{r({...e,sale_date:a.target.value})}})}),t.jsx(i,{label:"No",error:o.no,name:"no",required:!0,children:t.jsx(n,{type:"text",value:e.no,onChange:a=>{r({...e,no:a.target.value})}})}),t.jsx(i,{label:"No. SO",error:o.sales_order_number,name:"sales_order_number",children:t.jsx(n,{type:"text",value:e.sales_order_number,onChange:a=>{r({...e,sales_order_number:a.target.value})}})}),t.jsx(i,{label:"No. PO",error:o.purchase_order_number,name:"purchase_order_number",children:t.jsx(n,{type:"text",value:e.purchase_order_number,onChange:a=>{r({...e,purchase_order_number:a.target.value})}})}),t.jsx(i,{label:"Metode Pembayaran",error:o.payment_method,name:"payment_method",required:!0,children:t.jsx(U,{value:e.payment_method??"Credit",onChange:a=>{r({...e,payment_method:a})}})}),t.jsx(i,{label:"Faktur Pajak",error:o.tax_invoice_number,name:"tax_invoice_number",required:!0,children:t.jsx(n,{type:"text",value:e.tax_invoice_number,onChange:a=>{r({...e,tax_invoice_number:a.target.value})}})}),e.payment_method=="Credit"&&t.jsxs(t.Fragment,{children:[t.jsx(i,{label:"Lama Jatuh Tempo (Hari)",error:o.due_date,name:"due_date_days",children:t.jsx(n,{type:"number",className:"text-right",value:e.due_date_days,onChange:a=>{r({...e,due_date_days:Number.parseInt(a.target.value)})}})}),t.jsx(i,{label:"Jatuh Tempo",error:o.due_date,name:"due_date",children:t.jsx(n,{type:"date",value:e.due_date,onChange:a=>{r({...e,due_date:a.target.value})}})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(i,{label:"Catatan",error:o.note,name:"note",children:t.jsx($,{value:e.note,onChange:a=>{r({...e,note:a.target.value})}})})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(K,{items:e.items??[],onEdit:B,onDelete:G}),t.jsx(w,{className:"w-full",onClick:A,children:t.jsx(Q,{})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(z,{data:e,setData:r,type_ofTax:P})})]}),t.jsx(w,{type:"button",onClick:F,disabled:f,children:f?"Mengubah...":"Ubah"}),t.jsx(V,{formDialog:l,data:p,setData:_,onOpenChange:()=>{c({...l,open:!1})},errors:N,warehouse_id:e.warehouse_id,onSave:M})]})}X.layout=d=>t.jsx(L,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Penjualan",href:"/admin/sale"},{label:"Edit",href:"#"}],children:d});export{X as default};
