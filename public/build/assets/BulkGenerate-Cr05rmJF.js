import{W as K,r as h,j as t,a as R,y as W}from"./app-xdIDsNuc.js";import{A as Q}from"./AuthenticatedLayout-DtjjUv9R.js";import{B as _}from"./index-D9fYs-5N.js";import{C as U,a as X,b as Y,c as Z,d as ee}from"./card-DPe-xeUS.js";import{F as p}from"./form-group-DJppTG6k.js";import{I as S}from"./input-Pb5O0huv.js";import{C as $}from"./checkbox-C3fx99cs.js";import{S as k,a as P,b as T,c as E,d as b}from"./select-CnbTIwKL.js";import{T as te,a as ae,b as se,c as re}from"./tabs-Be33VXZ5.js";import{t as w}from"./use-toast-BOfnQU58.js";import"./utils-jM7Hu9J5.js";import"./badge-ZAY5fO7e.js";import"./createLucideIcon-D9qBrcbq.js";import"./index-CltWYr8P.js";import"./index-4rFdga_w.js";import"./index-Dy_V4ZJ5.js";import"./index-CCSo0cdO.js";import"./index-CZTB0vk4.js";import"./x-Cp6Dz_ky.js";import"./index-OwxvCaeV.js";import"./moment-DPfounic.js";import"./check-B2a_CU3u.js";import"./star-DujE_Tw0.js";import"./label-DxiqzSVl.js";import"./index-DY1xKekZ.js";function le({courts:v}){var N;const{data:i,setData:g,clearErrors:A,errors:f,setError:B}=K({court_id:"",start_date:"",end_date:"",default_price:"",status:"available"}),[c,x]=h.useState({}),[m,d]=h.useState({}),[y,D]=h.useState(!1),o=h.useMemo(()=>{const e=[];for(let a=0;a<24;a++){const l=String(a).padStart(2,"0"),r=String(a+1).padStart(2,"0");e.push({start_time:`${l}:00`,end_time:`${r}:00`})}return e},[]),u=h.useMemo(()=>{if(!i.start_date||!i.end_date)return[];const e=[],a=new Date(i.start_date),l=new Date(i.end_date);for(;a<=l;)e.push(a.toISOString().split("T")[0]),a.setDate(a.getDate()+1);return e},[i.start_date,i.end_date]);h.useEffect(()=>{const e={};u.forEach(a=>{c[a]?e[a]=new Set(c[a]):e[a]=new Set}),x(e)},[u]);const z=(e,a)=>{const l={...c},r=new Set(l[e]),s=`${e}-${a}`;if(r.has(a)){r.delete(a);const n={...m};delete n[s],d(n)}else{r.add(a);const n={...m};n[s]=i.default_price||"",d(n)}l[e]=r,x(l)},H=(e,a,l)=>{const r=`${e}-${a}`,s={...m};s[r]=l,d(s)},q=e=>{const a={...c},l=a[e],r={...m};l.size===o.length?(o.forEach((s,n)=>{delete r[`${e}-${n}`]}),a[e]=new Set):(a[e]=new Set(Array.from({length:o.length},(s,n)=>n)),o.forEach((s,n)=>{r[`${e}-${n}`]=i.default_price||""})),x(a),d(r)},F=e=>{g("default_price",e);const a={};Object.entries(c).forEach(([l,r])=>{r.forEach(s=>{const n=`${l}-${s}`;a[n]=e})}),d(a)},G=()=>{const e={},a={};u.forEach(l=>{e[l]=new Set(Array.from({length:o.length},(r,s)=>s)),o.forEach((r,s)=>{a[`${l}-${s}`]=i.default_price||""})}),x(e),d(a)},J=()=>{x({}),d({})},L=Object.values(c).reduce((e,a)=>e+a.size,0),M=e=>new Date(e).toLocaleDateString("id-ID",{weekday:"short",year:"numeric",month:"short",day:"numeric"});async function O(){var a,l,r;if(!Object.values(c).some(s=>s.size>0)){w({variant:"destructive",title:"Gagal",description:"Pilih minimal satu jam untuk satu tanggal"});return}A(),D(!0);try{const s=Object.entries(c).flatMap(([n,I])=>Array.from(I).sort((j,V)=>j-V).map(j=>({date:n,...o[j],price:m[`${n}-${j}`]})));await R.post("/court-schedule/bulk-generate",{court_id:i.court_id,status:i.status,time_slots:s}),w({title:"Sukses",description:"Jadwal lapangan berhasil dibuat"}),W.visit("/court-schedule")}catch(s){if(((a=s.response)==null?void 0:a.status)===422){const n=s.response.data.errors;B(n)}else w({variant:"destructive",title:"Gagal",description:((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"Terjadi kesalahan"})}finally{D(!1)}}const C=e=>{const a=c[e];return a?Array.from(a).sort((l,r)=>l-r).map(l=>({index:l,slot:o[l]})):[]};return t.jsx("div",{className:"p-5",children:t.jsxs(U,{children:[t.jsxs(X,{children:[t.jsx(Y,{children:"Bulk Generate Jadwal Lapangan"}),t.jsx(Z,{children:"Buat jadwal lapangan untuk beberapa tanggal sekaligus dengan custom harga per slot"})]}),t.jsxs(ee,{children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx(p,{label:"Lapangan",error:f.court_id,required:!0,children:t.jsxs(k,{value:((N=i.court_id)==null?void 0:N.toString())||"",onValueChange:e=>g("court_id",e),children:[t.jsx(P,{children:t.jsx(T,{placeholder:"Pilih lapangan"})}),t.jsx(E,{children:v.map(e=>t.jsxs(b,{value:e.id.toString(),children:[e.venue.name," - ",e.name]},e.id))})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(p,{label:"Tanggal Mulai",error:f.start_date,required:!0,children:t.jsx(S,{type:"date",value:i.start_date||"",onChange:e=>g("start_date",e.target.value)})}),t.jsx(p,{label:"Tanggal Selesai",error:f.end_date,required:!0,children:t.jsx(S,{type:"date",value:i.end_date||"",onChange:e=>g("end_date",e.target.value)})})]}),t.jsx(p,{label:"Harga Default",error:f.default_price,required:!0,children:t.jsx(S,{type:"number",value:i.default_price||"",onChange:e=>F(e.target.value),min:"0",placeholder:"Harga default untuk semua slot"})}),u.length>0&&t.jsxs(p,{label:"Jam Operasional per Tanggal",required:!0,children:[t.jsx("div",{className:"space-y-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:G,children:"Pilih Semua Tanggal & Jam"}),t.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:J,children:"Batal Semua Pilihan"}),t.jsxs("div",{className:"ml-auto flex items-center text-sm font-medium text-gray-600",children:["Total Dipilih: ",L," slot"]})]})}),t.jsxs(te,{defaultValue:u[0],className:"w-full",children:[t.jsx("div",{className:"overflow-x-auto pb-4",children:t.jsx(ae,{className:"inline-flex gap-2",children:u.map(e=>t.jsx(se,{value:e,className:"text-xs whitespace-nowrap",children:M(e)},e))})}),u.map(e=>{var a,l;return t.jsxs(re,{value:e,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($,{checked:(((a=c[e])==null?void 0:a.size)||0)===o.length,onCheckedChange:()=>q(e),id:`select-all-${e}`}),t.jsxs("label",{htmlFor:`select-all-${e}`,className:"text-sm font-medium cursor-pointer",children:["Pilih Semua (",((l=c[e])==null?void 0:l.size)||0,"/",o.length,")"]})]}),t.jsx("div",{className:"grid grid-cols-6 gap-2 p-3 bg-gray-50 rounded",children:o.map((r,s)=>{var n;return t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx($,{checked:((n=c[e])==null?void 0:n.has(s))||!1,onCheckedChange:()=>z(e,s),id:`slot-${e}-${s}`}),t.jsxs("label",{htmlFor:`slot-${e}-${s}`,className:"text-xs font-medium cursor-pointer whitespace-nowrap",children:[r.start_time,"-",r.end_time]})]},s)})})]}),C(e).length>0&&t.jsxs("div",{className:"space-y-2 p-3 bg-blue-50 rounded",children:[t.jsx("h4",{className:"font-medium text-sm",children:"Harga untuk slot yang dipilih:"}),t.jsx("div",{className:"grid grid-cols-3 gap-3",children:C(e).map(({index:r,slot:s})=>t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"text-xs font-medium",children:[s.start_time,"-",s.end_time]}),t.jsx(S,{type:"number",value:m[`${e}-${r}`]||"",onChange:n=>H(e,r,n.target.value),min:"0",placeholder:"Harga",className:"h-8"})]},r))})]})]},e)})]})]}),t.jsx(p,{label:"Status",error:f.status,required:!0,children:t.jsxs(k,{value:i.status||"available",onValueChange:e=>g("status",e),children:[t.jsx(P,{children:t.jsx(T,{placeholder:"Pilih status"})}),t.jsxs(E,{children:[t.jsx(b,{value:"available",children:"Tersedia"}),t.jsx(b,{value:"booked",children:"Dipesan"}),t.jsx(b,{value:"closed",children:"Ditutup"})]})]})})]}),t.jsx(_,{disabled:y,onClick:O,className:"mt-6 w-full",children:y?"Membuat...":"Buat Jadwal"})]})]})})}le.layout=v=>t.jsx(Q,{breadcrumbs:[{label:"Dashboard",href:"/"},{label:"Master Data",href:"#"},{label:"Jadwal Lapangan",href:"/court-schedule"},{label:"Bulk Generate",href:"#"}],children:v});export{le as default};
