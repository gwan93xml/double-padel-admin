import{r as T,j as t}from"./app-CQ-G37p-.js";import{D as k,a as q,b as C,c as N,d as v}from"./dialog-CBBIkam9.js";import{B as j}from"./button-ymMXdPy5.js";import{T as F,a as $,b as _,c,d as w,e as l}from"./table-BSdxGOLt.js";import{I as g}from"./input-BXXA-PDa.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./index-D0iIn24t.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./createLucideIcon-iWXofaGH.js";import"./x-D2Pel9EU.js";function M({open:y,onOpenChange:m,sale:o,typeOfTax:R,onAddItems:f}){const[r,d]=T.useState({}),b=(s,a)=>{const i=`item_${s}`;d(a?n=>({...n,[i]:{quantity:"1",notes:""}}):n=>{const e={...n};return delete e[i],e})},u=(s,a,i)=>{const n=`item_${s}`;d(e=>({...e,[n]:{...e[n],[a]:i}}))},I=()=>{const s=[];console.log("selectedSaleItems:",r),console.log("sale items:",o==null?void 0:o.items),Object.entries(r).forEach(([a,i])=>{var h,p,x;const n=parseInt(a.replace("item_","")),e=(h=o==null?void 0:o.items)==null?void 0:h[n];e&&parseFloat(i.quantity)>0?s.push({item_id:e.item_id,item_name:e.item_name,item:e.item,chart_of_account_id:(p=e.chart_of_account_id)==null?void 0:p.toString(),chart_of_account:e.chart_of_account,is_stock:e.is_stock,quantity:i.quantity,unit:e.unit,price:e.price,subtotal:(parseFloat(e.price||"0")*parseFloat(i.quantity)).toString(),discount:e.discount,discount_percent:(x=e.discount_percent)==null?void 0:x.toString(),tax:"0",total:(parseFloat(e.price||"0")*parseFloat(i.quantity)).toString(),notes:i.notes}):console.log("Item not added - saleItem:",!!e,"quantity > 0:",parseFloat(i.quantity)>0)}),s.length>0&&f(s),d({}),m(!1)},S=()=>{d({}),m(!1)};return t.jsx(k,{open:y,onOpenChange:m,children:t.jsxs(q,{className:"max-h-[80vh] overflow-y-auto max-w-4xl",children:[t.jsx(C,{children:t.jsx(N,{children:"Pilih Item untuk Retur"})}),t.jsx("div",{className:"space-y-4",children:o!=null&&o.items&&o.items.length>0?t.jsxs(F,{children:[t.jsx($,{children:t.jsxs(_,{children:[t.jsx(c,{className:"w-[50px]",children:"Pilih"}),t.jsx(c,{children:"Kode Item"}),t.jsx(c,{children:"Nama Item"}),t.jsx(c,{children:"Jumlah Tersedia"}),t.jsx(c,{children:"Harga"}),t.jsx(c,{children:"Jumlah Retur"}),t.jsx(c,{children:"Catatan"})]})}),t.jsx(w,{children:o.items.map((s,a)=>{var i;return t.jsxs(_,{children:[t.jsx(l,{children:t.jsx("input",{type:"checkbox",checked:!!r[`item_${a}`],onChange:n=>b(a,n.target.checked)})}),t.jsx(l,{children:((i=s.item)==null?void 0:i.code)??"NON STOCK"}),t.jsx(l,{children:s.item_name}),t.jsx(l,{children:s.quantity}),t.jsxs(l,{children:["Rp ",Number.parseInt(s.price||"0").toLocaleString("id-ID")]}),t.jsx(l,{children:r[`item_${a}`]&&t.jsx(g,{type:"number",min:"0",max:s.quantity,value:r[`item_${a}`].quantity,onChange:n=>u(a,"quantity",n.target.value),className:"w-20"})}),t.jsx(l,{children:r[`item_${a}`]&&t.jsx(g,{type:"text",value:r[`item_${a}`].notes,onChange:n=>u(a,"notes",n.target.value),placeholder:"Catatan"})})]},s.item_id||a)})})]}):t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Tidak ada item yang tersedia untuk retur"})}),t.jsxs(v,{children:[t.jsx(j,{type:"button",variant:"outline",onClick:S,children:"Batal"}),t.jsxs(j,{type:"button",onClick:I,disabled:Object.keys(r).length===0,children:["Tambah ke Retur (",Object.keys(r).length," item)"]})]})]})})}export{M as default};
