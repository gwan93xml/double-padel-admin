import{r as k,j as t}from"./app-CQ-G37p-.js";import{D as q,a as S,b as C,c as N,d as v}from"./dialog-CBBIkam9.js";import{B as p}from"./button-ymMXdPy5.js";import{T as F,a as $,b as _,c as r,d as w,e as c}from"./table-BSdxGOLt.js";import{I as y}from"./input-BXXA-PDa.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./index-D0iIn24t.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./createLucideIcon-iWXofaGH.js";import"./x-D2Pel9EU.js";function M({open:g,onOpenChange:m,purchase:o,typeOfTax:P,onAddItems:f}){const[l,d]=k.useState({}),b=(s,a)=>{const i=`item_${s}`;d(a?n=>({...n,[i]:{quantity:"1",notes:""}}):n=>{const e={...n};return delete e[i],e})},u=(s,a,i)=>{const n=`item_${s}`;d(e=>({...e,[n]:{...e[n],[a]:i}}))},I=()=>{const s=[];Object.entries(l).forEach(([a,i])=>{var h,x,j;const n=parseInt(a.replace("item_","")),e=(h=o==null?void 0:o.items)==null?void 0:h[n];e&&parseFloat(i.quantity)>0?s.push({item_id:e.item_id,item_name:e.item_name,item:e.item,chart_of_account_id:(x=e.chart_of_account_id)==null?void 0:x.toString(),chart_of_account:e.chart_of_account,is_stock:e.is_stock,quantity:i.quantity,unit:e.unit,price:e.price,subtotal:(parseFloat(e.price||"0")*parseFloat(i.quantity)).toString(),discount:e.discount,discount_percent:(j=e.discount_percent)==null?void 0:j.toString(),tax:"0",total:(parseFloat(e.price||"0")*parseFloat(i.quantity)).toString(),notes:i.notes}):console.log("Item not added - purchaseItem:",!!e,"quantity > 0:",parseFloat(i.quantity)>0)}),s.length>0&&f(s),d({}),m(!1)},T=()=>{d({}),m(!1)};return t.jsx(q,{open:g,onOpenChange:m,children:t.jsxs(S,{className:"max-h-[80vh] overflow-y-auto max-w-4xl",children:[t.jsx(C,{children:t.jsx(N,{children:"Pilih Item untuk Retur"})}),t.jsx("div",{className:"space-y-4",children:o!=null&&o.items&&o.items.length>0?t.jsxs(F,{children:[t.jsx($,{children:t.jsxs(_,{children:[t.jsx(r,{className:"w-[50px]",children:"Pilih"}),t.jsx(r,{children:"Kode Item"}),t.jsx(r,{children:"Nama Item"}),t.jsx(r,{children:"Jumlah Tersedia"}),t.jsx(r,{children:"Harga"}),t.jsx(r,{children:"Jumlah Retur"}),t.jsx(r,{children:"Catatan"})]})}),t.jsx(w,{children:o.items.map((s,a)=>{var i;return t.jsxs(_,{children:[t.jsx(c,{children:t.jsx("input",{type:"checkbox",checked:!!l[`item_${a}`],onChange:n=>b(a,n.target.checked)})}),t.jsx(c,{children:((i=s.item)==null?void 0:i.code)??"NON STOCK"}),t.jsx(c,{children:s.item_name}),t.jsx(c,{children:s.quantity}),t.jsxs(c,{children:["Rp ",Number.parseInt(s.price||"0").toLocaleString("id-ID")]}),t.jsx(c,{children:l[`item_${a}`]&&t.jsx(y,{type:"number",min:"0",max:s.quantity,value:l[`item_${a}`].quantity,onChange:n=>u(a,"quantity",n.target.value),className:"w-20"})}),t.jsx(c,{children:l[`item_${a}`]&&t.jsx(y,{type:"text",value:l[`item_${a}`].notes,onChange:n=>u(a,"notes",n.target.value),placeholder:"Catatan"})})]},s.item_id||a)})})]}):t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Tidak ada item yang tersedia untuk retur"})}),t.jsxs(v,{children:[t.jsx(p,{type:"button",variant:"outline",onClick:T,children:"Batal"}),t.jsxs(p,{type:"button",onClick:I,disabled:Object.keys(l).length===0,children:["Tambah ke Retur (",Object.keys(l).length," item)"]})]})]})})}export{M as default};
