import{r as o,W as M,a as l,j as t,y as x}from"./app-CQ-G37p-.js";import{h as d}from"./moment-C5S46NFB.js";import{t as q}from"./use-toast-XJEkqv7A.js";import{A as Z}from"./AuthenticatedLayout-X6euxa7E.js";import{B as $}from"./button-ymMXdPy5.js";import{I as u}from"./input-BXXA-PDa.js";import{F as n}from"./form-group-CHZXn8bM.js";import{S as ee}from"./select-remote-C3ahzpc3.js";import{L as ae}from"./label-Blk7FhF1.js";import{T as te}from"./textarea-BvykTLwI.js";import{S as re}from"./SearchCustomer-BbTZ5_2l.js";import{S as se}from"./SearchWarehouse-Bw-VGbhg.js";import{S as oe}from"./SearchDivision-Budjprvk.js";import{S as ie}from"./SearchSalesOrder-ByXoXUsQ.js";import{C as ne}from"./CashCredit-BZxMHD02.js";import{C as de}from"./checkbox-DaA1krf_.js";import me from"./DialogPrint-1MjDufB0.js";import le from"./SaleItemForm-BzHc6leC.js";import ue from"./SaleItemTotal-m3BHMHcm.js";import ce from"./SaleItemList-BUU4L9yW.js";import{I as pe}from"./InputWithHistory-DuCNlgmq.js";import _e from"./ReceivableAlert-CUWp70Wy.js";import{P as he}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./dialog-CBBIkam9.js";import"./table-BSdxGOLt.js";import"./folder-BoHnSs8n.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchItemNonStock-BQ2Ydllm.js";import"./SearchSubUnit-CTrUekdR.js";import"./money-input-Bb590VQ4.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./lodash-Caeo88pO.js";import"./EmptyTable-CjEJGtgb.js";import"./pencil-XLeJOTln.js";import"./trash-C6VGYEst.js";import"./eye-DwuHDobg.js";import"./calendar-days-CaBtbxTM.js";function fe({division:c,warehouse:y,defaultTypeOfTax:O}){var Y,E,k,w,N,P,T;const[v,j]=o.useState(!1),{data:e,setData:r,errors:i,setError:F,clearErrors:R}=M({customer_id:"",type_of_tax_id:O.id,division_id:c.id,division:c,discount:"0",sales_discount:0,sales_discount_percent:0,warehouse_id:y.id,warehouse:y,sale_date:d().format("YYYY-MM-DD"),invoice_number:"",payment_method:"Credit",bank_account_id:"",due_date:d().add(1,"months").format("YYYY-MM-DD"),due_date_days:30,note:"",items:[],tax:0,tax_is_auto:!0,adjustments:[]}),{data:p,setData:g}=M();o.useEffect(()=>{r({...e,due_date:d(e.sale_date).add(1,"months").format("YYYY-MM-DD"),due_date_days:d(e.sale_date).add(1,"months").diff(d(e.sale_date),"days")})},[e.sale_date]),o.useEffect(()=>{e.due_date_days&&r({...e,due_date:d(e.sale_date).add(e.due_date_days,"days").format("YYYY-MM-DD")})},[e.due_date_days]);const[L,A]=o.useState([]);o.useEffect(()=>{async function a(){const{data:s}=await l.get("/admin/sale/receivable",{params:{customer_id:e.customer_id}}),f=s.data;A(f)}a()},[e.customer_id]);const[B,S]=o.useState({}),[G,J]=o.useState();o.useEffect(()=>{async function a(){const s=await l.get(`/admin/type-of-tax/${e.type_of_tax_id}`);J(s.data.data)}a()},[e.type_of_tax_id]);const[m,_]=o.useState({open:!1,isEdit:!1,index:0}),W=async()=>{try{return await l.post("/admin/sale/validate",p),S({}),!0}catch(a){return S(a.response.data.errors),!1}},H=async(a=!1)=>{if(await W()){if(m.isEdit){const s=e.items;s[m.index]=p,r({...e,items:s})}else r("items",[...e.items,p]);_({...m,open:!1}),a&&setTimeout(()=>{C()},1e3)}},[b,V]=o.useState("0"),z=async()=>{j(!0);try{R();const a=await l.post("/admin/sale",{...e,sale_date:d(e.sale_date).format("YYYY-MM-DD")});V(a.data.data.id),h?I(!0):e.payment_method=="Cash"?x.visit(`/admin/cash-in/create?sale_id=${b}`):x.visit("/admin/sale/create"),q({title:"Berhasil",description:"Penjualan berhasil disimpan"})}catch(a){a.response.status==422?F(a.response.data.errors):q({variant:"destructive",title:"Gagal",description:a.response.data.message})}finally{j(!1)}},C=()=>{g({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},price:"0",quantity:"0",discount:"0",discount_percent:0,unit:"",total:"0",subtotal:"0",notes:"",is_stock:!0}),_({open:!0,isEdit:!1,index:0})},K=(a,s)=>{g(s),_({open:!0,isEdit:!0,index:a})},Q=a=>{var s;r({...e,items:(s=e.items)==null?void 0:s.filter((f,X)=>a!=X)})};o.useEffect(()=>{e.sales_order_id&&l.get(`/admin/sales-order/${e.sales_order_id}`).then(a=>{const s=a.data.data;r({...e,sales_order_number:s.number,purchase_order_number:s.purchase_order_number,items:s.items.map(f=>({...f}))})})},[e.sales_order_id]);const[h,D]=o.useState(!1);o.useEffect(()=>{async function a(){const s=localStorage.getItem("sale.print-dialog");D(s==="1")}a()},[]),o.useEffect(()=>{localStorage.setItem("sale.print-dialog",h?"1":"0")},[h]);const[U,I]=o.useState(!1);return t.jsxs("div",{className:"pt-5  px-5",children:[t.jsx(_e,{overdueReceivables:L,customerName:((Y=e.customer)==null?void 0:Y.name)||""}),t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(n,{label:"Pelanggan",error:i.customer_id,name:"customer_id",required:!0,children:t.jsx(re,{value:{id:e.customer_id,code:(E=e.customer)==null?void 0:E.code,name:(k=e.customer)==null?void 0:k.name},onChange:a=>{console.log(a),r({...e,customer_id:a.id,customer:a})}})}),t.jsx(n,{label:"Jenis Pajak",error:i.type_of_tax_id,name:"type_of_tax_id",required:!0,children:t.jsx(ee,{remoteConfig:{url:"/admin/type-of-tax/list",label:a=>a.name,value:a=>a.id.toString()},value:e.type_of_tax_id,onValueChange:a=>{r({...e,type_of_tax_id:a})}})}),t.jsx(n,{label:"Gudang",error:i.warehouse_id,name:"warehouse_id",required:!0,children:t.jsx(se,{value:{id:`${e.warehouse_id}`,code:`${(w=e.warehouse)==null?void 0:w.code}`,name:`${(N=e.warehouse)==null?void 0:N.name}`},onChange:a=>{r({...e,warehouse_id:`${a.id}`,warehouse:a})}})}),t.jsx(n,{label:"Divisi",error:i.division_id,name:"division_id",required:!0,children:t.jsx(oe,{value:{id:e.division_id,code:(P=e.division)==null?void 0:P.code,name:(T=e.division)==null?void 0:T.name},onChange:a=>{r({...e,division_id:a.id,division:a})},clearable:!0})}),t.jsx(n,{label:"Tanggal",error:i.sale_date,name:"sale_date",required:!0,children:t.jsx(u,{type:"date",value:e.sale_date,onChange:a=>{r({...e,sale_date:a.target.value})}})}),t.jsx(n,{label:"No.",error:i.no,name:"no",required:!0,children:t.jsx(pe,{historyColumns:["no","sale_date"],searchColumn:"no",endpoint:"/admin/sale/history",placeholder:"Biarkan kosong untuk otomatis",value:e.no??"",onChange:a=>{r({...e,no:a})}})}),t.jsx(n,{label:"No. SO",error:i.sales_order_number,name:"sales_order_number",children:t.jsx(ie,{customerId:e.customer_id,value:{id:e.sales_order_id,number:e.sales_order_number},onChange:a=>{r({...e,sales_order_id:a.id,sales_order_number:a.number})}})}),t.jsx(n,{label:"No. PO",error:i.purchase_order_number,name:"purchase_order_number",children:t.jsx(u,{type:"text",value:e.purchase_order_number,onChange:a=>{r({...e,purchase_order_number:a.target.value})}})}),t.jsx(n,{label:"Metode Pembayaran",error:i.payment_method,name:"payment_method",required:!0,children:t.jsx(ne,{value:e.payment_method??"Credit",onChange:a=>{r({...e,payment_method:a})}})}),t.jsx(n,{label:"Faktur Pajak",error:i.tax_invoice_number,name:"tax_invoice_number",required:!0,children:t.jsx(u,{type:"text",value:e.tax_invoice_number,onChange:a=>{r({...e,tax_invoice_number:a.target.value})}})}),e.payment_method=="Credit"&&t.jsxs(t.Fragment,{children:[t.jsx(n,{label:"Lama Jatuh Tempo (Hari)",error:i.due_date_days,name:"due_date_days",required:!0,children:t.jsx(u,{type:"number",className:"text-right",value:e.due_date_days,onChange:a=>{r({...e,due_date_days:Number.parseInt(a.target.value)})}})}),t.jsx(n,{label:"Jatuh Tempo",error:i.due_date,name:"due_date",children:t.jsx(u,{type:"date",value:e.due_date,onChange:a=>{r({...e,due_date:a.target.value})}})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(n,{label:"Catatan",error:i.note,name:"note",children:t.jsx(te,{value:e.note,onChange:a=>{r({...e,note:a.target.value})}})})}),t.jsx("div",{className:"col-span-3",children:t.jsxs(n,{error:i.items,children:[t.jsx(ce,{items:e.items??[],onEdit:K,onDelete:Q}),t.jsx($,{className:"w-full",onClick:C,children:t.jsx(he,{})})]})}),t.jsx("div",{className:"col-span-3",children:t.jsx(ue,{data:e,type_ofTax:G,setData:r})})]}),t.jsx("div",{className:"mb-3",children:t.jsxs(ae,{className:"",children:[t.jsx(de,{className:"mr-2",checked:h,onCheckedChange:a=>{D(a)}}),t.jsx("span",{children:"Tampilkan Dialog Print"})]})}),t.jsx($,{type:"button",onClick:z,disabled:v,children:v?"Menyimpan...":"Simpan"}),t.jsx(le,{formDialog:m,data:p,setData:g,onOpenChange:()=>{_({...m,open:!1})},errors:B,warehouse_id:e.warehouse_id,onSave:H}),t.jsx(me,{open:U,onOpenChange:a=>{I(a),a===!1&&(e.payment_method=="Cash"?x.visit(`/admin/cash-in/create?sale_id=${b}`):x.visit("/admin/sale/create"))},id:b})]})}fe.layout=c=>t.jsx(Z,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Penjualan",href:"/admin/sale"},{label:"Tambah",href:"#"}],children:c});export{fe as default};
