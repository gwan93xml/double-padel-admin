import{W as T,r as D,j as t,a as w,y as Y}from"./app-CQ-G37p-.js";import{B as j}from"./button-ymMXdPy5.js";import{I as q}from"./input-BXXA-PDa.js";import{T as Q}from"./textarea-BvykTLwI.js";import{T as $,a as L,b as f,c as d,d as V,e as o}from"./table-BSdxGOLt.js";import{F as c}from"./form-group-CHZXn8bM.js";import{S as X}from"./SearchDivision-Budjprvk.js";import{S as F}from"./SearchWarehouse-Bw-VGbhg.js";import{t as g}from"./use-toast-XJEkqv7A.js";import{h as B}from"./moment-C5S46NFB.js";import Z from"./ItemForm-BeiietLR.js";import{P as ee}from"./pencil-XLeJOTln.js";import{T as te}from"./trash-C6VGYEst.js";import{P as se}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./label-Blk7FhF1.js";import"./index-DqZ46QiR.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./dialog-CBBIkam9.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./SearchItem-DGpcvLrN.js";import"./badge-CsIJHFj0.js";import"./package-Cd0mGsRo.js";import"./SearchSubUnit-CTrUekdR.js";import"./select-BSIJzAmS.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";function Re({mode:P,initialData:v,division:h}){var k,b,y,C,E,M,S,N;const u=P==="edit",G=u&&v?v:{date:B().format("YYYY-MM-DD"),division_id:(h==null?void 0:h.id)||"",division:h||null,warehouse_out_id:"",warehouse_in_id:"",remarks:"",items:[]},{data:s,setData:a,errors:n,setError:R,clearErrors:z}=T(G),{data:p,setData:r}=T({}),[A,I]=D.useState({}),[l,m]=D.useState({show:!1,isEdit:!1,stockMovementItemIndex:0}),H=async()=>{try{return await w.post("/admin/stock-movement/validate",p),I({}),!0}catch(e){return I(e.response.data.errors),!1}},U=async()=>{if(await H())if(l.isEdit){const e=s.items;e[l.stockMovementItemIndex]=p,a({...s,items:e}),m({show:!1,isEdit:!1,stockMovementItemIndex:0})}else a("items",[...s.items,p]),r({item_id:"",item:void 0,quantity:"0",unit:"",notes:""}),m({show:!1,isEdit:!1,stockMovementItemIndex:0}),setTimeout(()=>{m({show:!0,isEdit:!1,stockMovementItemIndex:0})},300)},W=async()=>{try{z();const e={...s,date:B(s.date).format("YYYY-MM-DD")};u?(await w.put(`/admin/stock-movement/${s.id}`,e),Y.visit("/admin/stock-movement"),g({title:"Berhasil",description:"Pindah gudang berhasil diubah"})):(await w.post("/admin/stock-movement",e),Y.visit("/admin/stock-movement/create"),g({title:"Berhasil",description:"Pindah gudang berhasil disimpan"}))}catch(e){e.response.status==422?R(e.response.data.errors):g({title:"Gagal",description:e.response.data.message,variant:"destructive"})}},J=()=>{r({item_id:"",item:void 0,quantity:"0",unit:"",notes:""}),m({show:!0,isEdit:!1,stockMovementItemIndex:0})},K=(e,i)=>{r(i),m({show:!0,isEdit:!0,stockMovementItemIndex:e})},O=e=>()=>{var i;a({...s,items:(i=s.items)==null?void 0:i.filter((_,x)=>e!=x)})};return t.jsxs("div",{className:"pt-5 px-5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-x-4 gap-y-4 mb-3",children:[t.jsx(c,{name:"division_id",label:"Divisi",required:!0,error:n.division_id,children:t.jsx(X,{value:{id:s.division_id??"",code:((k=s.division)==null?void 0:k.code)??"",name:((b=s.division)==null?void 0:b.name)??""},onChange:e=>{a({...s,division_id:e.id,division:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(c,{name:"number",label:"Nomor",required:!0,error:n.number,children:t.jsx(q,{disabled:!0,type:"text",value:u?s.number??"":"???",onChange:e=>a("number",e.target.value)})}),t.jsx(c,{name:"date",label:"Tanggal",required:!0,error:n.date,children:t.jsx(q,{type:"date",value:s.date,onChange:e=>a("date",e.target.value)})}),t.jsx(c,{label:"Gudang Keluar",error:n.warehouse_out_id,name:"warehouse_out_id",children:t.jsx(F,{value:{id:s.warehouse_out_id??"",code:((y=s.warehouse_out)==null?void 0:y.code)??"",name:((C=s.warehouse_out)==null?void 0:C.name)??""},onChange:e=>{a({...s,warehouse_out_id:e.id,warehouse_out:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(c,{label:"Gudang Masuk",error:n.warehouse_in_id,name:"warehouse_in_id",children:t.jsx(F,{value:{id:s.warehouse_in_id??"",code:((E=s.warehouse_in)==null?void 0:E.code)??"",name:((M=s.warehouse_in)==null?void 0:M.name)??""},onChange:e=>{a({...s,warehouse_in_id:e.id,warehouse_in:{id:e.id,code:e.code,name:e.name}})}})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(c,{label:"Catatan",error:n.remarks,name:"remarks",children:t.jsx(Q,{value:s.remarks,onChange:e=>{a({...s,remarks:e.target.value})}})}),t.jsxs($,{children:[t.jsx(L,{children:t.jsxs(f,{children:[t.jsx(d,{className:"w-[10px]",children:"#"}),t.jsx(d,{children:"Item"}),t.jsx(d,{children:"Jumlah"}),t.jsx(d,{children:"Satuan"}),t.jsx(d,{children:"Catatan"}),t.jsx(d,{className:"w-[100px]",children:"Aksi"})]})}),t.jsx(V,{children:((S=s.items)==null?void 0:S.length)==0?t.jsx(f,{children:t.jsx(o,{colSpan:6,className:"text-center py-4 text-gray-500",children:"Belum ada item yang ditambahkan"})}):(N=s.items)==null?void 0:N.map((e,i)=>{var _,x;return t.jsxs(f,{children:[t.jsx(o,{children:i+1}),t.jsxs(o,{children:[(_=e.item)==null?void 0:_.name," (",(x=e.item)==null?void 0:x.code,")"]}),t.jsx(o,{className:"text-right",children:e.quantity}),t.jsx(o,{children:e.unit}),t.jsx(o,{children:e.notes}),t.jsx(o,{children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(j,{size:"sm",variant:"outline",onClick:()=>K(i,e),children:t.jsx(ee,{className:"w-4 h-4"})}),t.jsx(j,{size:"sm",variant:"outline",onClick:O(i),children:t.jsx(te,{className:"w-4 h-4"})})]})})]},i)})})]}),t.jsxs(j,{className:"w-full mt-4",onClick:J,children:[t.jsx(se,{className:"w-4 h-4 mr-2"}),"Tambah Item"]})]})]}),t.jsx(j,{type:"button",onClick:W,children:u?"Ubah":"Simpan"}),t.jsx(Z,{show:l.show,isEdit:l.isEdit,item:p,errors:A,warehouseOutId:s.warehouse_out_id??"",onClose:()=>m({...l,show:!1}),onSave:U,onItemChange:e=>{r(i=>({...i,item_id:e.id,item:{id:e.id,code:e.code,name:e.name,unit:e.unit,purchase_price:e.purchase_price,selling_price:e.selling_price}}))},onQuantityChange:e=>{r(i=>({...i,quantity:e}))},onUnitChange:e=>{r(i=>({...i,unit:e}))},onNotesChange:e=>{r(i=>({...i,notes:e}))},onFocusSearchItem:()=>{}})]})}export{Re as default};
