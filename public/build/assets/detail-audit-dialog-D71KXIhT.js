import{r as m,j as e,a as W}from"./app-CQ-G37p-.js";import{D as X,f as Z,a as $,b as F,c as ee,e as se}from"./dialog-CBBIkam9.js";import{B as te}from"./button-ymMXdPy5.js";import{B as O}from"./badge-CsIJHFj0.js";import{H as p,S as ae}from"./scroll-area-Db0TZtic.js";import{h as c}from"./moment-C5S46NFB.js";import{C as re}from"./circle-alert-DNqBTniX.js";import{C as le}from"./AuthenticatedLayout-X6euxa7E.js";const ue=({auditableType:j,keyField:d,valueField:o,trigger:I,title:R="Riwayat Perubahan Detail",description:V="Lihat semua perubahan yang terkait dengan data ini"})=>{const[h,G]=m.useState(!1),[i,P]=m.useState([]),[u,f]=m.useState(!1),[x,g]=m.useState(null),U=async()=>{var t,a;f(!0),g(null);try{const r=await W.get("/admin/audits",{params:{auditable_type:j,key:d,value:o}});P(r.data.data||[])}catch(r){g(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Gagal memuat audit logs"),console.error("Error fetching audit logs:",r)}finally{f(!1)}};m.useEffect(()=>{h&&U()},[h,j,d,o]);const z=t=>{switch(t){case"created":return"bg-green-50 text-green-700 border-green-200";case"updated":return"bg-blue-50 text-blue-700 border-blue-200";case"deleted":return"bg-red-50 text-red-700 border-red-200";case"restored":return"bg-green-50 text-green-700 border-green-200";default:return"bg-gray-50 text-gray-"}},n=t=>t==null?"-":typeof t=="boolean"?t?"Ya":"Tidak":typeof t=="object"?JSON.stringify(t,null,2):typeof t=="string"&&/^\d{4}-\d{2}-\d{2}/.test(t)?c(t).format("DD/MM/YYYY HH:mm"):String(t),N=t=>{const a={};return t.forEach(r=>{const s=c(r.created_at).format("YYYY-MM-DD HH:mm");a[s]||(a[s]=[]),a[s].push(r)}),a},l=(t,a)=>t&&t[a]!==void 0?t[a]:"-",J=()=>{const t=N(i);return Object.entries(t).sort(([a],[r])=>c(r).diff(c(a))).map(([a,r])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-3 border rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 "}),e.jsx("span",{className:"font-medium ",children:c(a).format("DD/MM/YYYY HH:mm")}),e.jsxs(O,{variant:"secondary",className:"ml-auto",children:[r.length," perubahan"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse  rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"Item"}),e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"Quantity"}),e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"Price"}),e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"Subtotal"}),e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"Event"}),e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"User"}),e.jsx("th",{className:" px-3 py-2 text-left text-sm font-medium ",children:"Time"})]})}),e.jsx("tbody",{children:r.map((s,Q)=>{var y,b,v,w,_,D,k,Y,H,S,C,M,A,E,q,T,B,L;return e.jsxs("tr",{className:(Q%2===0,""),children:[e.jsxs("td",{className:" px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:l(s.new_values,"item_name")||l(s.old_values,"item_name")}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",l(s.new_values,"item_id")||l(s.old_values,"item_id")]})]}),e.jsx("td",{className:" px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[((y=s.old_values)==null?void 0:y.quantity)!==((b=s.new_values)==null?void 0:b.quantity)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-600 line-through",children:l(s.old_values,"quantity")}),e.jsx("span",{className:"text-green-600 font-medium",children:l(s.new_values,"quantity")})]}),((v=s.old_values)==null?void 0:v.quantity)===((w=s.new_values)==null?void 0:w.quantity)&&e.jsx("span",{children:l(s.new_values,"quantity")})]})}),e.jsx("td",{className:" px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[((_=s.old_values)==null?void 0:_.price)!==((D=s.new_values)==null?void 0:D.price)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-600 line-through",children:n((k=s.old_values)==null?void 0:k.price)}),e.jsx("span",{className:"text-green-600 font-medium",children:n((Y=s.new_values)==null?void 0:Y.price)})]}),((H=s.old_values)==null?void 0:H.price)===((S=s.new_values)==null?void 0:S.price)&&e.jsx("span",{children:n((C=s.new_values)==null?void 0:C.price)})]})}),e.jsx("td",{className:" px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[((M=s.old_values)==null?void 0:M.subtotal)!==((A=s.new_values)==null?void 0:A.subtotal)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-600 line-through",children:n((E=s.old_values)==null?void 0:E.subtotal)}),e.jsx("span",{className:"text-green-600 font-medium",children:n((q=s.new_values)==null?void 0:q.subtotal)})]}),((T=s.old_values)==null?void 0:T.subtotal)===((B=s.new_values)==null?void 0:B.subtotal)&&e.jsx("span",{children:n((L=s.new_values)==null?void 0:L.subtotal)})]})}),e.jsx("td",{className:" px-3 py-2 text-sm",children:e.jsx(O,{variant:"outline",className:z(s.event),children:s.event.toUpperCase()})}),e.jsx("td",{className:" px-3 py-2 text-sm",children:s.user?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.user.email})]}):e.jsx("span",{className:"text-gray-500",children:"System"})}),e.jsx("td",{className:" px-3 py-2 text-sm text-gray-500",children:c(s.created_at).format("HH:mm:ss")})]},s.id)})})]})})]},a))},K=e.jsxs(te,{variant:"outline",size:"sm",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"Riwayat Detail"]});return e.jsxs(X,{open:h,onOpenChange:G,children:[e.jsx(Z,{asChild:!0,children:I||K}),e.jsxs($,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(F,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"}),R]}),e.jsx(se,{children:V}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Mencari audit untuk: ",e.jsxs("strong",{children:[d," = ",o]})]})]})})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[u&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Memuat riwayat..."})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[e.jsx(re,{className:"h-5 w-5"}),x]}),!u&&!x&&i.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(p,{className:"h-12 w-12 mb-4 "}),e.jsx("p",{children:"Tidak ada riwayat perubahan untuk data ini"}),e.jsxs("p",{className:"text-sm mt-2",children:["Key: ",d,", Value: ",o]})]}),!u&&!x&&i.length>0&&e.jsxs(ae,{className:"h-[60vh] pr-4",children:[e.jsx("div",{className:"mb-4 p-3  border rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:" font-medium",children:["ðŸ“Š Total ",i.length," perubahan dalam ",Object.keys(N(i)).length," kelompok waktu"]}),e.jsx("span",{className:"",children:"Dikelompokkan per menit untuk memudahkan tracking"})]})}),J()]})]})]})]})};export{ue as D};
