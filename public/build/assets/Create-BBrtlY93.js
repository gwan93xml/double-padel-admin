import{W as f,r as m,j as e,a as te,y as H}from"./app-CQ-G37p-.js";import{h as u}from"./moment-C5S46NFB.js";import{t as _}from"./use-toast-XJEkqv7A.js";import{A as ie}from"./AuthenticatedLayout-X6euxa7E.js";import{B as W}from"./button-ymMXdPy5.js";import{T as ce,a as oe,b as N,c as n,d as ne,e as i}from"./table-BSdxGOLt.js";import{I as $}from"./input-BXXA-PDa.js";import{F as d}from"./form-group-CHZXn8bM.js";import{T as le}from"./textarea-BvykTLwI.js";import{E as de}from"./EmptyTable-CjEJGtgb.js";import{S as me}from"./SearchDivision-Budjprvk.js";import{S as ue}from"./SearchCustomer-BbTZ5_2l.js";import he from"./ReceivabletList-C9Wh7RF1.js";import{C as h}from"./currency-formatter-D5vTOkIG.js";import xe from"./AccountReceivableForm-BiJfjjuU.js";import{P as pe}from"./ProcessingButton-Da7kiAJ4.js";import{T as je}from"./trash-C6VGYEst.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./checkbox-DaA1krf_.js";import"./index-CZ_DqijM.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";function ve({division:x}){var Y,y,C,k,S,E,M,P,F,R,A,z,B,q;const{data:s,setData:c,errors:l,setError:J,clearErrors:K}=f({date:u().format("YYYY-MM-DD"),division_id:x.id,division:x,customer_id:"",account_receivables:[]}),{data:be,setData:O}=f({}),[Q,D]=m.useState(!1),[U,w]=m.useState({show:!1,isEdit:!1,itemInItemIndex:0}),V=async()=>{const a=s.account_receivables;a[v.index]=I,c({...s,account_receivables:a}),b({...v,show:!1,index:-1})},X=()=>e.jsx(he,{formDialog:U,setFormDialog:w,customer_id:s.customer_id,onChange:a=>{const r=a.map(t=>({receivable_id:t.id,receivable:t,discount:0,paid_amount:t.remaining_amount}));c("account_receivables",[...s.account_receivables,...r])}}),Z=async()=>{var a,r,t;D(!0);try{K();const o=await te.post("/admin/account-receivable",{...s,date:u(s.date).format("YYYY-MM-DD")});if(s.account_receivables.reduce((p,j)=>p+(j.paid_amount??0),0)===0){_({title:"Berhasil",description:"Penerimaan piutang berhasil dicatat tanpa kas masuk"}),H.visit("/admin/account-receivable");return}H.visit(`/admin/cash-in/create?account_receivable_header=${o.data.data.id}`),_({title:"Berhasil",description:"Penerimaan piutang berhasil disimpan, silakan proses kas masuk."})}catch(o){((a=o.response)==null?void 0:a.status)==422?J(o.response.data.errors):_({variant:"destructive",title:"Gagal",description:((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.message)??o.message})}finally{D(!1)}};m.useEffect(()=>{const a=localStorage.getItem("account_receivable_header.date");a&&c("date",a)},[]),m.useEffect(()=>{localStorage.setItem("account_receivable_header.date",s.date)},[s.date]);const ee=()=>{O({item_id:"",item:{code:"",name:""},quantity:"0",price:"0",remarks:""}),w({show:!0,isEdit:!1,itemInItemIndex:0})},{data:I,setData:T}=f({}),[v,b]=m.useState({show:!1,index:-1}),ae=(a,r)=>{T(r),b({show:!0,index:a})},se=a=>{c({...s,account_receivables:s.account_receivables.filter((r,t)=>a!=t)})};return e.jsxs("div",{className:"pt-5  px-5",children:[e.jsxs("div",{className:"md:flex gap-x-1",children:[e.jsxs("div",{className:"w-full md:w-3/5",children:[e.jsx(d,{name:"division_id",label:"Divisi",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(me,{value:{id:s.division_id??"",code:((Y=s.division)==null?void 0:Y.code)??"",name:((y=s.division)==null?void 0:y.name)??""},onChange:a=>{c({...s,division_id:a.id,division:a})}})}),e.jsx(d,{name:"text",label:"Nomor",required:!0,error:l.number,horizontal:!0,children:e.jsx($,{type:"text",value:"???",disabled:!0,onChange:a=>c("number",a.target.value)})}),e.jsx(d,{name:"date",label:"Tanggal",required:!0,error:l.date,horizontal:!0,children:e.jsx($,{type:"date",value:s.date,onChange:a=>c("date",a.target.value)})}),e.jsx(d,{name:"customer_id",label:"Customer",required:!0,error:l.customer_id,horizontal:!0,children:e.jsx(ue,{value:{id:s.customer_id??"",code:((C=s.customer)==null?void 0:C.code)??"",name:((k=s.customer)==null?void 0:k.name)??""},onChange:a=>{c({...s,customer_id:a.id,customer:a})}})}),e.jsx(d,{label:"Catatan",error:l.remarks,name:"remarks",horizontal:!0,children:e.jsx(le,{value:s.remarks,onChange:a=>c("remarks",a.target.value)})})]}),e.jsxs("div",{className:"w-full md:w-2/3 bg-blue-300 p-2 rounded",children:[e.jsx("div",{children:e.jsx("strong",{children:(S=s.customer)==null?void 0:S.name})}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[15%]",children:"Telepon"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(E=s.customer)==null?void 0:E.phone]}),e.jsx("td",{className:"w-[15%]",children:"Term Crd"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(M=s.customer)==null?void 0:M.term_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Fax"}),e.jsxs("td",{children:[": ",(P=s.customer)==null?void 0:P.fax]}),e.jsx("td",{children:"Max Crd"}),e.jsxs("td",{children:[": ",(F=s.customer)==null?void 0:F.max_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Expired"}),e.jsxs("td",{children:[": ",(R=s.customer)==null?void 0:R.expired]}),e.jsx("td",{}),e.jsx("td",{})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4 mb-3",children:[e.jsx("div",{className:"col-span-3"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-4/5",children:e.jsx(d,{error:l.account_receivables,children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(N,{children:[e.jsx(n,{className:"w-1/5",children:"No"}),e.jsx(n,{className:"text-right",children:"Discount"}),e.jsx(n,{className:"text-right",children:"Bayar"}),e.jsx(n,{className:"text-right",children:"Total"}),e.jsx(n,{className:"text-right",children:"Sisa Piutang"}),e.jsx(n,{children:"Tanggal"}),e.jsx(n,{children:"Pelanggan"}),e.jsx(n,{children:"Divisi"}),e.jsx(n,{className:"w-[100px]",children:"Aksi"})]})}),e.jsx(ne,{children:((A=s.account_receivables)==null?void 0:A.length)==0?e.jsx(N,{children:e.jsx(i,{colSpan:9,className:"text-center",children:e.jsx(de,{})})}):(z=s.account_receivables)==null?void 0:z.map((a,r)=>{var t,o,g,p,j,L,G;return e.jsxs(N,{onClick:()=>ae(r,a),className:"cursor-pointer hover:bg-slate-100",children:[e.jsxs(i,{children:[((t=a.receivable)==null?void 0:t.purchase_order_number)??"",a.receivable.sales_deposit?a.receivable.sales_deposit.number:""]}),e.jsx(i,{children:e.jsx(h,{amount:a.discount})}),e.jsx(i,{children:e.jsx(h,{amount:a.paid_amount})}),e.jsx(i,{children:e.jsx(h,{amount:a.discount+a.paid_amount})}),e.jsx(i,{children:e.jsx(h,{amount:((o=a.receivable)==null?void 0:o.remaining_amount)??0})}),e.jsx(i,{children:a.receivable.date?e.jsx(e.Fragment,{children:u(a.receivable.date).format("DD/MM/YYYY")}):e.jsxs(e.Fragment,{children:[a.receivable.sale?u((g=a.receivable)==null?void 0:g.sale.sale_date).format("DD/MM/YYYY"):"",a.receivable.sales_deposit?u((p=a.receivable)==null?void 0:p.sales_deposit.date).format("DD/MM/YYYY"):""]})}),e.jsx(i,{children:(j=a.receivable)==null?void 0:j.customer.name}),e.jsx(i,{children:(G=(L=a.receivable)==null?void 0:L.division)==null?void 0:G.name}),e.jsx(i,{children:e.jsx(W,{size:"sm",variant:"destructive",onClick:re=>{re.stopPropagation(),se(r)},children:e.jsx(je,{size:24})})})]},r)})})]})})}),e.jsxs("div",{className:"w-1/5 bg-green-500 p-2 rounded",children:[e.jsxs("div",{children:["Item : ",(B=s.account_receivables)==null?void 0:B.length]}),e.jsxs("div",{className:"flex gap-x-1",children:[e.jsx("div",{children:"Total :"}),e.jsx(h,{amount:(q=s.account_receivables)==null?void 0:q.reduce((a,r)=>a+(r.paid_amount??0),0)})]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(W,{onClick:ee,variant:"outline",disabled:s.customer_id=="",children:"Tambah dari list"})})]})]}),e.jsx(pe,{type:"button",processing:Q,onClick:Z,label:"Simpan",processingLabel:"Menyimpan"}),X(),e.jsx(xe,{accountReceivableFormDialog:v,setAccountReceivableFormDialog:b,accountReceivable:I,setAccountReceivable:T,onSaveItem:V})]})}ve.layout=x=>e.jsx(ie,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Akuntansi",href:"#"},{label:"Penerimaan Piutang",href:"/admin/account-receivable"},{label:"Tambah",href:"#"}],children:x});export{ve as default};
