import{W as A,r as p,j as e,a as K,y as Y}from"./app-CQ-G37p-.js";import{S as Z}from"./SearchChartOfAccount-0Jd4yGJY.js";import{S as ee}from"./SearchDivision-Budjprvk.js";import{B as m}from"./button-ymMXdPy5.js";import{C as ae}from"./checkbox-DaA1krf_.js";import{C as j}from"./currency-formatter-D5vTOkIG.js";import{D as te,a as re,c as se,d as ie}from"./dialog-CBBIkam9.js";import{F as n}from"./form-group-CHZXn8bM.js";import{I as v}from"./input-BXXA-PDa.js";import{L as oe}from"./label-Blk7FhF1.js";import{M as q}from"./money-input-Bb590VQ4.js";import{T as ne,a as le,b as C,c,d as de,e as o,f as ce}from"./table-BSdxGOLt.js";import{T as P}from"./textarea-BvykTLwI.js";import{A as he}from"./AuthenticatedLayout-X6euxa7E.js";import{t as B}from"./use-toast-XJEkqv7A.js";import{P as ue}from"./pencil-XLeJOTln.js";import{T as me}from"./trash-C6VGYEst.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./file-text-vhY6aTSF.js";import"./index-D0iIn24t.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./tslib.es6-eMSY344_.js";import"./index-CZ_DqijM.js";import"./index-B9VoEdXn.js";import"./index-uJ2KZHf0.js";import"./index-BHS3gC_j.js";import"./index-C7S3ohsj.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./moment-C5S46NFB.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function xe({cashOut:D,total_debit:R}){var S,k,I,O,F;const{data:r,setData:l,clearErrors:L,errors:h,setError:M}=A(D),[_,N]=p.useState(!1),[f,T]=p.useState(!1);p.useEffect(()=>{async function a(){const t=localStorage.getItem("cash-out.print-dialog");T(t==="1")}a()},[]),p.useEffect(()=>{localStorage.setItem("cash-out.print-dialog",f?"1":"0")},[f]);async function z(a){N(!0),L();try{const{data:t}=await K.put(`/admin/cash-out/${r.id}`,r);B({variant:"default",title:"Berhasil",description:"Kas keluar berhasil diubah"}),f&&window.open(`/admin/cash-out/${t.data.id}/print`,"_blank"),Y.visit("/admin/cash-out")}catch(t){if(t.response.status===422){const i=t.response.data.errors;M(i)}else B({title:"Error",description:t.response.data.message,variant:"destructive"})}finally{N(!1)}}const[d,x]=p.useState({show:!1,isEdit:!1,detailIndex:-1}),{data:s,setData:u,errors:b,setError:H,clearErrors:V}=A({});function $(){x({show:!0,isEdit:!1,detailIndex:-1}),u({chart_of_account:{id:"",name:"",code:""},chart_of_account_id:"",debit:"0",credit:"0",description:""})}const G=async()=>{try{return await K.post("/admin/cash-out/validate",s),V(),!0}catch(a){return H(a.response.data.errors),!1}};async function U(){await G()&&(d.isEdit?l(a=>{const t=[...a.details];return t[d.detailIndex]=s,{...a,details:t}}):l(a=>({...a,details:[...a.details,s]})),x({...d,show:!1,isEdit:!1,detailIndex:-1}))}async function W(a){x({show:!0,isEdit:!0,detailIndex:a}),u(r.details[a])}function J(a){l(t=>{const i=[...t.details];return i.splice(a,1),{...t,details:i}})}function Q(){return e.jsx("span",{className:"font-bold",children:e.jsx(j,{amount:E()})})}function X(){return e.jsx("span",{className:"font-bold",children:e.jsx(j,{amount:y()})})}function E(){var t;let a=((t=r.details)==null?void 0:t.reduce((i,g)=>i+parseFloat(g.debit),0))??0;return a=a+R,a}function y(){var a;return((a=r.details)==null?void 0:a.reduce((t,i)=>t+parseFloat(i.credit),0))??0}function w(){const a=E(),t=y();return a-t}return e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[e.jsx(n,{label:"Divisi",name:"division_id",required:!0,error:h.division_id,children:e.jsx(ee,{value:{id:r.division_id,name:(S=r.division)==null?void 0:S.name,code:(k=r.division)==null?void 0:k.code},onChange:a=>{l({...r,division_id:a.id,division:a})}})}),e.jsx(n,{label:"Nomor",name:"number",required:!0,error:h.number,children:e.jsx(v,{disabled:!0,value:r.number})}),e.jsx(n,{label:"Tanggal",name:"date",required:!0,error:h.date,children:e.jsx(v,{type:"date",value:r.date,onChange:a=>{l({...r,date:a.target.value})}})}),e.jsx(n,{label:"Dibayar Kepada",name:"paid_to",required:!0,error:h.paid_to,children:e.jsx(v,{type:"text",value:r.paid_to,onChange:a=>{l({...r,paid_to:a.target.value})}})}),e.jsx("div",{className:"col-span-3",children:e.jsx(n,{label:"Catatan",name:"description",required:!0,error:h.description,children:e.jsx(P,{value:r.description,onChange:a=>{l({...r,description:a.target.value})}})})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(n,{error:h.details,children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(C,{children:[e.jsx(c,{className:"w-[10px]",children:"NO."}),e.jsx(c,{children:"KODE"}),e.jsx(c,{children:"PERKIRAAN"}),e.jsx(c,{className:"text-end",children:"DEBET"}),e.jsx(c,{className:"text-end",children:"KREDIT"}),e.jsx(c,{children:"CATATAN"}),e.jsx(c,{className:"w-[50px]",children:"AKSI"})]})}),e.jsx(de,{children:(I=r.details)==null?void 0:I.map((a,t)=>{var i,g;return e.jsxs(C,{children:[e.jsx(o,{className:"text-center",children:t+1}),e.jsx(o,{children:(i=a.chart_of_account)==null?void 0:i.code}),e.jsx(o,{children:(g=a.chart_of_account)==null?void 0:g.name}),e.jsx(o,{children:e.jsx(j,{amount:parseFloat(a.debit)??0})}),e.jsx(o,{children:e.jsx(j,{amount:parseFloat(a.credit)??0})}),e.jsx(o,{children:a.description}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(m,{variant:"link",size:"sm",onClick:()=>W(t),children:e.jsx(ue,{})}),e.jsx(m,{variant:"destructive",size:"sm",onClick:()=>J(t),children:e.jsx(me,{})})]})})]},t)})}),e.jsx(ce,{children:e.jsxs(C,{children:[e.jsx(o,{colSpan:3,className:"text-right font-bold",children:"Total"}),e.jsx(o,{className:"text-end font-bold",children:Q()}),e.jsx(o,{className:"text-end font-bold",children:X()}),e.jsx(o,{colSpan:2,className:"text-end font-bold",children:w()!==0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Selisih:"}),e.jsx(j,{amount:w()})]}):null})]})})]})}),e.jsx(m,{className:"w-full",onClick:$,children:"Tambah Detail"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs(oe,{className:"",children:[e.jsx(ae,{className:"mr-2",checked:f,onCheckedChange:a=>{T(a)}}),e.jsx("span",{children:"Print"})]})}),e.jsx("div",{className:"col-span-3",children:e.jsx(m,{onClick:z,disabled:_,children:_?"Mengubah...":"Ubah"})})]}),e.jsx(te,{open:d.show,onOpenChange:a=>{x({...d,show:a})},children:e.jsxs(re,{className:" max-h-[80vh] overflow-y-auto",children:[e.jsx(se,{children:"Detail"}),e.jsxs(e.Fragment,{children:[e.jsx(n,{label:"Perkiraan",error:b.chart_of_account_id,required:!0,children:e.jsx(Z,{value:{id:s.chart_of_account_id,name:(O=s.chart_of_account)==null?void 0:O.name,code:(F=s.chart_of_account)==null?void 0:F.code},onChange:a=>{u({...s,chart_of_account:a,chart_of_account_id:a.id})}})}),e.jsx(n,{label:"Debet",name:"debit",required:!0,error:b.debit,children:e.jsx(q,{value:s.debit,onValueChange:a=>{u({...s,debit:a})}})}),e.jsx(n,{label:"Kredit",name:"credit",required:!0,error:b.credit,children:e.jsx(q,{value:s.credit,onValueChange:a=>{u({...s,credit:a})}})}),e.jsx(n,{label:"Keterangan",name:"description",required:!0,error:b.description,children:e.jsx(P,{value:s.description,onChange:a=>{u({...s,description:a.target.value})}})})]}),e.jsxs(ie,{children:[e.jsx(m,{variant:"outline",onClick:()=>{x({...d,show:!1})},children:"Tutup"}),e.jsx(m,{onClick:U,children:d.isEdit?"Simpan":"Tambah"})]})]})})]})}xe.layout=D=>e.jsx(he,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Akuntansi",href:"#"},{label:"Kas Keluar",href:"/admin/cash-out"},{label:"Edit",href:"#"}],children:D});export{xe as default};
