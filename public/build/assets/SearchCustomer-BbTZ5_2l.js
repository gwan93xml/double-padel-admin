import{r,a as B,j as s}from"./app-CQ-G37p-.js";import{B as z}from"./button-ymMXdPy5.js";import{I as A}from"./input-BXXA-PDa.js";import{C as W,d as Z}from"./card-Bq41eL_q.js";import{L as H}from"./loader-circle-i2ANfqrZ.js";import{S as ee}from"./search-B9EA-nRY.js";import{X as te}from"./x-D2Pel9EU.js";function le({onChange:N,value:l,clearable:_}){const[n,h]=r.useState({id:"",code:"",name:"",phone:""}),[j,u]=r.useState(!1),[D,a]=r.useState(""),[p,d]=r.useState([]),[P,o]=r.useState(!1),[y,b]=r.useState(1),[L,C]=r.useState(!0),[x,K]=r.useState(!1),[se,k]=r.useState(""),i=r.useRef(null),Q=200,I=r.useRef(null),w=r.useRef(null),$=r.useRef(!1),g=r.useRef(null),v=r.useRef(null),[m,f]=r.useState(null);r.useEffect(()=>{l&&h({id:l.id||"",code:l.code||"",name:l.name||"",phone:l.phone||""})},[l]),r.useEffect(()=>{if(!j&&!x&&m){const t=setTimeout(()=>{m==="code"&&g.current?g.current.focus():m==="name"&&v.current&&v.current.focus()},0);return()=>clearTimeout(t)}},[j,x,m]),r.useEffect(()=>{const t=e=>{I.current&&!I.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const U=t=>{const e=t.target.value;f("code"),h({...n,code:e}),k(e),O(e,!0),a("")},X=t=>{const e=t.target.value;f("name"),h({...n,name:e}),k(e),O(e,!0),a("")},F=async t=>{if(t.trim()){u(!0),a("");try{const{data:e}=await B.get(`/admin/customer/search-by-code?search=${t}`);e.data?($.current=!0,h({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),N({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),o(!1)):a("Customer not found")}catch(e){a("Failed to search customer"),console.error(e)}finally{u(!1)}}},M=async t=>{if(t.trim()){u(!0),a("");try{const{data:e}=await B.get(`/admin/customer/search-by-name?search=${t}`);e.data?($.current=!0,N({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),o(!1)):a("Customer not found")}catch(e){a("Failed to search customer"),console.error(e)}finally{u(!1)}}},Y=t=>{t.key==="Enter"&&(F(n.code??""),o(!1),d([]))},q=t=>{t.key==="Enter"&&(M(n.name??""),o(!1),d([]))},G=()=>{n.code?F(n.code):n.name&&M(n.name)},S=r.useCallback(async(t,e,T=!1)=>{e===1?u(!0):K(!0);try{const{data:c}=await B.get(`/admin/customer/browse?search=${t}&page=${e}&limit=20`);d(T||e===1?c.data||[]:E=>[...E,...c.data||[]]),C(c.next_page_url!==null),o(c.data&&c.data.length>0)}catch(c){console.error("Error fetching customers:",c),a("Failed to load customers")}finally{u(!1),K(!1)}},[]),O=r.useCallback((t,e=!1)=>{if(i.current&&clearTimeout(i.current),t.length<2){d([]),o(!1),b(1),C(!0);return}i.current=setTimeout(()=>{e&&(b(1),C(!0)),S(t,e?1:y,e)},Q)},[S,y]),R=r.useCallback(()=>{if(!w.current||x||!L)return;const{scrollTop:t,scrollHeight:e,clientHeight:T}=w.current;if(t+T>=e-5){const c=m==="code"?n.code:n.name;if(c&&c.length>=2){const E=y+1;b(E),S(c,E,!1)}}},[x,L,n.code,n.name,y,S]);r.useEffect(()=>{const t=w.current;if(t)return t.addEventListener("scroll",R),()=>t.removeEventListener("scroll",R)},[R]);const J=t=>{const e=m;N({id:t.id,code:t.code,name:t.name,phone:t.phone}),d([]),o(!1),a(""),setTimeout(()=>{e==="code"&&g.current?g.current.focus():e==="name"&&v.current&&v.current.focus()},0)},V=()=>{i.current&&clearTimeout(i.current),h({id:"",code:"",name:"",phone:""}),N({id:"",code:"",name:"",phone:""}),k(""),d([]),o(!1),a(""),b(1),C(!0)};return r.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]),s.jsxs("div",{className:"space-y-2 relative",ref:I,children:[s.jsxs("div",{className:"flex items-center space-x-0 border rounded-lg overflow-hidden bg-background",children:[s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx(A,{ref:g,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kode Customer",value:n.code,onChange:U,onKeyDown:Y,onFocus:()=>{f("code"),p.length>0&&o(!0)},onBlur:()=>{setTimeout(()=>f(null),150)}})}),s.jsx("div",{className:"border-l border-r",children:s.jsx(z,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:G,disabled:j,children:j?s.jsx(H,{className:"h-4 w-4 animate-spin"}):s.jsx(ee,{className:"h-4 w-4"})})}),s.jsx("div",{className:"flex-[2] min-w-0",children:s.jsx(A,{ref:v,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nama Customer",value:n.name,onChange:X,onKeyDown:q,onFocus:()=>{f("name"),p.length>0&&o(!0)},onBlur:()=>{setTimeout(()=>f(null),150)}})}),_&&s.jsx("div",{className:"border-l",children:s.jsx(z,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:V,children:s.jsx(te,{className:"h-4 w-4"})})})]}),P&&p.length>0&&s.jsx(W,{className:"absolute top-full left-0 right-0 z-50 mt-1 shadow-lg border",children:s.jsx(Z,{className:"p-0",children:s.jsxs("div",{ref:w,className:"max-h-64 overflow-y-auto",children:[s.jsx("div",{className:"sticky top-0 bg-muted/50 border-b px-4 py-2",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-muted-foreground",children:[s.jsx("div",{children:"Kode"}),s.jsx("div",{children:"Nama"})]})}),s.jsxs("div",{className:"divide-y",children:[p.map((t,e)=>s.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>J(t),children:[s.jsx("div",{className:"text-sm font-medium truncate",children:t.code}),s.jsx("div",{className:"text-sm truncate col-span-3",children:t.name})]},`${t.id}-${e}`)),x&&s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(H,{className:"h-4 w-4 animate-spin mr-2"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more..."})]}),!L&&p.length>0&&s.jsx("div",{className:"text-center py-4 text-sm text-muted-foreground",children:"No more customers to load"})]})]})})}),D&&s.jsx("div",{className:"text-sm text-destructive bg-destructive/10 px-3 py-2 rounded-md",children:D})]})}export{le as S};
