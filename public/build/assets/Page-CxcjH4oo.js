import{r as c,j as a,R as j,a as W}from"./app-CQ-G37p-.js";import{h as C}from"./moment-C5S46NFB.js";import{C as N,a as T,b as L,c as $,d as w}from"./card-Bq41eL_q.js";import{T as z,a as A,b as g,c as u,d as G,e as o,f as I}from"./table-BSdxGOLt.js";import{I as P}from"./input-BXXA-PDa.js";import{B as S}from"./button-ymMXdPy5.js";import{S as J}from"./SearchVendor-DVTa9TJs.js";import{S as q}from"./SearchItem-DGpcvLrN.js";import{F as f}from"./form-group-CHZXn8bM.js";import{C as d}from"./currency-formatter-D5vTOkIG.js";import{A as K}from"./AuthenticatedLayout-X6euxa7E.js";import{S as O}from"./SearchWarehouse-Bw-VGbhg.js";import{L as Q}from"./list-DIayZXqH.js";import{F as X}from"./filter-BZN7rDIQ.js";import{S as Z}from"./search-B9EA-nRY.js";import{F as aa}from"./file-text-vhY6aTSF.js";import{F as ea}from"./file-spreadsheet-Dv5Qp-1R.js";import"./createLucideIcon-iWXofaGH.js";import"./index-D0iIn24t.js";import"./loader-circle-i2ANfqrZ.js";import"./x-D2Pel9EU.js";import"./badge-CsIJHFj0.js";import"./package-Cd0mGsRo.js";import"./label-Blk7FhF1.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./use-toast-XJEkqv7A.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function sa(){const[h,B]=c.useState(C().format("YYYY-MM")),[b,M]=c.useState(C().format("YYYY-MM")),[r,R]=c.useState(void 0),[t,Y]=c.useState(void 0),[n,E]=c.useState(void 0),[v,k]=c.useState([]),[y,_]=c.useState(!1);async function D(){_(!0);try{const e={month_from:h,month_to:b};r!=null&&r.id&&(e.vendor_id=r.id),n!=null&&n.id&&(e.item_id=n.id),t!=null&&t.id&&(e.warehouse_id=t.id);const{data:l}=await W.get("/admin/purchase-price-change-report/list",{params:e}),i=l.data;k(i)}catch(e){console.error("Error fetching report:",e),k([])}finally{_(!1)}}function H(){return`/admin/purchase-price-change-report/export/pdf?${new URLSearchParams({month_from:h,month_to:b,...(r==null?void 0:r.id)&&{vendor_id:r.id},...(n==null?void 0:n.id)&&{item_id:n.id},...(t==null?void 0:t.id)&&{warehouse_id:t.id}}).toString()}`}function V(){return`/admin/purchase-price-change-report/export/excel?${new URLSearchParams({month_from:h,month_to:b,...(r==null?void 0:r.id)&&{vendor_id:r.id},...(n==null?void 0:n.id)&&{item_id:n.id},...(t==null?void 0:t.id)&&{warehouse_id:t.id}}).toString()}`}return a.jsxs("div",{className:"h-screen overflow-y-auto p-4 md:p-6 bg-gradient-to-br ",children:[a.jsxs("div",{className:"mb-8 flex items-center gap-3",children:[a.jsx("div",{className:"p-2 rounded-lg",children:a.jsx(Q,{className:"h-6 w-6 "})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Laporan Pembelian Bulanan per Vendor"}),a.jsx("p",{children:"Lihat perubahan harga pembelian per item untuk setiap vendor setiap"})]})]}),a.jsxs(N,{className:"mb-6 ",children:[a.jsxs(T,{className:"bg-gradient-to-r  rounded-t-lg border-b",children:[a.jsxs(L,{className:"flex items-center gap-2",children:[a.jsx(X,{className:"h-5 w-5"})," Filter Laporan"]}),a.jsx($,{className:"",children:"Pilih vendor, item, dan periode untuk melihat laporan pembelian"})]}),a.jsx(w,{className:"p-6",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 items-end",children:[a.jsx("div",{className:"lg:col-span-4",children:a.jsx(f,{label:"Vendor (kosongkan = semua)",children:a.jsx(J,{value:r,onChange:e=>R(e),clearable:!0})})}),a.jsx("div",{className:"lg:col-span-4",children:a.jsx(f,{label:"Gudang (kosongkan = semua)",children:a.jsx(O,{value:t,onChange:e=>Y(e),clearable:!0})})}),a.jsx("div",{className:"lg:col-span-4",children:a.jsx(f,{label:"Item (kosongkan = semua)",children:a.jsx(q,{value:n,onChange:e=>E(e),clearable:!0})})}),a.jsx("div",{className:"lg:col-span-2",children:a.jsx(f,{label:"Dari Bulan",children:a.jsx(P,{type:"month",min:"2000",value:h,onChange:e=>B(e.target.value)})})}),a.jsx("div",{className:"lg:col-span-2",children:a.jsx(f,{label:"Hingga Bulan",children:a.jsx(P,{type:"month",min:"2000",value:b,onChange:e=>M(e.target.value),className:"darl:bg-gray-800 dark:text-white"})})}),a.jsx("div",{className:"lg:col-span-12 flex justify-end",children:a.jsxs(S,{onClick:D,disabled:y,children:[a.jsx(Z,{className:"h-4 w-4 mr-2"}),y?"Memuat...":"Tampilkan"]})})]})})]}),v.length>0&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"mb-4 flex justify-end gap-2",children:[a.jsx(S,{variant:"outline",size:"sm",asChild:!0,className:"",children:a.jsxs("a",{href:H(),target:"_blank",rel:"noreferrer",children:[a.jsx(aa,{className:"h-4 w-4 mr-1"})," PDF"]})}),a.jsx(S,{variant:"outline",size:"sm",asChild:!0,className:"",children:a.jsxs("a",{href:V(),target:"_blank",rel:"noreferrer",children:[a.jsx(ea,{className:"h-4 w-4 mr-1"})," Excel"]})})]})}),v.map(e=>a.jsxs(j.Fragment,{children:[a.jsx(N,{className:"mb-6",children:a.jsxs(T,{children:[a.jsxs(L,{children:[e.vendor.code," â€” ",e.vendor.name]}),a.jsxs($,{children:["Tahun: ",e.year," | Total Pembelian:"," ",a.jsx(d,{amount:e.total_purchase})]})]})}),a.jsx(N,{className:"mb-6",children:a.jsx(w,{className:"p-0",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(z,{children:[a.jsxs(A,{children:[a.jsxs(g,{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900",children:[a.jsx(u,{rowSpan:2,className:"w-[400px] min-w-[400px] max-w-[400px]",children:"Nama Item"}),e.months.map(l=>a.jsx(u,{className:"text-center",colSpan:3,children:l.name},l.name))]}),a.jsx(g,{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900",children:e.months.map(l=>a.jsxs(j.Fragment,{children:[a.jsx(u,{className:"text-right",children:"Harga"}),a.jsx(u,{className:"text-right",children:"Jumlah"}),a.jsx(u,{className:"text-right",children:"Total"})]},`${l.name}-headers`))})]}),a.jsx(G,{children:e.months[0].items.map((l,i)=>a.jsxs(a.Fragment,{children:[a.jsxs(g,{children:[a.jsx(o,{className:"font-medium w-[400px] min-w-[400px] max-w-[400px]",children:l.name}),e.months.map((m,s)=>a.jsxs(j.Fragment,{children:[a.jsx(o,{className:"text-right",children:a.jsx(d,{amount:e.months[s].items[i].harga})}),a.jsx(o,{className:"text-right",children:e.months[s].items[i].jumlah}),a.jsx(o,{className:"text-right",children:a.jsx(d,{amount:e.months[s].items[i].total})})]},`${m.name}-${i}`))]},i),(()=>{const m=[];return e.months.forEach(s=>{s.items[i].warehouses&&s.items[i].warehouses.forEach(p=>{m.includes(p.warehouse_name)||m.push(p.warehouse_name)})}),m.map(s=>a.jsxs(g,{style:{backgroundColor:"#f9f9f9"},children:[a.jsx(o,{style:{paddingLeft:"20px",fontWeight:"bold"},children:s}),e.months.map((p,ra)=>{var F;const x=(F=p.items[i].warehouses)==null?void 0:F.find(U=>U.warehouse_name===s);return a.jsxs(j.Fragment,{children:[a.jsx(o,{className:"text-right",children:x?a.jsx(d,{amount:x.harga}):"-"}),a.jsx(o,{className:"text-right",children:x?x.jumlah:"-"}),a.jsx(o,{className:"text-right border-r",children:x?a.jsx(d,{amount:x.total}):"-"})]},`${p.name}-${s}-${i}`)})]},`${s}-${i}`))})()]}))}),a.jsx(I,{children:a.jsxs(g,{className:"bg-gray-50 dark:bg-gray-800",children:[a.jsx(o,{className:"font-bold w-[400px] min-w-[400px] max-w-[400px]",children:"Total"}),e.months.map((l,i)=>a.jsxs(j.Fragment,{children:[a.jsx(o,{className:"text-right font-bold",children:a.jsx(d,{amount:l.items.reduce((m,s)=>m+s.harga,0)})}),a.jsx(o,{className:"text-right font-bold",children:l.items.reduce((m,s)=>m+s.jumlah,0)}),a.jsx(o,{className:"text-right font-bold",children:a.jsx(d,{amount:l.monthTotal})})]},`total-${l.name}`))]})})]})})})},e.vendor.id)]},e.vendor.id)),!y&&v.length===0&&a.jsx(N,{className:"text-center py-12",children:a.jsx(w,{children:a.jsx("p",{className:"text-gray-500",children:"Belum ada data. Silakan pilih filter."})})})]})}sa.layout=h=>a.jsx(K,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Laporan",href:"#"},{label:"Pembelian Bulanan per Vendor",href:"#"}],children:h});export{sa as default};
