import{W as g,r as m,j as e,a as pe,y as f}from"./app-CQ-G37p-.js";import{h as p}from"./moment-C5S46NFB.js";import{t as _}from"./use-toast-XJEkqv7A.js";import{A as je}from"./AuthenticatedLayout-X6euxa7E.js";import{B as ee}from"./button-ymMXdPy5.js";import{T as ve,a as be,b as N,c as n,d as ge,e as t}from"./table-BSdxGOLt.js";import{I as ae}from"./input-BXXA-PDa.js";import{F as d}from"./form-group-CHZXn8bM.js";import{T as fe}from"./textarea-BvykTLwI.js";import{E as _e}from"./EmptyTable-CjEJGtgb.js";import{S as Ne}from"./SearchDivision-Budjprvk.js";import{S as we}from"./SearchCustomer-BbTZ5_2l.js";import De from"./ReceivabletList-C9Wh7RF1.js";import{C as u}from"./currency-formatter-D5vTOkIG.js";import Ie from"./AccountReceivableForm-BiJfjjuU.js";import{P as Te}from"./ProcessingButton-Da7kiAJ4.js";import{T as ye}from"./trash-C6VGYEst.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./checkbox-DaA1krf_.js";import"./index-CZ_DqijM.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";function Ce({division:w,accountReceivableHeader:se}){var C,Y,k,E,S,P,R,F,M,A,z,B,q,H;const{data:s,setData:o,errors:l,setError:re,clearErrors:ie}=g(se),{data:Ye,setData:te}=g({});m.useState({});const[ne,D]=m.useState(!1),[ce,I]=m.useState({show:!1,isEdit:!1,itemInItemIndex:0});m.useEffect(()=>{},[s.customer_id]);const oe=async()=>{const a=s.account_receivables;a[j.index]=T,o({...s,account_receivables:a}),v({...j,show:!1,index:-1})},le=()=>e.jsx(De,{formDialog:ce,setFormDialog:I,customer_id:s.customer_id,onChange:a=>{const r=a.map(i=>({receivable_id:i.id,receivable:i,discount:0,paid_amount:i.remaining_amount}));o("account_receivables",[...s.account_receivables,...r])},accountReceivableHeader:s}),de=async()=>{var a,r,i;D(!0);try{ie();const c=await pe.put(`/admin/account-receivable/${s.id}`,{...s,date:p(s.date).format("YYYY-MM-DD")});if(s.account_receivables.reduce((h,x)=>h+(x.paid_amount??0),0)===0){_({title:"Berhasil",description:"Penerimaan piutang berhasil diperbarui tanpa kas masuk"}),f.visit("/admin/account-receivable");return}s.cash_in?f.visit(`/admin/cash-in/${s.cash_in.id}/edit`):f.visit(`/admin/cash-in/create?account_receivable_header=${c.data.data.id}`),_({title:"Berhasil",description:"Penerimaan piutang berhasil diperbarui"})}catch(c){((a=c.response)==null?void 0:a.status)==422?re(c.response.data.errors):_({variant:"destructive",title:"Gagal",description:((i=(r=c.response)==null?void 0:r.data)==null?void 0:i.message)??c.message})}finally{D(!1)}},me=()=>{te({item_id:"",item:{code:"",name:""},quantity:"0",price:"0",remarks:""}),I({show:!0,isEdit:!1,itemInItemIndex:0})},{data:T,setData:y}=g({}),[j,v]=m.useState({show:!1,index:-1}),ue=(a,r)=>{y(r),v({show:!0,index:a})},he=a=>{o({...s,account_receivables:s.account_receivables.filter((r,i)=>a!=i)})};return e.jsxs("div",{className:"pt-5  px-5",children:[e.jsxs("div",{className:"md:flex gap-x-1",children:[e.jsxs("div",{className:"w-full md:w-3/5",children:[e.jsx(d,{name:"division_id",label:"Divisi",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(Ne,{value:{id:s.division_id??"",code:((C=s.division)==null?void 0:C.code)??"",name:((Y=s.division)==null?void 0:Y.name)??""},onChange:a=>{o({...s,division_id:a.id,division:a})}})}),e.jsx(d,{name:"text",label:"Nomor",required:!0,error:l.number,horizontal:!0,children:e.jsx(ae,{type:"text",value:s.number,onChange:a=>o("number",a.target.value)})}),e.jsx(d,{name:"date",label:"Tanggal",required:!0,error:l.date,horizontal:!0,children:e.jsx(ae,{type:"date",value:s.date,onChange:a=>o("date",a.target.value)})}),e.jsx(d,{name:"customer_id",label:"Vendor",required:!0,error:l.division_id,horizontal:!0,children:e.jsx(we,{value:{id:s.customer_id??"",code:((k=s.customer)==null?void 0:k.code)??"",name:((E=s.customer)==null?void 0:E.name)??""},onChange:a=>{o({...s,customer_id:a.id,customer:a})}})}),e.jsx(d,{label:"Catatan",error:l.remarks,name:"remarks",horizontal:!0,children:e.jsx(fe,{value:s.remarks,onChange:a=>o("remarks",a.target.value)})})]}),e.jsxs("div",{className:"w-full md:w-2/3 bg-blue-300 p-2 rounded",children:[e.jsx("div",{children:e.jsx("strong",{children:(S=s.customer)==null?void 0:S.name})}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[15%]",children:"Telepon"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(P=s.customer)==null?void 0:P.phone]}),e.jsx("td",{className:"w-[15%]",children:"Term Crd"}),e.jsxs("td",{className:"w-[35%]",children:[": ",(R=s.customer)==null?void 0:R.term_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Fax"}),e.jsxs("td",{children:[": ",(F=s.customer)==null?void 0:F.fax]}),e.jsx("td",{children:"Max Crd"}),e.jsxs("td",{children:[": ",(M=s.customer)==null?void 0:M.max_crd]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Expired"}),e.jsxs("td",{children:[": ",(A=s.customer)==null?void 0:A.expired]}),e.jsx("td",{}),e.jsx("td",{})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4 mb-3",children:[e.jsx("div",{className:"col-span-3"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-4/5",children:e.jsx(d,{error:l.account_receivables,children:e.jsxs(ve,{children:[e.jsx(be,{children:e.jsxs(N,{children:[e.jsx(n,{className:"w-1/5",children:"No"}),e.jsx(n,{children:"NO PO"}),e.jsx(n,{className:"text-right",children:"Discount"}),e.jsx(n,{className:"text-right",children:"Bayar"}),e.jsx(n,{className:"text-right",children:"Total"}),e.jsx(n,{className:"text-right",children:"Sisa Hutang"}),e.jsx(n,{children:"Tanggal"}),e.jsx(n,{children:"Pelanggan"}),e.jsx(n,{children:"Divisi"}),e.jsx(n,{className:"w-[100px]",children:"Aksi"})]})}),e.jsx(ge,{children:((z=s.account_receivables)==null?void 0:z.length)==0?e.jsx(N,{children:e.jsx(t,{colSpan:9,className:"text-center",children:e.jsx(_e,{})})}):(B=s.account_receivables)==null?void 0:B.map((a,r)=>{var i,c,b,h,x,L,$,G,O,U,V,W,J,K,Q,X,Z;return e.jsxs(N,{onClick:()=>ue(r,a),className:"cursor-pointer hover:bg-slate-100",children:[e.jsxs(t,{children:[(i=a.receivable)!=null&&i.sale?(c=a.receivable.sale)==null?void 0:c.no:"",(b=a.receivable)!=null&&b.sales_deposit?(h=a.receivable)==null?void 0:h.sales_deposit.number:""]}),e.jsx(t,{children:((x=a.receivable)==null?void 0:x.purchase_order_number)??""}),e.jsx(t,{children:e.jsx(u,{amount:a.discount})}),e.jsx(t,{children:e.jsx(u,{amount:a.paid_amount})}),e.jsx(t,{children:e.jsx(u,{amount:a.discount+a.paid_amount})}),e.jsx(t,{children:e.jsx(u,{amount:((L=a.receivable)==null?void 0:L.remaining_amount)??0})}),e.jsx(t,{children:($=a.receivable)!=null&&$.date?e.jsx(e.Fragment,{children:p((G=a.receivable)==null?void 0:G.date).format("DD/MM/YYYY")}):e.jsxs(e.Fragment,{children:[(O=a.receivable)!=null&&O.sale?p((V=(U=a.receivable)==null?void 0:U.sale)==null?void 0:V.sale_date).format("DD/MM/YYYY"):"",(W=a.receivable)!=null&&W.sales_deposit?p((K=(J=a.receivable)==null?void 0:J.sales_deposit)==null?void 0:K.date).format("DD/MM/YYYY"):""]})}),e.jsx(t,{children:(Q=a.receivable)==null?void 0:Q.customer.name}),e.jsx(t,{children:(Z=(X=a.receivable)==null?void 0:X.division)==null?void 0:Z.name}),e.jsx(t,{children:e.jsx(ee,{size:"sm",variant:"destructive",onClick:xe=>{xe.stopPropagation(),he(r)},children:e.jsx(ye,{size:24})})})]},r)})})]})})}),e.jsxs("div",{className:"w-1/5 bg-green-500 p-2 rounded",children:[e.jsxs("div",{children:["Item : ",(q=s.account_receivables)==null?void 0:q.length]}),e.jsxs("div",{className:"flex gap-x-1",children:[e.jsx("div",{children:"Total :"}),e.jsx(u,{amount:(H=s.account_receivables)==null?void 0:H.reduce((a,r)=>a+(r.paid_amount??0),0)})]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(ee,{onClick:me,variant:"outline",disabled:s.customer_id=="",children:"Tambah dari list"})})]})]}),e.jsx(Te,{type:"button",processing:ne,label:"Ubah",processingLabel:"Mengubah",onClick:de}),le(),e.jsx(Ie,{accountReceivableFormDialog:j,setAccountReceivableFormDialog:v,accountReceivable:T,setAccountReceivable:y,onSaveItem:oe})]})}Ce.layout=w=>e.jsx(je,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Akuntansi",href:"#"},{label:"Penerimaan Piutang",href:"/admin/account-receivable"},{label:"Edit",href:"#"}],children:w});export{Ce as default};
