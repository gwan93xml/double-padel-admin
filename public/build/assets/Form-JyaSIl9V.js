import{r as a,a as K,j as n}from"./app-CQ-G37p-.js";import{B as D}from"./button-ymMXdPy5.js";import{I as _}from"./input-BXXA-PDa.js";import{C as Z,d as ee}from"./card-Bq41eL_q.js";import{L as H}from"./loader-circle-i2ANfqrZ.js";import{S as ne}from"./search-B9EA-nRY.js";import{X as te}from"./x-D2Pel9EU.js";import{F as ae}from"./file-upload-dropzone-CNZ94Fyj.js";import{F as x}from"./form-group-CHZXn8bM.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-Dhyve51-.js";import"./tslib.es6-eMSY344_.js";import"./badge-CsIJHFj0.js";import"./index-Cu_r977E.js";import"./circle-alert-DNqBTniX.js";import"./circle-check-big-DDOzmUMH.js";import"./eye-DwuHDobg.js";import"./download-o5rqL5cq.js";import"./label-Blk7FhF1.js";import"./index-DqZ46QiR.js";function ce({onChange:o,value:s,clearable:m}){const[r,d]=a.useState({id:"",account_number:"",account_name:""}),[b,c]=a.useState(!1),[$,i]=a.useState(""),[N,h]=a.useState([]),[P,u]=a.useState(!1),[g,p]=a.useState(1),[L,v]=a.useState(!0),[k,q]=a.useState(!1),[re,T]=a.useState(""),f=a.useRef(null),U=200,I=a.useRef(null),S=a.useRef(null),F=a.useRef(!1),C=a.useRef(null),w=a.useRef(null),[E,j]=a.useState(null);a.useEffect(()=>{s&&!F.current&&d({id:s.id||"",account_number:s.account_number||"",account_name:s.account_name||""})},[s]),a.useEffect(()=>{},[r,o]),a.useEffect(()=>{if(!b&&!k&&E){const t=setTimeout(()=>{E==="account_number"&&C.current?C.current.focus():E==="account_name"&&w.current&&w.current.focus()},0);return()=>clearTimeout(t)}},[b,k,E]),a.useEffect(()=>{const t=e=>{I.current&&!I.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const Q=t=>{const e=t.target.value;j("account_number"),d({...r,account_number:e}),T(e),O(e,!0),i("")},G=t=>{const e=t.target.value;j("account_name"),d({...r,account_name:e}),T(e),O(e,!0),i("")},z=async t=>{if(t.trim()){c(!0),i("");try{const{data:e}=await K.get(`/admin/bank-account/search-by-account_number?search=${t}`);e.data?(F.current=!0,d({id:e.data.id,account_number:e.data.account_number,account_name:e.data.account_name}),o({id:e.data.id,account_number:e.data.account_number,account_name:e.data.account_name}),u(!1)):i("BankAccount not found")}catch(e){i("Failed to search bankAccount"),console.error(e)}finally{c(!1)}}},M=async t=>{if(t.trim()){c(!0),i("");try{const{data:e}=await K.get(`/admin/bank-account/search-by-account_name?search=${t}`);e.data?(F.current=!0,d({id:e.data.id,account_number:e.data.account_number,account_name:e.data.account_name}),o({id:e.data.id,account_number:e.data.account_number,account_name:e.data.account_name}),u(!1)):i("BankAccount not found")}catch(e){i("Failed to search bankAccount"),console.error(e)}finally{c(!1)}}},X=t=>{t.key==="Enter"&&(z(r.account_number??""),u(!1),h([]))},Y=t=>{t.key==="Enter"&&(M(r.account_name??""),u(!1),h([]))},J=()=>{r.account_number?z(r.account_number):r.account_name&&M(r.account_name)},y=a.useCallback(async(t,e,A=!1)=>{e===1?c(!0):q(!0);try{const{data:l}=await K.get(`/admin/bank-account/browse?search=${t}&page=${e}&limit=20`);h(A||e===1?l.data||[]:R=>[...R,...l.data||[]]),v(l.next_page_url!==null),u(l.data&&l.data.length>0)}catch(l){console.error("Error fetching bankAccounts:",l),i("Failed to load bankAccounts")}finally{c(!1),q(!1)}},[]),O=a.useCallback((t,e=!1)=>{if(f.current&&clearTimeout(f.current),t.length<2){h([]),u(!1),p(1),v(!0);return}f.current=setTimeout(()=>{e&&(p(1),v(!0)),y(t,e?1:g,e)},U)},[y,g]);a.useCallback((t,e=!1)=>{if(f.current&&clearTimeout(f.current),t.length<2){h([]),u(!1),p(1),v(!0);return}e&&(p(1),v(!0)),y(t,e?1:g,e)},[y,g]);const B=a.useCallback(()=>{if(!S.current||k||!L)return;const{scrollTop:t,scrollHeight:e,clientHeight:A}=S.current;if(t+A>=e-5){const l=r.account_number||r.account_name;if(l&&l.length>=2){const R=g+1;p(R),y(l,R,!1)}}},[k,L,r.account_number,r.account_name,g,y]);a.useEffect(()=>{const t=S.current;if(t)return t.addEventListener("scroll",B),()=>t.removeEventListener("scroll",B)},[B]);const V=t=>{const e=E;d({id:t.id,account_number:t.account_number,account_name:t.account_name}),o({id:t.id,account_number:t.account_number,account_name:t.account_name}),h([]),u(!1),i(""),setTimeout(()=>{e==="account_number"&&C.current?C.current.focus():e==="account_name"&&w.current&&w.current.focus()},0)},W=()=>{f.current&&clearTimeout(f.current),d({id:"",account_number:"",account_name:""}),o({id:"",account_number:"",account_name:""}),T(""),h([]),u(!1),i(""),p(1),v(!0)};return a.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]),n.jsxs("div",{className:"space-y-2 relative",ref:I,children:[n.jsxs("div",{className:"flex items-center space-x-0 border rounded-lg overflow-hidden bg-background",children:[n.jsx("div",{className:"flex-1 min-w-0",children:n.jsx(_,{ref:C,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nomor Rekening",value:r.account_number,onChange:Q,onKeyDown:X,onFocus:()=>{j("account_number"),N.length>0&&u(!0)},onBlur:()=>{setTimeout(()=>j(null),150)}})}),n.jsx("div",{className:"border-l border-r",children:n.jsx(D,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:J,disabled:b,children:b?n.jsx(H,{className:"h-4 w-4 animate-spin"}):n.jsx(ne,{className:"h-4 w-4"})})}),n.jsx("div",{className:"flex-[2] min-w-0",children:n.jsx(_,{ref:w,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nama Rekening",value:r.account_name,onChange:G,onKeyDown:Y,onFocus:()=>{j("account_name"),N.length>0&&u(!0)},onBlur:()=>{setTimeout(()=>j(null),150)}})}),m&&n.jsx("div",{className:"border-l",children:n.jsx(D,{variant:"ghost",size:"sm",className:"rounded-none  px-3",onClick:W,children:n.jsx(te,{className:"h-4 w-4"})})})]}),P&&N.length>0&&n.jsx(Z,{className:"absolute top-full left-0 right-0 z-50 mt-1 shadow-lg border",children:n.jsx(ee,{className:"p-0",children:n.jsxs("div",{ref:S,className:"max-h-64 overflow-y-auto",children:[n.jsx("div",{className:"sticky top-0 bg-muted/50 border-b px-4 py-2",children:n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-muted-foreground",children:[n.jsx("div",{children:"Kode"}),n.jsx("div",{children:"Nama"})]})}),n.jsxs("div",{className:"divide-y",children:[N.map((t,e)=>n.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>V(t),children:[n.jsx("div",{className:"text-sm font-medium truncate",children:t.account_number}),n.jsx("div",{className:"text-sm truncate col-span-3",children:t.account_name})]},`${t.id}-${e}`)),k&&n.jsxs("div",{className:"flex items-center justify-center py-4",children:[n.jsx(H,{className:"h-4 w-4 animate-spin mr-2"}),n.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more..."})]}),!L&&N.length>0&&n.jsx("div",{className:"text-center py-4 text-sm text-muted-foreground",children:"No more bankAccounts to load"})]})]})})}),$&&n.jsx("div",{className:"text-sm text-destructive bg-destructive/10 px-3 py-2 rounded-md",children:$})]})}function Ee({data:o,setData:s,errors:m}){var r,d,b;return n.jsxs("div",{className:"grid grid-cols-2 gap-x-4  gap-y-4",children:[n.jsx(x,{label:"Kode",error:m.code,required:!0,children:n.jsx(_,{type:"text",value:o.code,onChange:c=>{s("code",c.target.value)}})}),n.jsx(x,{label:"Nama",error:m.name,required:!0,children:n.jsx(_,{type:"text",value:o.name,onChange:c=>{s("name",c.target.value)}})}),n.jsx(x,{label:"Kota",error:m.city,required:!0,children:n.jsx(_,{type:"text",value:o.city,onChange:c=>{s("city",c.target.value)}})}),n.jsx(x,{label:"Tagline",error:m.tagline,required:!0,children:n.jsx(_,{type:"text",value:o.tagline,onChange:c=>{s("tagline",c.target.value)}})}),n.jsx("div",{className:"col-span-2",children:n.jsx(x,{label:"Logo",error:m.logo,children:n.jsx(ae,{initialFile:o.logo,onChange:c=>{s("logo",c)}})})}),n.jsx(x,{label:"Kode Penjualan",error:m.code,required:!0,children:n.jsx(_,{type:"text",value:o.sale_code,onChange:c=>{s("sale_code",c.target.value)}})}),n.jsx(x,{label:"Rekening Bank",error:m.bank_account_id,children:n.jsx(ce,{value:{id:(r=o.bank_account)==null?void 0:r.id,account_name:(d=o.bank_account)==null?void 0:d.account_name,account_number:(b=o.bank_account)==null?void 0:b.account_number},onChange:c=>{s({...o,bank_account_id:c.id,bank_account:c})},clearable:!0})})]})}export{Ee as default};
