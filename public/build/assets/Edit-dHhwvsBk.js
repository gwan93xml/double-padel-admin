import{r as d,W as j,j as r,a as u,y as A}from"./app-CQ-G37p-.js";import{h as B}from"./moment-C5S46NFB.js";import{t as S}from"./use-toast-XJEkqv7A.js";import{A as M}from"./AuthenticatedLayout-X6euxa7E.js";import{B as E}from"./button-ymMXdPy5.js";import{I as f}from"./input-BXXA-PDa.js";import{F as n}from"./form-group-CHZXn8bM.js";import{S as G}from"./select-remote-C3ahzpc3.js";import{T as L}from"./textarea-BvykTLwI.js";import{S as R}from"./SearchCustomer-BbTZ5_2l.js";import{S as $}from"./SearchDivision-Budjprvk.js";import J from"./SalesOrderTotal-BhcGZWxx.js";import U from"./SalesOrderItemForm-Cm5xpPzg.js";import V from"./SalesOrderItemList-BCqY9dvk.js";import{P as W}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./money-input-Bb590VQ4.js";import"./lodash-Caeo88pO.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchSubUnit-CTrUekdR.js";import"./dialog-CBBIkam9.js";import"./EmptyTable-CjEJGtgb.js";import"./table-BSdxGOLt.js";import"./pencil-XLeJOTln.js";import"./trash-C6VGYEst.js";function z({salesOrder:p}){var b,g,v,y;const[_,h]=d.useState(!1),{data:t,setData:o,errors:s,setError:C,clearErrors:I}=j(p),{data:a,setData:c}=j(),[D,x]=d.useState({}),[O,T]=d.useState();d.useEffect(()=>{async function e(){const i=await u.get(`/admin/type-of-tax/${t.type_of_tax_id}`);T(i.data.data)}e()},[t.type_of_tax_id]);const[m,l]=d.useState({open:!1,isEdit:!1,index:0}),N=async()=>{var e;try{return await u.post("/admin/sales-order/validate",{item_id:a.item_id,item_name:a.item_name,unit:a.unit,item:{name:(e=a.item)==null?void 0:e.name},chart_of_account_id:a.chart_of_account_id,price:a.price,quantity:a.quantity,discount:a.discount,subtotal:a.subtotal,notes:a.notes}),x({}),!0}catch(i){return x(i.response.data.errors),!1}},k=async()=>{if(await N()){if(m.isEdit){const e=t.items;e[m.index]=a,o({...t,items:e})}else o("items",[...t.items,a]);l({...m,open:!1})}},P=async()=>{h(!0);try{I(),await u.put(`/admin/sales-order/${t.id}`,{...t,date:B(t.date).format("YYYY-MM-DD")}),A.visit("/admin/sales-order"),S({title:"Berhasil",description:"Sales order berhasil diubah"})}catch(e){e.response.status==422?C(e.response.data.errors):S({title:"Gagal",description:e.response.data.message,variant:"destructive"})}finally{h(!1)}},q=()=>{c({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},price:"0",quantity:"0",subtotal:"0",discount:"0",discount_percent:0,total:"0",notes:"",is_stock:!0}),l({open:!0,isEdit:!1,index:0})},w=(e,i)=>{c(i),l({open:!0,isEdit:!0,index:e})},F=e=>{var i;o({...t,items:(i=t.items)==null?void 0:i.filter((H,Y)=>e!=Y)})};return r.jsxs("div",{className:"pt-5  px-5",children:[r.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[r.jsx(n,{label:"Pelanggan",error:s.customer_id,name:"customer_id",children:r.jsx(R,{value:{id:t.customer_id,code:(b=t.customer)==null?void 0:b.code,name:(g=t.customer)==null?void 0:g.name},onChange:e=>{o({...t,customer_id:e.id,customer:e})}})}),r.jsx(n,{label:"Jenis Pajak",error:s.type_of_tax_id,name:"type_of_tax_id",children:r.jsx(G,{value:t.type_of_tax_id,remoteConfig:{url:"/admin/type-of-tax/list",label:e=>e.name,value:e=>e.id.toString()},onValueChange:e=>{o({...t,type_of_tax_id:e})}})}),r.jsx(n,{label:"Divisi",error:s.division_id,name:"division_id",children:r.jsx($,{value:{id:t.division_id,code:(v=t.division)==null?void 0:v.code,name:(y=t.division)==null?void 0:y.name},onChange:e=>{o({...t,division_id:e.id,division:e})}})}),r.jsx(n,{label:"Tanggal",error:s.date,name:"date",children:r.jsx(f,{type:"date",value:t.date,onChange:e=>{o({...t,date:e.target.value})}})}),r.jsx(n,{label:"Nomor",error:s.number,name:"number",required:!0,children:r.jsx(f,{type:"text",disabled:!0,value:t.number,onChange:e=>{o({...t,number:e.target.value})}})}),r.jsx(n,{label:"Nomor PO.",error:s.purchase_order_number,name:"purchase_order_number",required:!0,children:r.jsx(f,{type:"text",value:t.purchase_order_number,onChange:e=>{o({...t,purchase_order_number:e.target.value})}})}),r.jsx("div",{className:"col-span-3",children:r.jsx(n,{label:"Catatan",error:s.notes,name:"note",children:r.jsx(L,{value:t.notes,onChange:e=>{o({...t,notes:e.target.value})}})})}),r.jsxs("div",{className:"col-span-3",children:[r.jsx(V,{items:t.items??[],onEdit:w,onDelete:F}),r.jsx(E,{className:"w-full",onClick:q,children:r.jsx(W,{})})]}),r.jsx("div",{className:"col-span-3",children:r.jsx(J,{data:t,setData:o,type_ofTax:O})})]}),r.jsx(E,{type:"button",onClick:P,disabled:_,children:_?"Mengubah...":"Ubah"}),r.jsx(U,{formDialog:m,onOpenChange:e=>{l({...m,open:e})},data:a,setData:c,errors:D,onSave:k})]})}z.layout=p=>r.jsx(M,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Sales Order",href:"/admin/sales-order"},{label:"Edit",href:"#"}],children:p});export{z as default};
