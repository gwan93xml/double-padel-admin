import{W as y,r as S,j as e,a as b,y as _e}from"./app-CQ-G37p-.js";import{S as fe}from"./SearchChartOfAccount-0Jd4yGJY.js";import{S as pe}from"./SearchDivision-Budjprvk.js";import{S as je}from"./SearchItem-DGpcvLrN.js";import{S as ge}from"./SearchWarehouse-Bw-VGbhg.js";import{B as l}from"./button-ymMXdPy5.js";import{C as we}from"./currency-formatter-D5vTOkIG.js";import{D as be,a as Ie,d as ve}from"./dialog-CBBIkam9.js";import{F as d}from"./form-group-CHZXn8bM.js";import{I as N}from"./input-BXXA-PDa.js";import{M as Ce}from"./money-input-Bb590VQ4.js";import{S as ke,a as ye,b as Se,c as Ne,d as H}from"./select-BSIJzAmS.js";import{T as L,a as W,b as I,c as r,d as Q,e as v}from"./table-BSdxGOLt.js";import{A as Ae}from"./AuthenticatedLayout-X6euxa7E.js";import{u as Ee}from"./use-toast-XJEkqv7A.js";import{h as X}from"./moment-C5S46NFB.js";import{S as De}from"./SearchSubUnit-CTrUekdR.js";import{T as Te}from"./textarea-BvykTLwI.js";import Oe from"./ItemForm-_Wtip2OZ.js";import{P as Z}from"./pencil-XLeJOTln.js";import{T as ee}from"./trash-C6VGYEst.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./file-text-vhY6aTSF.js";import"./package-Cd0mGsRo.js";import"./index-D0iIn24t.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./label-Blk7FhF1.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function qe({division:j,warehouse:A}){var q,B,P,F,M,Y,z,G,K,R,$,J,U,V;const{data:a,setData:c,clearErrors:te,errors:h,setError:ae}=y({date:X().format("YYYY-MM-DD"),chart_of_accounts:[],division:j,warehouse:A,division_id:j.id,item_id:"",warehouse_id:A.id,items:[],status:"pending"}),{toast:E}=Ee();S.useEffect(()=>{async function t(){const{data:s}=await b.get(`/admin/item/stock/${a.item_id}?warehouse_id=${a.warehouse_id}`);c({...a,stock:s.data.stock})}t()},[a.item_id,a.warehouse_id]);async function D(t){const{data:s}=await b.get(`/admin/item/stock/${t}?warehouse_id=${a.warehouse_id}`);return s.data.stock}const{data:i,setData:g,errors:T}=y({id:"",code:"",name:"",amount:"0"}),{data:o,setData:C,errors:se,setError:re,clearErrors:oe}=y({item_id:"",quantity:"0"}),[m,p]=S.useState({show:!1,isEdit:!1,chartOfAccountIndex:-1}),ie=()=>{g({id:"",chart_of_account:{id:"",code:"",name:""},amount:"0"}),p({...m,show:!0,isEdit:!1,chartOfAccountIndex:-1})},ce=()=>{var t,s,n,u,x,f;if(m.isEdit){const k=[...a.chart_of_accounts];k[m.chartOfAccountIndex]={...k[m.chartOfAccountIndex],chart_of_account:{id:i.id,code:(t=i.chart_of_account)==null?void 0:t.code,name:(s=i.chart_of_account)==null?void 0:s.name},chart_of_account_id:(n=i.chart_of_account)==null?void 0:n.id,amount:i.amount},c({...a,chart_of_accounts:k})}else c({...a,chart_of_accounts:[...a.chart_of_accounts,{chart_of_account:{id:i.id,code:(u=i.chart_of_account)==null?void 0:u.code,name:(x=i.chart_of_account)==null?void 0:x.name},chart_of_account_id:(f=i.chart_of_account)==null?void 0:f.id,amount:i.amount}]});p({...m,show:!1,isEdit:!1})},ne=t=>{var s,n;g({...i,chart_of_account:{id:a.chart_of_accounts[t].chart_of_account_id??"",code:((s=a.chart_of_accounts[t].chart_of_account)==null?void 0:s.code)??"",name:((n=a.chart_of_accounts[t].chart_of_account)==null?void 0:n.name)??""},amount:a.chart_of_accounts[t].amount}),p({...m,show:!0,isEdit:!0,chartOfAccountIndex:t})},de=t=>{const s=[...a.chart_of_accounts];s.splice(t,1),c({...a,chart_of_accounts:s})},me=async()=>{try{te(),await b.post("/admin/production",{...a,date:X(a.date).format("YYYY-MM-DD")}),_e.visit("/admin/production/create"),E({title:"Berhasil",description:"Produksi berhasil disimpan"})}catch(t){t.response.status==422?ae(t.response.data.errors):E({title:"Gagal",description:t.response.data.message})}},[_,w]=S.useState({show:!1,isEdit:!1,itemIndex:-1}),O=()=>{w({..._,show:!0,isEdit:!1,itemIndex:-1}),C({item_id:"",item:{id:"",code:"",name:"",purchase_price:"0",selling_price:"0"},quantity:"0"})},le=async()=>{oe();try{return await b.post("/admin/production/validate",o),!0}catch(t){return re(t.response.data.errors),!1}},he=async t=>{var s,n,u,x;if(await le()){if(_.isEdit){const f=[...a.items];f[_.itemIndex]={...f[_.itemIndex],item:{id:o.item_id,code:(s=o.item)==null?void 0:s.code,name:(n=o.item)==null?void 0:n.name},item_id:o.item_id,unit:o.unit,quantity:o.quantity,remarks:o.remarks,warehouse_id:a.warehouse_id,stock:await D(o.item_id),notes:o.notes},c({...a,items:f})}else c({...a,items:[...a.items,{item:{id:o.item_id,code:(u=o.item)==null?void 0:u.code,name:(x=o.item)==null?void 0:x.name},item_id:o.item_id,quantity:o.quantity,unit:o.unit,remarks:o.remarks,warehouse_id:a.warehouse_id,stock:await D(o.item_id),notes:o.notes}]});w({..._,show:!1,itemIndex:-1,isEdit:!1}),t&&setTimeout(()=>{O()},300)}},ue=(t,s)=>{C(s),w({..._,show:!0,isEdit:!0,itemIndex:t})},xe=t=>{const s=[...a.items];s.splice(t,1),c({...a,items:s})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-5  px-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[e.jsx(d,{label:"Divisi",error:h.division_id,children:e.jsx(pe,{value:{id:a.division_id,code:(q=a.division)==null?void 0:q.code,name:(B=a.division)==null?void 0:B.name},onChange:t=>{c({...a,division_id:t.id,division:{code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Gudang",error:h.warehouse_id,children:e.jsx(ge,{value:{id:a.warehouse_id,code:(P=a.warehouse)==null?void 0:P.code,name:(F=a.warehouse)==null?void 0:F.name},onChange:t=>{c({...a,warehouse_id:t.id,warehouse:{code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Tanggal",error:h.date,children:e.jsx(N,{type:"date",value:a.date,onChange:t=>{c({...a,date:t.target.value})}})}),e.jsx(d,{label:"Barang Diproduksi",error:h.item_id,children:e.jsx(je,{warehouseId:a.warehouse_id,value:{id:a.item_id??"",code:((M=a.item)==null?void 0:M.code)??"",name:((Y=a.item)==null?void 0:Y.name)??"",purchase_price:((z=a.item)==null?void 0:z.purchase_price)??"0",selling_price:((G=a.item)==null?void 0:G.selling_price)??"0",unit:((K=a.item)==null?void 0:K.unit)??""},onChange:t=>{c({...a,item_id:t.id,item:{code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Sisa Stok",children:e.jsx(N,{type:"text",disabled:!0,value:a.stock})}),e.jsx(d,{label:"Jumlah",error:h.quantity,children:e.jsx(N,{type:"number",value:a.quantity,onChange:t=>{c({...a,quantity:t.target.value})}})}),e.jsx(d,{label:"Satuan",required:!0,error:h.unit,children:e.jsx(De,{itemId:a.item_id,value:a.unit,onChange:t=>{c({...a,unit:t})}})}),e.jsx(d,{label:"Status",error:h.status,children:e.jsxs(ke,{value:a.status,onValueChange:t=>{c({...a,status:t})},children:[e.jsx(ye,{children:e.jsx(Se,{placeholder:"Pilih Status"})}),e.jsxs(Ne,{children:[e.jsx(H,{value:"completed",children:"Selesai"}),e.jsx(H,{value:"pending",children:"Pending"})]})]})}),e.jsx(d,{label:"Catatan",error:h.notes,children:e.jsx(Te,{value:a.notes,onChange:t=>{c({...a,notes:t.target.value})}})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("h4",{className:"bg-blue-300 text-center",children:"Item/Stock yang berkurang"}),e.jsxs(L,{children:[e.jsx(W,{children:e.jsxs(I,{children:[e.jsx(r,{children:"No"}),e.jsx(r,{children:"Kode"}),e.jsx(r,{children:"Nama"}),e.jsx(r,{children:"Keterangan"}),e.jsx(r,{className:"text-right",children:"Jumlah"}),e.jsx(r,{children:"Catatan"}),e.jsx(r,{children:"Gudang"}),e.jsx(r,{className:"text-right",children:"Item Sisa"}),e.jsx(r,{className:"text-right",children:"Aksi"})]})}),e.jsx(Q,{children:(R=a.items)==null?void 0:R.map((t,s)=>{var n,u,x;return e.jsxs(I,{children:[e.jsx(r,{className:"w-[10px]",children:s+1}),e.jsx(r,{children:(n=t.item)==null?void 0:n.code}),e.jsx(r,{children:(u=t.item)==null?void 0:u.name}),e.jsx(r,{children:t.remarks}),e.jsxs(r,{className:"text-right",children:[t.quantity," ",t.unit]}),e.jsx(r,{children:t.notes}),e.jsx(r,{children:(x=a.warehouse)==null?void 0:x.name}),e.jsx(r,{className:"text-right",children:t.stock}),e.jsxs(r,{className:"text-right",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>ue(s,t),children:e.jsx(Z,{})}),e.jsx(l,{variant:"destructive",onClick:()=>xe(s),size:"sm",children:e.jsx(ee,{})})]})]},s)})})]}),e.jsx(l,{onClick:O,className:"w-full",children:"Tambah Item"})]}),e.jsx("div",{className:"col-span-3",children:e.jsx("hr",{})}),e.jsxs("div",{className:"col-span-3 mb-3",children:[e.jsx("h4",{className:"bg-blue-300 text-center",children:"Tambahan Cost/Biaya dari"}),e.jsxs(L,{children:[e.jsx(W,{children:e.jsxs(I,{children:[e.jsx(r,{children:"NO."}),e.jsx(r,{children:"AKUN"}),e.jsx(r,{className:"w-[200px]",children:"NILAI"}),e.jsx(r,{className:"w-[100px]",children:"AKSI"})]})}),e.jsx(Q,{children:($=a.chart_of_accounts)==null?void 0:$.map((t,s)=>e.jsxs(I,{children:[e.jsx(v,{className:"w-[10px]",children:s+1}),e.jsxs(v,{children:[t.chart_of_account.code," - ",t.chart_of_account.name]}),e.jsx(v,{className:"text-right",children:e.jsx(we,{amount:t.amount})}),e.jsx(v,{children:e.jsxs("div",{className:"flex",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>ne(s),children:e.jsx(Z,{})}),e.jsx(l,{variant:"destructive",onClick:()=>de(s),size:"sm",children:e.jsx(ee,{})})]})})]},s))})]}),e.jsx(l,{onClick:ie,className:"w-full",children:"Tambah Cost/Biaya Dari"})]})]}),e.jsx(be,{open:m.show,onOpenChange:t=>{p({...m,show:t})},children:e.jsxs(Ie,{className:" max-h-[80vh] overflow-y-auto",children:[e.jsx(d,{label:"Akun",error:T.chart_of_account_id,children:e.jsx(fe,{value:{id:(J=i.chart_of_account)==null?void 0:J.id,code:(U=i.chart_of_account)==null?void 0:U.code,name:(V=i.chart_of_account)==null?void 0:V.name},onChange:t=>{g({...i,chart_of_account_id:t.id,chart_of_account:{id:t.id,code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Jumlah",error:T.amount,children:e.jsx(Ce,{value:i.amount,onValueChange:t=>{g({...i,amount:t})}})}),e.jsxs(ve,{children:[e.jsx(l,{variant:"secondary",onClick:()=>{p({...m,show:!1})},children:"Batal"}),e.jsx(l,{onClick:ce,children:m.isEdit?"Ubah":"Tambah"})]})]})}),e.jsx(Oe,{onSave:he,errors:se,formDialog:_,setFormDialog:w,item:o,setItem:C,data:a}),e.jsx(l,{type:"button",onClick:me,children:"Simpan"})]})})}qe.layout=j=>e.jsx(Ae,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Transaksi",href:"#"},{label:"Produksi",href:"/admin/production"},{label:"Tambah",href:"#"}],children:j});export{qe as default};
