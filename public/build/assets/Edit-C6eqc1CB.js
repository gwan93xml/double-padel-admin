import{W as q,r as p,j as e,a as K,y as Y}from"./app-CQ-G37p-.js";import{S as Z}from"./SearchChartOfAccount-0Jd4yGJY.js";import{S as ee}from"./SearchDivision-Budjprvk.js";import{B as m}from"./button-ymMXdPy5.js";import{C as ae}from"./checkbox-DaA1krf_.js";import{C as f}from"./currency-formatter-D5vTOkIG.js";import{D as re,a as te,c as ie,d as se}from"./dialog-CBBIkam9.js";import{F as o}from"./form-group-CHZXn8bM.js";import{I as D}from"./input-BXXA-PDa.js";import{L as ne}from"./label-Blk7FhF1.js";import{M as P}from"./money-input-Bb590VQ4.js";import{T as oe,a as le,b as C,c as d,d as ce,e as n,f as de}from"./table-BSdxGOLt.js";import{T as R}from"./textarea-BvykTLwI.js";import{A as he}from"./AuthenticatedLayout-X6euxa7E.js";import{t as B}from"./use-toast-XJEkqv7A.js";import{P as me}from"./pencil-XLeJOTln.js";import{T as ue}from"./trash-C6VGYEst.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./file-text-vhY6aTSF.js";import"./index-D0iIn24t.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./tslib.es6-eMSY344_.js";import"./index-CZ_DqijM.js";import"./index-B9VoEdXn.js";import"./index-uJ2KZHf0.js";import"./index-BHS3gC_j.js";import"./index-C7S3ohsj.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./moment-C5S46NFB.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function xe({cashIn:v,accountReceivableHeader:pe,sale:fe,total_credit:M}){var y,S,k,F,A;const{data:t,setData:l,clearErrors:H,errors:u,setError:L}=q(v),[_,T]=p.useState(!1),[j,N]=p.useState(!1);p.useEffect(()=>{async function a(){const r=localStorage.getItem("cash-in.print-dialog");N(r==="1")}a()},[]),p.useEffect(()=>{localStorage.setItem("cash-in.print-dialog",j?"1":"0")},[j]);async function O(a){T(!0),H();try{const{data:r}=await K.put(`/admin/cash-in/${t.id}`,t);j&&window.open(`/admin/cash-in/${r.data.id}/print`,"_blank"),B({variant:"default",title:"Berhasil",description:"Kas masuk berhasil diubah"}),Y.visit("/admin/cash-in")}catch(r){if(r.response.status===422){const s=r.response.data.errors;L(s)}else B({title:"Error",description:r.response.data.message,variant:"destructive"})}finally{T(!1)}}const[c,x]=p.useState({show:!1,isEdit:!1,detailIndex:-1}),{data:i,setData:h,errors:b,setError:z,clearErrors:V}=q({});function $(){x({show:!0,isEdit:!1,detailIndex:-1}),h({chart_of_account:{id:"",name:"",code:""},chart_of_account_id:"",debit:"0",credit:"0",description:""})}const G=async()=>{try{return await K.post("/admin/cash-in/validate",i),V(),!0}catch(a){return z(a.response.data.errors),!1}};async function U(){await G()&&(c.isEdit?l(a=>{const r=[...a.details];return r[c.detailIndex]=i,{...a,details:r}}):l(a=>({...a,details:[...a.details,i]})),x({...c,show:!1,isEdit:!1,detailIndex:-1}))}async function W(a){x({show:!0,isEdit:!0,detailIndex:a}),h(t.details[a])}function J(a){l(r=>{const s=[...r.details];return s.splice(a,1),{...r,details:s}})}function Q(){return e.jsx("span",{className:"font-bold",children:e.jsx(f,{amount:E()})})}function X(){return e.jsx("span",{className:"font-bold",children:e.jsx(f,{amount:I()})})}function E(){var a;return((a=t.details)==null?void 0:a.reduce((r,s)=>r+parseFloat(s.debit),0))??0}function I(){var r;let a=((r=t.details)==null?void 0:r.reduce((s,g)=>s+parseFloat(g.credit),0))??0;return a=a+M,a}function w(){return E()-I()}return e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[e.jsx(o,{label:"Divisi",name:"division_id",required:!0,error:u.division_id,children:e.jsx(ee,{value:{id:t.division_id,name:(y=t.division)==null?void 0:y.name,code:(S=t.division)==null?void 0:S.code},onChange:a=>{l({...t,division_id:a.id,division:a})}})}),e.jsx(o,{label:"Nomor",name:"number",required:!0,error:u.number,children:e.jsx(D,{disabled:!0,value:t.number})}),e.jsx(o,{label:"Tanggal",name:"date",required:!0,error:u.date,children:e.jsx(D,{type:"date",value:t.date,onChange:a=>{l({...t,date:a.target.value})}})}),e.jsx(o,{label:"Terima Dari",name:"recipient",required:!0,error:u.received_from,children:e.jsx(D,{type:"text",value:t.received_from,onChange:a=>{l({...t,received_from:a.target.value})}})}),e.jsx("div",{className:"col-span-3",children:e.jsx(o,{label:"Catatan",name:"description",required:!0,error:u.description,children:e.jsx(R,{value:t.description,onChange:a=>{l({...t,description:a.target.value})}})})}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs(oe,{children:[e.jsx(le,{children:e.jsxs(C,{children:[e.jsx(d,{className:"w-[10px]",children:"NO."}),e.jsx(d,{children:"KODE"}),e.jsx(d,{children:"PERKIRAAN"}),e.jsx(d,{className:"text-end",children:"DEBET"}),e.jsx(d,{className:"text-end",children:"KREDIT"}),e.jsx(d,{children:"CATATAN"}),e.jsx(d,{className:"w-[50px]",children:"AKSI"})]})}),e.jsx(ce,{children:(k=t.details)==null?void 0:k.map((a,r)=>{var s,g;return e.jsxs(C,{children:[e.jsx(n,{className:"text-center",children:r+1}),e.jsx(n,{children:(s=a.chart_of_account)==null?void 0:s.code}),e.jsx(n,{children:(g=a.chart_of_account)==null?void 0:g.name}),e.jsx(n,{children:e.jsx(f,{amount:parseFloat(a.debit)??0})}),e.jsx(n,{children:e.jsx(f,{amount:parseFloat(a.credit)??0})}),e.jsx(n,{children:a.description}),e.jsx(n,{children:e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(m,{variant:"link",size:"sm",onClick:()=>W(r),children:e.jsx(me,{})}),e.jsx(m,{variant:"destructive",size:"sm",onClick:()=>J(r),children:e.jsx(ue,{})})]})})]},r)})}),e.jsx(de,{children:e.jsxs(C,{children:[e.jsx(n,{colSpan:3,className:"text-right font-bold",children:"Total"}),e.jsx(n,{className:"text-end font-bold",children:Q()}),e.jsx(n,{className:"text-end font-bold",children:X()}),e.jsx(n,{colSpan:2,className:"text-end font-bold",children:w()!==0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Selisih:"}),e.jsx(f,{amount:w()})]}):null})]})})]}),e.jsx(m,{className:"w-full",onClick:$,children:"Tambah Detail"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs(ne,{className:"",children:[e.jsx(ae,{className:"mr-2",checked:j,onCheckedChange:a=>{N(a)}}),e.jsx("span",{children:"Print"})]})}),e.jsx("div",{className:"col-span-3",children:e.jsx(m,{onClick:O,disabled:_,children:_?"Mengubah...":"Ubah"})})]}),e.jsx(re,{open:c.show,onOpenChange:a=>{x({...c,show:a})},children:e.jsxs(te,{className:" max-h-[80vh] overflow-y-auto",children:[e.jsx(ie,{children:"Detail"}),e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Perkiraan",error:b.chart_of_account_id,required:!0,children:e.jsx(Z,{value:{id:i.chart_of_account_id,name:(F=i.chart_of_account)==null?void 0:F.name,code:(A=i.chart_of_account)==null?void 0:A.code},onChange:a=>{h({...i,chart_of_account:a,chart_of_account_id:a.id})}})}),e.jsx(o,{label:"Debet",name:"debit",required:!0,error:b.debit,children:e.jsx(P,{value:i.debit,onValueChange:a=>{h({...i,debit:a})}})}),e.jsx(o,{label:"Kredit",name:"credit",required:!0,error:b.credit,children:e.jsx(P,{value:i.credit,onValueChange:a=>{h({...i,credit:a})}})}),e.jsx(o,{label:"Keterangan",name:"description",required:!0,error:b.description,children:e.jsx(R,{value:i.description,onChange:a=>{h({...i,description:a.target.value})}})})]}),e.jsxs(se,{children:[e.jsx(m,{variant:"outline",onClick:()=>{x({...c,show:!1})},children:"Tutup"}),e.jsx(m,{onClick:U,children:c.isEdit?"Simpan":"Tambah"})]})]})})]})}xe.layout=v=>e.jsx(he,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Akuntansi",href:"#"},{label:"Kas Masuk",href:"/admin/cash-in"},{label:"Edit",href:"#"}],children:v});export{xe as default};
