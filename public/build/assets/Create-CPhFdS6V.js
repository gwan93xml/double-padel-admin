import{W as C,r as s,a as u,j as t,y as B}from"./app-CQ-G37p-.js";import{h as f}from"./moment-C5S46NFB.js";import{t as E}from"./use-toast-XJEkqv7A.js";import{A as G}from"./AuthenticatedLayout-X6euxa7E.js";import{B as I}from"./button-ymMXdPy5.js";import{I as h}from"./input-BXXA-PDa.js";import{F as m}from"./form-group-CHZXn8bM.js";import{S as R}from"./select-remote-C3ahzpc3.js";import{L as J}from"./label-Blk7FhF1.js";import{T as V}from"./textarea-BvykTLwI.js";import{S as W}from"./SearchCustomer-BbTZ5_2l.js";import{S as z}from"./SearchDivision-Budjprvk.js";import{C as H}from"./checkbox-DaA1krf_.js";import K from"./SalesOrderItemForm-Cm5xpPzg.js";import Q from"./SalesOrderItemList-BCqY9dvk.js";import U from"./SalesOrderTotal-BhcGZWxx.js";import{P as X}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchSubUnit-CTrUekdR.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";import"./EmptyTable-CjEJGtgb.js";import"./table-BSdxGOLt.js";import"./pencil-XLeJOTln.js";import"./trash-C6VGYEst.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./lodash-Caeo88pO.js";function Z({division:l,defaultTypeOfTax:k}){var v,y,S,D;const{data:a,setData:o,errors:n,setError:Y,clearErrors:N}=C({vendor_id:"",type_of_tax_id:k.id,division_id:l.id,division:l,purchase_order_number:"",discount:"0",date:f().format("YYYY-MM-DD"),invoice_number:"",payment_method:"Credit",withdrawal_account_id:"",bank_account_id:"",due_date:f().add(1,"months").format("YYYY-MM-DD"),note:"",tax:0,tax_is_auto:!0,items:[],adjustments:[]}),[x,g]=s.useState(!1),{data:r,setData:_}=C(),[O,b]=s.useState({}),[T,w]=s.useState();s.useEffect(()=>{async function e(){const i=await u.get(`/admin/type-of-tax/${a.type_of_tax_id}`);w(i.data.data)}e()},[a.type_of_tax_id]);const[d,c]=s.useState({open:!1,isEdit:!1,index:0}),M=async()=>{var e;try{return await u.post("/admin/sales-order/validate",{item_id:r.item_id,item_name:r.item_name,unit:r.unit,item:{name:(e=r.item)==null?void 0:e.name},chart_of_account_id:r.chart_of_account_id,price:r.price,discount:r.discount,quantity:r.quantity,subtotal:r.subtotal,notes:r.notes}),b({}),!0}catch(i){return b(i.response.data.errors),!1}},P=async()=>{if(await M()){if(d.isEdit){const e=a.items;e[d.index]=r,o({...a,items:e})}else o("items",[...a.items,r]);c({...d,open:!1})}},q=async()=>{g(!0);try{N();const{data:e}=await u.post("/admin/sales-order",{...a,date:f(a.date).format("YYYY-MM-DD")});p&&window.open(`/admin/sales-order/${e.data.id}/print`,"_blank"),B.visit("/admin/sales-order/create"),E({title:"Berhasil",description:"Sales Order berhasil disimpan"})}catch(e){e.response.status==422?Y(e.response.data.errors):E({title:"Gagal",description:e.response.data.message,variant:"destructive"})}finally{g(!1)}},$=()=>{_({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},price:"0",quantity:"0",subtotal:"0",discount:"0",discount_percent:0,total:"0",notes:"",is_stock:!0}),c({open:!0,isEdit:!1,index:0})},F=(e,i)=>{_(i),c({open:!0,isEdit:!0,index:e})},L=e=>{var i;o({...a,items:(i=a.items)==null?void 0:i.filter((ee,A)=>e!=A)})};s.useEffect(()=>{u.get("/admin/sales-order/generate-number").then(({data:e})=>{o("number",e.number)})},[]);const[p,j]=s.useState(!1);return s.useEffect(()=>{async function e(){const i=localStorage.getItem("sales-order.print-dialog");j(i==="1")}e()},[]),s.useEffect(()=>{localStorage.setItem("sales-order.print-dialog",p?"1":"0")},[p]),t.jsxs("div",{className:"pt-5  px-5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(m,{label:"Pelanggan",error:n.customer_id,name:"customer_id",children:t.jsx(W,{value:{id:`${a.customer_id}`,code:`${((v=a.customer)==null?void 0:v.code)??""}`,name:`${((y=a.customer)==null?void 0:y.name)??""}`},onChange:e=>{o({...a,customer_id:e.id,customer:e})}})}),t.jsx(m,{label:"Jenis Pajak",error:n.type_of_tax_id,name:"type_of_tax_id",children:t.jsx(R,{remoteConfig:{url:"/admin/type-of-tax/list",label:e=>e.name,value:e=>e.id.toString()},value:a.type_of_tax_id,onValueChange:e=>{o({...a,type_of_tax_id:e})}})}),t.jsx(m,{label:"Divisi",error:n.division_id,name:"division_id",children:t.jsx(z,{value:{id:a.division_id,code:(S=a.division)==null?void 0:S.code,name:(D=a.division)==null?void 0:D.name},onChange:e=>{o({...a,division_id:e.id,division:e})}})}),t.jsx(m,{label:"Tanggal",error:n.date,name:"date",children:t.jsx(h,{type:"date",value:a.date,onChange:e=>{o({...a,date:e.target.value})}})}),t.jsx(m,{label:"Nomor",error:n.number,name:"number",required:!0,children:t.jsx(h,{type:"text",value:"???",disabled:!0})}),t.jsx(m,{label:"Nomor PO.",error:n.purchase_order_number,name:"purchase_order_number",required:!0,children:t.jsx(h,{type:"text",value:a.purchase_order_number,onChange:e=>{o({...a,purchase_order_number:e.target.value})}})}),t.jsx("div",{className:"col-span-3",children:t.jsx(m,{label:"Catatan",error:n.notes,name:"note",children:t.jsx(V,{value:a.notes,onChange:e=>{o({...a,notes:e.target.value})}})})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(Q,{items:a.items??[],onEdit:F,onDelete:L}),t.jsx(I,{className:"w-full",onClick:$,children:t.jsx(X,{})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(U,{data:a,setData:o,type_ofTax:T})})]}),t.jsx("div",{className:"mb-3",children:t.jsxs(J,{className:"",children:[t.jsx(H,{className:"mr-2",checked:p,onCheckedChange:e=>{j(e)}}),t.jsx("span",{children:"Cetak setelah disimpan"})]})}),t.jsx(I,{type:"button",onClick:q,disabled:x,children:x?"Menyimpan...":"Simpan"}),t.jsx(K,{data:r,setData:_,errors:O,onSave:P,onOpenChange:e=>{c({...d,open:e})},formDialog:d})]})}Z.layout=l=>t.jsx(G,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Sales Order",href:"/admin/sales-order"},{label:"Tambah",href:"#"}],children:l});export{Z as default};
