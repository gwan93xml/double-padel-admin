import{r as l,a as se,j as e,R as re}from"./app-CQ-G37p-.js";import{T as H,a as L,b as u,c as D,d as M,e as b,f as ae}from"./table-BSdxGOLt.js";import{C as P,a as _,b as K,c as te,d as V}from"./card-Bq41eL_q.js";import{B}from"./button-ymMXdPy5.js";import{L as U}from"./list-DIayZXqH.js";import{F as le}from"./filter-BZN7rDIQ.js";import{F as ne}from"./file-text-vhY6aTSF.js";import{F as ie}from"./file-spreadsheet-Dv5Qp-1R.js";function fe(z){const{title:I,description:C,fetchUrl:$,exportPdfUrl:F,exportExcelUrl:w,initialFilters:J,renderFilter:O,columns:o,detailInline:d,isMerged:S}=z,[x,q]=l.useState(J),[c,A]=l.useState([]),[T,G]=l.useState(1),[g,Q]=l.useState(!0),p=l.useRef(null),j=l.useRef(!1),[y,E]=l.useState(!1),W=l.useCallback((s,t)=>{if(!S||s===0)return!1;const a=o.find(N=>N.key===t);if(!(a!=null&&a.isMerged))return!1;const r=c[s],n=c[s-1],i=(N,k)=>{if(k.mergeKey){const h=String(k.mergeKey).split(".");let f=N;for(const ee of h)f=f==null?void 0:f[ee];return f}const m=k.renderCell(N,s);if(typeof m=="string"||typeof m=="number")return m;if(re.isValidElement(m)){const h=m.props.children;return typeof h=="string"||typeof h=="number"?h:JSON.stringify(h)}return String(m)},Y=i(r,a),Z=i(n,a);return Y===Z},[c,o,S]),v=l.useCallback(async(s=1,t=!1)=>{if(j.current||!t&&!g)return;E(!0),j.current=!0;const a=t?1:s;try{const{data:r}=await se.get($,{params:{...x,page:a}}),n=r.data??[];A(i=>t?n:[...i,...n]),Q(r.next_page_url!==null),G(r.current_page)}catch(r){console.error("Error loading report:",r)}finally{j.current=!1,E(!1)}},[T,x,$,g]),R=()=>{if(!p.current||j.current||!g)return;const{scrollTop:s,scrollHeight:t,clientHeight:a}=p.current;s+a>=t-100&&v(T+1)},X=()=>{v(1,!0)};return l.useEffect(()=>{v(1,!0)},[]),l.useEffect(()=>{const s=p.current;if(s)return s.addEventListener("scroll",R),()=>s.removeEventListener("scroll",R)},[c,y,g]),e.jsxs("div",{ref:p,className:"h-screen overflow-y-auto p-4 md:p-6 bg-gradient-to-br ",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",children:e.jsx(U,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold ",children:I}),C&&e.jsx("p",{className:"",children:C})]})]})}),e.jsxs(P,{className:"mb-6 shadow-lg ",children:[e.jsxs(_,{className:"bg-gradient-to-r border-b",children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"})," Filter Laporan"]}),e.jsx(te,{className:"",children:"Sesuaikan filter untuk menampilkan data"})]}),e.jsx(V,{className:"p-6",children:O(x,q,X)})]}),c.length>0&&e.jsxs("div",{className:"mb-4 flex justify-end gap-2",children:[F&&e.jsx(B,{variant:"outline",size:"sm",asChild:!0,className:"",children:e.jsxs("a",{href:F(x),target:"_blank",rel:"noreferrer",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"})," PDF"]})}),w&&e.jsx(B,{variant:"outline",size:"sm",asChild:!0,className:"",children:e.jsxs("a",{href:w(x),target:"_blank",rel:"noreferrer",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"})," Excel"]})})]}),e.jsxs(P,{className:"shadow-lg ",children:[e.jsx(_,{className:" border-b",children:e.jsxs(K,{className:"text-xl flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"})," Detail"]})}),e.jsx(V,{className:"p-0",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(u,{className:"bg-gradient-to-r ",children:o.map(s=>e.jsx(D,{className:s.align==="right"?"text-right":"",children:s.header},`header-${s.key}`))})}),e.jsx(M,{children:c.map((s,t)=>{const a=d?d.rowKey(s,t):`row-${t}`;return e.jsxs(l.Fragment,{children:[e.jsx(u,{children:o.map(r=>{const n=W(t,r.key);return e.jsx(b,{className:r.align==="right"?"text-right":"",children:n?null:r.renderCell(s,t)},`${a}-c-${r.key}`)})}),d&&e.jsx(u,{children:e.jsx(b,{colSpan:o.length,className:"p-0",children:e.jsx("div",{className:"pl-8",children:e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(u,{className:"bg-gray-100",children:d.columns.map(r=>e.jsx(D,{className:r.align==="right"?"text-right":"",children:r.header},`${a}-d-h-${r.key}`))})}),e.jsx(M,{children:d.getDetails(s).map((r,n)=>e.jsx(u,{className:"bg-white",children:d.columns.map(i=>e.jsx(b,{className:`${i.width??""} ${i.align==="right"?"text-right":""}`,children:i.renderCell(r,n)},`${a}-d-${n}-c-${i.key}`))},`${a}-d-${n}`))})]})})})})]},`master-${t}-${a}`)})}),e.jsx(ae,{children:e.jsx(u,{className:"bg-gradient-to-r  border-t-2",children:o.map(s=>e.jsx(b,{className:s.align==="right"?"text-right font-bold":"font-bold",children:s.renderFooter?s.renderFooter(c):null},`footer-${s.key}`))})})]}),y&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Memuat dataâ€¦"}),!g&&!y&&e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Tidak ada lagi data."})]})})]})]})}export{fe as R};
