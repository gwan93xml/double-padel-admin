import{r as s,a as B,j as n}from"./app-CQ-G37p-.js";import{B as z}from"./button-ymMXdPy5.js";import{I as A}from"./input-BXXA-PDa.js";import{C as W,d as Z}from"./card-Bq41eL_q.js";import{L as H}from"./loader-circle-i2ANfqrZ.js";import{S as ee}from"./search-B9EA-nRY.js";import{X as te}from"./x-D2Pel9EU.js";function le({onChange:N,value:u,clearable:_}){const[a,d]=s.useState({id:"",code:"",name:"",phone:""}),[j,m]=s.useState(!1),[D,r]=s.useState(""),[p,i]=s.useState([]),[P,o]=s.useState(!1),[y,b]=s.useState(1),[L,w]=s.useState(!0),[x,K]=s.useState(!1),[ne,k]=s.useState(""),l=s.useRef(null),Q=200,I=s.useRef(null),C=s.useRef(null),$=s.useRef(!1),g=s.useRef(null),v=s.useRef(null),[f,h]=s.useState(null);s.useEffect(()=>{u&&d({id:u.id||"",code:u.code||"",name:u.name||"",phone:u.phone||""})},[u]),s.useEffect(()=>{if(!j&&!x&&f){const t=setTimeout(()=>{f==="code"&&g.current?g.current.focus():f==="name"&&v.current&&v.current.focus()},0);return()=>clearTimeout(t)}},[j,x,f]),s.useEffect(()=>{const t=e=>{I.current&&!I.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const U=t=>{const e=t.target.value;h("code"),d({...a,code:e}),k(e),O(e,!0),r("")},V=t=>{const e=t.target.value;h("name"),d({...a,name:e}),k(e),O(e,!0),r("")},F=async t=>{if(t.trim()){m(!0),r("");try{const{data:e}=await B.get(`/admin/vendor/search-by-code?search=${t}`);e.data?($.current=!0,d({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),N({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),o(!1)):r("Vendor not found")}catch(e){r("Failed to search vendor"),console.error(e)}finally{m(!1)}}},M=async t=>{if(t.trim()){m(!0),r("");try{const{data:e}=await B.get(`/admin/vendor/search-by-name?search=${t}`);e.data?($.current=!0,d({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),N({id:e.data.id,code:e.data.code,name:e.data.name,phone:e.data.phone}),o(!1)):r("Vendor not found")}catch(e){r("Failed to search vendor"),console.error(e)}finally{m(!1)}}},X=t=>{t.key==="Enter"&&(F(a.code??""),o(!1),i([]))},Y=t=>{t.key==="Enter"&&(M(a.name??""),o(!1),i([]))},q=()=>{a.code?F(a.code):a.name&&M(a.name)},S=s.useCallback(async(t,e,T=!1)=>{e===1?m(!0):K(!0);try{const{data:c}=await B.get(`/admin/vendor/browse?search=${t}&page=${e}&limit=20`);i(T||e===1?c.data||[]:E=>[...E,...c.data||[]]),w(c.next_page_url!==null),o(c.data&&c.data.length>0)}catch(c){console.error("Error fetching vendors:",c),r("Failed to load vendors")}finally{m(!1),K(!1)}},[]),O=s.useCallback((t,e=!1)=>{if(l.current&&clearTimeout(l.current),t.length<2){i([]),o(!1),b(1),w(!0);return}l.current=setTimeout(()=>{e&&(b(1),w(!0)),S(t,e?1:y,e)},Q)},[S,y]),R=s.useCallback(()=>{if(!C.current||x||!L)return;const{scrollTop:t,scrollHeight:e,clientHeight:T}=C.current;if(t+T>=e-5){const c=f==="code"?a.code:a.name;if(c&&c.length>=2){const E=y+1;b(E),S(c,E,!1)}}},[x,L,a.code,a.name,y,S]);s.useEffect(()=>{const t=C.current;if(t)return t.addEventListener("scroll",R),()=>t.removeEventListener("scroll",R)},[R]);const G=t=>{const e=f;d({id:t.id,code:t.code,name:t.name,phone:t.phone}),N({id:t.id,code:t.code,name:t.name,phone:t.phone}),i([]),o(!1),r(""),setTimeout(()=>{e==="code"&&g.current?g.current.focus():e==="name"&&v.current&&v.current.focus()},0)},J=()=>{l.current&&clearTimeout(l.current),d({id:"",code:"",name:"",phone:""}),N({id:"",code:"",name:"",phone:""}),k(""),i([]),o(!1),r(""),b(1),w(!0)};return s.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),n.jsxs("div",{className:"space-y-2 relative",ref:I,children:[n.jsxs("div",{className:"flex items-center space-x-0 border rounded-lg overflow-hidden bg-background",children:[n.jsx("div",{className:"flex-1 min-w-0",children:n.jsx(A,{ref:g,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kode Vendor",value:a.code,onChange:U,onKeyDown:X,onFocus:()=>{h("code"),p.length>0&&o(!0)},onBlur:()=>{setTimeout(()=>h(null),150)}})}),n.jsx("div",{className:"border-l border-r",children:n.jsx(z,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:q,disabled:j,children:j?n.jsx(H,{className:"h-4 w-4 animate-spin"}):n.jsx(ee,{className:"h-4 w-4"})})}),n.jsx("div",{className:"flex-[2] min-w-0",children:n.jsx(A,{ref:v,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nama Vendor",value:a.name,onChange:V,onKeyDown:Y,onFocus:()=>{h("name"),p.length>0&&o(!0)},onBlur:()=>{setTimeout(()=>h(null),150)}})}),_&&n.jsx("div",{className:"border-l",children:n.jsx(z,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:J,children:n.jsx(te,{className:"h-4 w-4"})})})]}),P&&p.length>0&&n.jsx(W,{className:"absolute top-full left-0 right-0 z-50 mt-1 shadow-lg border",children:n.jsx(Z,{className:"p-0",children:n.jsxs("div",{ref:C,className:"max-h-64 overflow-y-auto",children:[n.jsx("div",{className:"sticky top-0 bg-muted/50 border-b px-4 py-2",children:n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-muted-foreground",children:[n.jsx("div",{children:"Kode"}),n.jsx("div",{children:"Nama"})]})}),n.jsxs("div",{className:"divide-y",children:[p.map((t,e)=>n.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>G(t),children:[n.jsx("div",{className:"text-sm font-medium truncate",children:t.code}),n.jsx("div",{className:"text-sm truncate col-span-3",children:t.name})]},`${t.id}-${e}`)),x&&n.jsxs("div",{className:"flex items-center justify-center py-4",children:[n.jsx(H,{className:"h-4 w-4 animate-spin mr-2"}),n.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more..."})]}),!L&&p.length>0&&n.jsx("div",{className:"text-center py-4 text-sm text-muted-foreground",children:"No more vendors to load"})]})]})})}),D&&n.jsx("div",{className:"text-sm text-destructive bg-destructive/10 px-3 py-2 rounded-md",children:D})]})}export{le as S};
