import{W as T,r as n,a as u,j as t,y as E}from"./app-CQ-G37p-.js";import{h}from"./moment-C5S46NFB.js";import{t as Y}from"./use-toast-XJEkqv7A.js";import{A as L}from"./AuthenticatedLayout-X6euxa7E.js";import{P as R}from"./PinButton-Dxqdf0Ds.js";import{B as k}from"./button-ymMXdPy5.js";import{I as l}from"./input-BXXA-PDa.js";import{F as o}from"./form-group-CHZXn8bM.js";import{S as H}from"./select-remote-C3ahzpc3.js";import{T as z}from"./textarea-BvykTLwI.js";import{S as K}from"./SearchWarehouse-Bw-VGbhg.js";import{S as Q}from"./SearchDivision-Budjprvk.js";import{S as U}from"./SearchVendor-DVTa9TJs.js";import{S as X}from"./SearchPurchaseOrder-CkgEB0Ok.js";import{C as Z}from"./CashCredit-BZxMHD02.js";import ee from"./PurchaseTotal-CaWbvIxL.js";import re from"./PurchaseItemForm-CoK8QZd3.js";import te from"./PurchaseItemList-DIyn9dWX.js";import{I as ae}from"./InputWithHistory-DuCNlgmq.js";import{P as ie}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./dialog-CBBIkam9.js";import"./table-BSdxGOLt.js";import"./folder-BoHnSs8n.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./money-input-Bb590VQ4.js";import"./lodash-Caeo88pO.js";import"./pencil-XLeJOTln.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchItemNonStock-BQ2Ydllm.js";import"./SearchSubUnit-CTrUekdR.js";import"./EmptyTable-CjEJGtgb.js";import"./trash-C6VGYEst.js";function oe({division:m,warehouse:f,defaultTypeOfTax:$}){var j,g,C,P,S,D,I;const{data:e,setData:a,errors:i,setError:N,clearErrors:M}=T({vendor_id:"",type_of_tax_id:$.id,division_id:m.id,division:m,discount:"0",purchase_discount:"0",purchase_discount_percent:"0",warehouse_id:f.id,warehouse:f,purchase_date:h().format("YYYY-MM-DD"),invoice_number:"",payment_method:"Credit",purchase_account_id:"",withdrawal_account_id:"",bank_account_id:"",due_date:h().add(1,"months").format("YYYY-MM-DD"),note:"",items:[],adjustments:[],shipping_cost:"0",stamp_duty:"0",tax:0,tax_is_auto:!0}),[x,v]=n.useState(!1),{data:c,setData:_}=T({is_stock:!0}),[q,b]=n.useState({}),[F,B]=n.useState();n.useEffect(()=>{async function r(){const s=await u.get(`/admin/type-of-tax/${e.type_of_tax_id}`);B(s.data.data)}e.type_of_tax_id&&r()},[e.type_of_tax_id]);const[d,p]=n.useState({open:!1,isEdit:!1,index:0}),O=async()=>{try{return await u.post("/admin/purchase/validate",c),b({}),!0}catch(r){return b(r.response.data.errors),!1}},A=async(r=!1)=>{if(await O()){if(d.isEdit){const s=e.items;s[d.index]=c,a({...e,items:s})}else a("items",[...e.items,c]);p({...d,open:!1}),r&&setTimeout(()=>{y()},1e3)}},G=async()=>{v(!0);try{M();const r=await u.post("/admin/purchase",{...e,purchase_date:h(e.purchase_date).format("YYYY-MM-DD")});e.payment_method=="Cash"?E.visit(`/admin/cash-out/create?purchase_id=${r.data.data.id}`):E.visit("/admin/purchase/create"),Y({title:"Berhasil",description:"Pembelian berhasil disimpan"})}catch(r){r.response.status==422?N(r.response.data.errors):Y({variant:"destructive",title:"Gagal",description:r.response.data.message})}finally{v(!1)}},y=()=>{_({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},price:"0",discount:"0",discount_percent:0,total:"0",quantity:"0",subtotal:"0",notes:"",is_stock:!0}),p({open:!0,isEdit:!1,index:0})},V=(r,s)=>{_(s),p({open:!0,isEdit:!0,index:r})},W=r=>{var s;a({...e,items:(s=e.items)==null?void 0:s.filter((w,J)=>r!=J)})};return n.useEffect(()=>{e.purchase_order_id&&u.get(`/admin/purchase-order/${e.purchase_order_id}`).then(r=>{const s=r.data.data;a({...e,items:s.items.map(w=>({...w}))})})},[e.purchase_order_id]),t.jsxs("div",{className:"pt-5 px-5",children:[t.jsx(R,{isPinned:e.is_pinned||!1,onToggle:()=>{a({...e,is_pinned:!e.is_pinned})}}),t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(o,{label:"Divisi",error:i.division_id,name:"division_id",children:t.jsx(Q,{value:{id:e.division_id,code:(j=e.division)==null?void 0:j.code,name:(g=e.division)==null?void 0:g.name},onChange:r=>{a({...e,division_id:r.id,division:{id:r.id,code:r.code,name:r.name}})},clearable:!0})}),t.jsx(o,{label:"Vendor",error:i.vendor_id,name:"vendor_id",required:!0,children:t.jsx(U,{value:{id:`${e.vendor_id}`,code:`${((C=e.vendor)==null?void 0:C.code)??""}`,name:`${((P=e.vendor)==null?void 0:P.name)??""}`,phone:`${((S=e.vendor)==null?void 0:S.phone)??""}`},onChange:r=>{a({...e,vendor_id:r.id,vendor:{id:r.id,code:r.code,name:r.name}})}})}),t.jsx(o,{label:"Jenis Pajak",error:i.type_of_tax_id,name:"type_of_tax_id",children:t.jsx(H,{remoteConfig:{url:"/admin/type-of-tax/list",label:r=>r.name,value:r=>r.id.toString()},value:e.type_of_tax_id,onValueChange:r=>{a({...e,type_of_tax_id:r})}})}),t.jsx(o,{label:"Gudang",error:i.warehouse_id,name:"warehouse_id",required:!0,children:t.jsx(K,{value:{id:`${e.warehouse_id}`,code:`${((D=e.warehouse)==null?void 0:D.code)??""}`,name:`${((I=e.warehouse)==null?void 0:I.name)??""}`},onChange:r=>{a({...e,warehouse_id:r.id,warehouse:{id:r.id,code:r.code,name:r.name}})}})}),t.jsx(o,{label:"Tanggal",error:i.purchase_date,name:"purchase_date",children:t.jsx(l,{type:"date",value:e.purchase_date,onChange:r=>{a({...e,purchase_date:r.target.value})}})}),t.jsx(o,{label:"Nomor",error:i.no,name:"no",required:!0,children:t.jsx(l,{type:"text",value:e.no,onChange:r=>{a({...e,no:r.target.value})}})}),t.jsx(o,{label:"Nomor Invoice",error:i.invoice_number,name:"invoice_number",required:!0,children:t.jsx(ae,{value:e.invoice_number??"",onChange:r=>{a({...e,invoice_number:r})},endpoint:"/admin/purchase/invoices",historyColumns:["invoice_number","number"]})}),t.jsx(o,{label:"No. PO",error:i.purchase_order_number,name:"purchase_order_number",children:t.jsx(X,{vendorId:e.vendor_id,value:{id:e.purchase_order_id,number:e.purchase_order_number},onChange:r=>{a({...e,purchase_order_id:r.id,purchase_order_number:r.number})}})}),t.jsx(o,{label:"Metode Pembayaran",error:i.payment_method,name:"payment_method",required:!0,children:t.jsx(Z,{value:e.payment_method??"Credit",onChange:r=>{a({...e,payment_method:r})}})}),t.jsx(o,{label:"Faktur Pajak",error:i.tax_invoice_number,name:"tax_invoice_number",required:!0,children:t.jsx(l,{type:"text",value:e.tax_invoice_number,onChange:r=>{a({...e,tax_invoice_number:r.target.value})}})}),e.payment_method=="Credit"&&t.jsx(o,{label:"Jatuh Tempo",error:i.due_date,name:"due_date",children:t.jsx(l,{type:"date",value:e.due_date,onChange:r=>{a({...e,due_date:r.target.value})}})}),t.jsx("div",{className:"col-span-3",children:t.jsx(o,{label:"Catatan",error:i.note,name:"note",children:t.jsx(z,{value:e.note,onChange:r=>{a({...e,note:r.target.value})}})})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(te,{items:e.items??[],onEdit:V,onDelete:W}),t.jsx(k,{className:"w-full",onClick:y,children:t.jsx(ie,{})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(ee,{data:e,type_ofTax:F,setData:a})})]}),t.jsx(k,{type:"button",onClick:G,disabled:x,children:x?"Menyimpan...":"Simpan"}),t.jsx(re,{warehouse_id:e.warehouse_id,formDialog:d,onOpenChange:()=>{p({...d,open:!1})},data:c,setData:_,errors:q,onSave:A})]})}oe.layout=m=>t.jsx(L,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Pembelian",href:"/admin/purchase"},{label:"Tambah",href:"#"}],children:m});export{oe as default};
