import{r as j,W as L,j as e,a as m,y as D}from"./app-CQ-G37p-.js";import{S as V}from"./SearchItem-DGpcvLrN.js";import{S as $,a as A,b as K}from"./SearchUnitReport-BSGRusST.js";import{S as M}from"./SearchVendor-DVTa9TJs.js";import{B as W}from"./button-ymMXdPy5.js";import{C as P}from"./checkbox-DaA1krf_.js";import{F as c}from"./form-group-CHZXn8bM.js";import{I as f}from"./input-BXXA-PDa.js";import{L as E}from"./label-Blk7FhF1.js";import{M as B}from"./money-input-Bb590VQ4.js";import{T as G,a as O,b as I,c as h,d as J,e as _}from"./table-BSdxGOLt.js";import{T as z}from"./textarea-BvykTLwI.js";import{t as g}from"./use-toast-XJEkqv7A.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./package-Cd0mGsRo.js";import"./select-BSIJzAmS.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./index-D0iIn24t.js";import"./tslib.es6-eMSY344_.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-uJ2KZHf0.js";function qe({item:R,isEdit:p=!1}){var k,C,y,S,N,q,w,T;const x=j.useRef(!1),{data:r,setData:a,reset:Q,errors:s,setError:U,clearErrors:F}=L(R||{item_category_id:"",code:"",name:"",barcode:"",unit:"",purchase_price:"",selling_price:"",is_linked:!1,is_stock_managed:!1,stock_method:"",vendor_id:"",vendor:void 0,units:[]}),[b,v]=j.useState(!1);async function H(){F(),v(!0);try{p?(await m.put(`/admin/item/${r.id}`,r),g({title:"Sukses",description:"Data item berhasil diubah"}),D.visit("/admin/item")):(await m.post("/admin/item",r),g({title:"Sukses",description:"Data item berhasil disimpan"}),D.visit("/admin/item/create"))}catch(i){if(i.response.status===422){const t=i.response.data.errors;U(t)}else g({variant:"destructive",title:"Gagal",description:i.response.data.message})}finally{v(!1)}}return j.useEffect(()=>{async function i(){var t;if(!x.current){if(x.current=!0,r.unit)try{if(p&&r.id){const d=await m(`/admin/item/${r.id}/units`);a("units",d.data.data.units);const l=(t=d.data.data.units.find(u=>u.is_purchase_price))==null?void 0:t.name,o=(await m(`/admin/unit/${r.unit}/by-unit`)).data.data.sub_units.map(u=>({...u,is_purchase_price:u.name===l}));a("units",o)}else{const l=(await m(`/admin/unit/${r.unit}/by-unit`)).data.data.sub_units.map(n=>({...n,is_purchase_price:!!n.is_purchase_price}));a("units",l)}}catch(d){console.error("Failed to fetch units:",d);const n=(await m(`/admin/unit/${r.unit}/by-unit`)).data.data.sub_units.map(o=>({...o,is_purchase_price:!!o.is_purchase_price}));a("units",n)}x.current=!1}}i()},[r.unit,p,r.id]),e.jsxs("div",{className:"p-5 mb-96",children:[e.jsx(c,{label:"Kode",name:"code",error:s.code,required:!0,children:e.jsx(f,{value:r.code,onChange:i=>{a({...r,code:i.target.value})}})}),e.jsx(c,{label:"Nama",name:"name",error:s.name,required:!0,children:e.jsx(f,{value:r.name,onChange:i=>{a({...r,name:i.target.value})}})}),e.jsx(c,{label:"Kategori",name:"item_category_id",error:s.item_category_id,required:!0,children:e.jsx($,{value:r.item_category_id,onChange:i=>{a({...r,item_category_id:i})}})}),e.jsxs("div",{className:"flex gap-x-3 mb-3",children:[e.jsxs("div",{className:"w-2/3",children:[e.jsx(c,{label:"Satuan",name:"unit",error:s.unit,required:!0,children:e.jsx(A,{value:r.unit,onChange:i=>{a(t=>({...t,unit:i,unit_report_1:"",unit_report_2:""}))}})}),e.jsx(c,{label:"Laporan",name:"unit",error:s.unit_report_1||s.unit_report_2,required:!0,children:e.jsx(K,{value1:r.unit_report_1,value2:r.unit_report_2,unit:r.unit,onChange1:i=>{a(t=>({...t,unit_report_1:i}))},onChange2:i=>{a(t=>({...t,unit_report_2:i}))}})})]}),e.jsx("div",{className:"w-1/3",children:e.jsxs(G,{children:[e.jsx(O,{children:e.jsxs(I,{children:[e.jsx(h,{children:"NO"}),e.jsx(h,{children:"SATUAN"}),e.jsx(h,{className:"w-[100px]",children:"KONVERSI"}),e.jsx(h,{}),e.jsx(h,{className:"w-[150px]",children:"HARGA BELI"})]})}),e.jsx(J,{children:(k=r.units)==null?void 0:k.map((i,t)=>{var d;return e.jsxs(I,{children:[e.jsx(_,{children:t+1}),e.jsx(_,{children:i.name}),e.jsx(_,{children:e.jsx(f,{type:"number",className:"text-end",value:i.conversion,onChange:l=>{var n;a("units",(n=r.units)==null?void 0:n.map((o,u)=>u===t?{...o,conversion:l.target.value}:o))}})}),e.jsx(_,{children:(d=r.units[0])==null?void 0:d.name}),e.jsx(_,{children:e.jsx(P,{checked:!!i.is_purchase_price,onCheckedChange:l=>{var n;a("units",(n=r.units)==null?void 0:n.map((o,u)=>u===t?{...o,is_purchase_price:l}:l?{...o,is_purchase_price:!1}:o))}})})]},t)})})]})})]}),e.jsx(c,{name:"is_linked",error:s.is_linked,required:!0,children:e.jsxs("div",{className:"flex mb-3",children:[e.jsx(P,{checked:r.is_linked,id:"is_linked",onCheckedChange:i=>{a({...r,is_linked:i})}}),e.jsx(E,{className:"ml-2",htmlFor:"is_linked",children:"Produk Terkait"})]})}),r.is_linked?e.jsx(c,{label:"Produk",name:"linked_item_id",error:s.linked_item_id,required:!0,children:e.jsx(V,{value:{id:r.linked_item_id??"",name:((C=r.linked_item)==null?void 0:C.name)??"",code:((y=r.linked_item)==null?void 0:y.code)??"",purchase_price:((S=r.linked_item)==null?void 0:S.purchase_price)??"",selling_price:((N=r.linked_item)==null?void 0:N.selling_price)??"",unit:((q=r.linked_item)==null?void 0:q.unit)??""},onChange:i=>{a({...r,linked_item_id:i.id,linked_item:i})}})}):null,e.jsx(c,{label:"Harga Beli",error:s.purchase_price,required:!0,children:e.jsx(B,{value:r.purchase_price,onValueChange:i=>{a("purchase_price",i)}})}),e.jsx(c,{label:"Harga Jual",error:s.selling_price,required:!0,children:e.jsx(B,{value:r.selling_price,onValueChange:i=>{a("selling_price",i)}})}),e.jsx(c,{label:"Keterangan",required:!0,error:s.description,children:e.jsx(z,{value:r.description,onChange:i=>{a("description",i.target.value)}})}),e.jsx(c,{label:"Vendor",required:!0,error:s.vendor_id,children:e.jsx(M,{value:{id:r.vendor_id??"",name:((w=r.vendor)==null?void 0:w.name)??"",code:((T=r.vendor)==null?void 0:T.code)??""},onChange:i=>{var t;a({...r,vendor:i,vendor_id:(t=i.id)==null?void 0:t.toString()})}})}),e.jsx("br",{}),e.jsx(W,{disabled:b,onClick:H,children:b?p?"Mengubah...":"Menyimpan...":p?"Ubah":"Simpan"})]})}export{qe as default};
