import{W as v,r as n,j as r,a as g}from"./app-CQ-G37p-.js";import"./moment-C5S46NFB.js";import{t as D}from"./use-toast-XJEkqv7A.js";import{A as N}from"./AuthenticatedLayout-X6euxa7E.js";import{P as A}from"./PinButton-Dxqdf0Ds.js";import{B as k}from"./button-ymMXdPy5.js";import{A as w,a as E}from"./alert-QQ3yNdZx.js";import{I as m}from"./input-BXXA-PDa.js";import{F as o}from"./form-group-CHZXn8bM.js";import{S as F}from"./select-remote-C3ahzpc3.js";import{T as q}from"./textarea-BvykTLwI.js";import{S as L}from"./SearchVendor-DVTa9TJs.js";import{S as R}from"./SearchWarehouse-Bw-VGbhg.js";import{S as B}from"./SearchDivision-Budjprvk.js";import{C as $}from"./CashCredit-BZxMHD02.js";import V from"./PurchaseItemForm-CoK8QZd3.js";import W from"./PurchaseTotal-CaWbvIxL.js";import G from"./PurchaseItemList-DIyn9dWX.js";import{I as J}from"./InputWithHistory-DuCNlgmq.js";import{D as M}from"./detail-audit-dialog-D71KXIhT.js";import{T as O}from"./triangle-alert-byTh5Szo.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchItemNonStock-BQ2Ydllm.js";import"./SearchSubUnit-CTrUekdR.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./lodash-Caeo88pO.js";import"./pencil-XLeJOTln.js";import"./EmptyTable-CjEJGtgb.js";import"./table-BSdxGOLt.js";import"./trash-C6VGYEst.js";import"./scroll-area-Db0TZtic.js";import"./circle-alert-DNqBTniX.js";function H({purchase:p}){var c,h,_,x,b,f;const{data:e,setData:t,errors:i,setError:U,clearErrors:Y}=v(p),{data:d,setData:j}=v({});n.useState(!1);const[y,l]=n.useState({}),[P,C]=n.useState();n.useEffect(()=>{async function a(){const T=await g.get(`/admin/type-of-tax/${e.type_of_tax_id}`);C(T.data.data)}a()},[e.type_of_tax_id]),n.useEffect(()=>{e.payment_status==="paid"&&D({variant:"default",title:"Informasi Pembelian",description:"Pembelian ini sudah lunas/dibayar. Perubahan data mungkin memerlukan penyesuaian pembayaran.",duration:8e3})},[]);const[s,u]=n.useState({open:!1,isEdit:!1,index:0}),I=async()=>{try{return await g.post("/admin/purchase/validate",d),l({}),!0}catch(a){return l(a.response.data.errors),!1}},S=async()=>{if(await I()){if(s.isEdit){const a=e.items;a[s.index]=d,t({...e,items:a})}else t("items",[...e.items,d]);u({...s,open:!1})}};return r.jsxs("div",{className:"pt-5  px-5",children:[r.jsx(A,{isPinned:e.is_pinned||!1,onToggle:()=>{t({...e,is_pinned:!e.is_pinned})}}),e.payment_status==="paid"&&r.jsxs(w,{className:"mb-4 border-amber-200 bg-amber-50",children:[r.jsx(O,{className:"h-4 w-4 text-amber-600"}),r.jsxs(E,{className:"text-amber-800",children:[r.jsx("strong",{children:"Perhatian:"})," Pembelian ini sudah dalam status ",r.jsx("strong",{children:"LUNAS/DIBAYAR"}),". Perubahan pada data pembelian ini dapat mempengaruhi catatan keuangan dan mungkin memerlukan penyesuaian pembayaran."]})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[r.jsx(o,{label:"Vendor",error:i.vendor_id,name:"vendor_id",children:r.jsx(L,{value:{id:e.vendor_id,code:(c=e.vendor)==null?void 0:c.code,name:(h=e.vendor)==null?void 0:h.name},onChange:a=>{t({...e,vendor_id:a.id,vendor:{id:a.id,code:a.code,name:a.name}})}})}),r.jsx(o,{label:"Jenis Pajak",error:i.type_of_tax_id,name:"type_of_tax_id",children:r.jsx(F,{value:e.type_of_tax_id,remoteConfig:{url:"/admin/type-of-tax/list",label:a=>a.name,value:a=>a.id.toString()},onValueChange:a=>{t({...e,type_of_tax_id:a})}})}),r.jsx(o,{label:"Gudang",error:i.warehouse_id,name:"warehouse_id",required:!0,children:r.jsx(R,{value:{id:`${e.warehouse_id}`,code:`${(_=e.warehouse)==null?void 0:_.code}`,name:`${(x=e.warehouse)==null?void 0:x.name}`},onChange:a=>{t({...e,warehouse_id:a.id,warehouse:{id:a.id,code:a.code,name:a.name}})}})}),r.jsx(o,{label:"Divisi",error:i.division_id,name:"division_id",children:r.jsx(B,{value:{id:e.division_id,code:(b=e.division)==null?void 0:b.code,name:(f=e.division)==null?void 0:f.name},onChange:a=>{t({...e,division_id:a.id,division:a})},clearable:!0})}),r.jsx(o,{label:"Tanggal",error:i.purchase_date,name:"purchase_date",children:r.jsx(m,{type:"date",value:e.purchase_date,onChange:a=>{t({...e,purchase_date:a.target.value})}})}),r.jsx(o,{label:"Nomor",error:i.no,name:"no",required:!0,children:r.jsx(m,{type:"text",value:e.no,onChange:a=>{t({...e,no:a.target.value})}})}),r.jsx(o,{label:"Nomor Invoice",error:i.invoice_number,name:"invoice_number",required:!0,children:r.jsx(J,{value:e.invoice_number??"",onChange:a=>{t({...e,invoice_number:a})},endpoint:"/admin/purchase/invoices",historyColumns:["invoice_number","number"]})}),r.jsx(o,{label:"No. PO",error:i.purchase_order_number,name:"purchase_order_number",children:r.jsx(m,{type:"text",value:e.purchase_order_number,onChange:a=>{t({...e,purchase_order_number:a.target.value})}})}),r.jsx(o,{label:"Metode Pembayaran",error:i.payment_method,name:"payment_method",required:!0,children:r.jsx($,{value:e.payment_method??"Credit",onChange:a=>{t({...e,payment_method:a})}})}),r.jsx(o,{label:"Faktur Pajak",error:i.tax_invoice_number,name:"tax_invoice_number",required:!0,children:r.jsx(m,{type:"text",value:e.tax_invoice_number,onChange:a=>{t({...e,tax_invoice_number:a.target.value})}})}),e.payment_method=="Credit"&&r.jsx(o,{label:"Jatuh Tempo",error:i.due_date,name:"due_date",children:r.jsx(m,{type:"date",value:e.due_date,onChange:a=>{t({...e,due_date:a.target.value})}})}),r.jsx("div",{className:"col-span-3",children:r.jsx(o,{label:"Catatan",error:i.note,name:"note",children:r.jsx(q,{value:e.note,onChange:a=>{t({...e,note:a.target.value})}})})}),r.jsxs("div",{className:"col-span-3",children:[r.jsx(M,{auditableType:"App\\Models\\PurchaseItem",keyField:"purchase_id",valueField:e.id||"",trigger:r.jsx(k,{className:"mt-5",children:"Riwayat Item"}),title:"Riwayat Perubahan Item Pembelian",description:"Lihat semua perubahan pada item-item pembelian ini"}),r.jsx(G,{items:e.items??[]})]}),r.jsx("div",{className:"col-span-3",children:r.jsx(W,{data:e,setData:t,type_ofTax:P})})]}),r.jsx(V,{formDialog:s,onOpenChange:a=>{u({...s,open:a})},data:d,setData:j,errors:y,onSave:S})]})}H.layout=p=>r.jsx(N,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Pembelian",href:"/admin/purchase"},{label:"Lihat",href:"#"}],children:p});export{H as default};
