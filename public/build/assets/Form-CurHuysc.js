import{W as H,r as y,j as t,a as _,y as W}from"./app-CQ-G37p-.js";import{h as K}from"./moment-C5S46NFB.js";import{t as S}from"./use-toast-XJEkqv7A.js";import{C as k}from"./currency-formatter-D5vTOkIG.js";import{A as ne}from"./AuthenticatedLayout-X6euxa7E.js";import{B as b}from"./button-ymMXdPy5.js";import{T as oe,a as ce,b as v,c as u,d as le,e as n,f as me}from"./table-BSdxGOLt.js";import{I as $}from"./input-BXXA-PDa.js";import{F as f}from"./form-group-CHZXn8bM.js";import{T as de}from"./textarea-BvykTLwI.js";import{E as he}from"./EmptyTable-CjEJGtgb.js";import{S as ue}from"./SearchDivision-Budjprvk.js";import{S as pe}from"./SearchWarehouse-Bw-VGbhg.js";import{S as xe}from"./SearchChartOfAccount-0Jd4yGJY.js";import fe from"./ItemForm-DBUeYx0B.js";import{P as je}from"./pencil-XLeJOTln.js";import{T as ge}from"./trash-C6VGYEst.js";import{P as Ie}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./search-B9EA-nRY.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./file-text-vhY6aTSF.js";import"./dialog-CBBIkam9.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchSubUnit-CTrUekdR.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./money-input-Bb590VQ4.js";function _e({itemIn:g,division:N,warehouse:P,isEdit:I=!1}){var E,U,D,B,q,Y,A,R,M;const J=I&&g?g:{date:K().format("YYYY-MM-DD"),division_id:N.id,division:N,warehouse_id:P.id,warehouse:P,items:[]},{data:a,setData:c,errors:p,setError:L,clearErrors:O}=H(J),{data:l,setData:o}=H({}),[Q,T]=y.useState({}),[j,x]=y.useState({show:!1,isEdit:!1,itemInItemIndex:0}),[be,F]=y.useState(null),w=(e,r)=>{if(!e||!r||!e.units||e.units.length===0)return(e==null?void 0:e.purchase_price)||"0";const i=e.units.find(h=>h.name===r);if(console.log(i),!i)return e.purchase_price||"0";const s=e.units.find(h=>h.is_purchase_price==!0);if(!s){const h=e.units.find(G=>G.conversion==="1"||G.conversion===1)||e.units[0];if(!h)return e.purchase_price||"0";const ae=parseFloat(e.purchase_price||"0"),se=parseFloat(i.conversion||"1"),ie=parseFloat(h.conversion||"1");return i.name===h.name?e.purchase_price||"0":(ae/ie*se).toString()}if(i.name===s.name)return e.purchase_price||"0";const m=parseFloat(e.purchase_price||"0"),d=parseFloat(s.conversion||"1"),C=parseFloat(i.conversion||"1");return(m/d*C).toString()},V=async()=>{try{return await _.post("/admin/item-in/validate",l),T({}),!0}catch(e){return T(e.response.data.errors),!1}},X=async()=>{if(await V())if(j.isEdit){const e=a.items;e[j.itemInItemIndex]=l,c({...a,items:e}),x({show:!1,isEdit:!1,itemInItemIndex:0})}else c("items",[...a.items,l]),o({item_id:"",item:void 0,quantity:"0",unit:"",price:"0",remarks:""}),x({show:!1,isEdit:!1,itemInItemIndex:0}),setTimeout(()=>{x({show:!0,isEdit:!1,itemInItemIndex:0})},300)},Z=async()=>{var e;try{O();const r={...a,date:K(a.date).format("YYYY-MM-DD"),total:((e=a.items)==null?void 0:e.reduce((i,s)=>i+(parseFloat(s.total||"0")||0),0))||0};I?(await _.put(`/admin/item-in/${a.id}`,r),W.visit("/admin/item-in"),S({title:"Berhasil",description:"Barang masuk berhasil diubah"})):(await _.post("/admin/item-in",r),W.visit("/admin/item-in/create"),S({title:"Berhasil",description:"Barang masuk berhasil disimpan"}))}catch(r){r.response.status==422?L(r.response.data.errors):S({title:"Gagal",description:r.response.data.message,variant:"destructive"})}},ee=()=>{o({item_id:"",item:{code:"",name:"",purchase_price:"0",units:[]},quantity:"0",price:"0",remarks:""}),x({show:!0,isEdit:!1,itemInItemIndex:0})},te=(e,r)=>{o(r),x({show:!0,isEdit:!0,itemInItemIndex:e})},re=e=>()=>{var r;c({...a,items:(r=a.items)==null?void 0:r.filter((i,s)=>e!=s)})};return t.jsxs("div",{className:"pt-5 px-5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-x-4 gap-y-4 mb-3",children:[t.jsx(f,{name:"division_id",label:"Divisi",required:!0,error:p.division_id,children:t.jsx(ue,{value:{id:a.division_id??"",code:((E=a.division)==null?void 0:E.code)??"",name:((U=a.division)==null?void 0:U.name)??""},onChange:e=>{c({...a,division_id:e.id,division:e})},clearable:!0})}),t.jsx(f,{name:"date",label:"Tanggal",required:!0,error:p.date,children:t.jsx($,{type:"date",value:a.date,onChange:e=>c("date",e.target.value)})}),t.jsx(f,{name:"text",label:"Nomor",required:!0,error:p.number,children:t.jsx($,{type:"text",value:I?a.number:"???",disabled:!0,onChange:e=>c("number",e.target.value)})}),t.jsx(f,{label:"Gudang",error:p.warehouse_id,name:"warehouse_id",required:!0,children:t.jsx(pe,{value:{id:a.warehouse_id??"",code:((D=a.warehouse)==null?void 0:D.code)??"",name:((B=a.warehouse)==null?void 0:B.name)??""},onChange:e=>{c({...a,warehouse_id:e.id,warehouse:e})}})}),t.jsx(f,{label:"CR #Acc",error:p.chart_of_account_id,name:"chart_of_account_id",children:t.jsx(xe,{value:{id:a.chart_of_account_id??"",code:((q=a.chart_of_account)==null?void 0:q.code)??"",name:((Y=a.chart_of_account)==null?void 0:Y.name)??""},onChange:e=>{c({...a,chart_of_account_id:e.id,chart_of_account:e})}})}),t.jsx("div",{className:"col-span-3",children:t.jsx(f,{label:"Keterangan",error:p.remarks,name:"remarks",children:t.jsx(de,{value:a.remarks,onChange:e=>c("remarks",e.target.value)})})}),t.jsxs("div",{className:"col-span-3",children:[t.jsxs(oe,{children:[t.jsx(ce,{children:t.jsxs(v,{children:[t.jsx(u,{className:"w-[10px]",children:"No."}),t.jsx(u,{className:"w-1/5",children:"Item"}),t.jsx(u,{className:"text-right",children:"Jumlah"}),t.jsx(u,{className:"text-right",children:"Harga Perolehan"}),t.jsx(u,{className:"text-right",children:"Total"}),t.jsx(u,{children:"Keterangan"}),t.jsx(u,{className:"w-[100px]",children:"Aksi"})]})}),t.jsx(le,{children:((A=a.items)==null?void 0:A.length)==0?t.jsx(v,{children:t.jsx(n,{colSpan:8,className:"text-center",children:t.jsx(he,{})})}):(R=a.items)==null?void 0:R.map((e,r)=>{var i,s;return t.jsxs(v,{children:[t.jsxs(n,{children:[r+1,"."]}),t.jsxs(n,{children:[(i=e.item)==null?void 0:i.code," - ",(s=e.item)==null?void 0:s.name]}),t.jsxs(n,{className:"text-right",children:[e.quantity," ",e.unit]}),t.jsx(n,{className:"text-right",children:t.jsx(k,{amount:parseFloat(e.price)??0})}),t.jsx(n,{className:"text-right",children:t.jsx(k,{amount:parseFloat(e.total)??0})}),t.jsx(n,{children:e.remarks}),t.jsxs(n,{children:[t.jsx(b,{size:"sm",variant:"outline",onClick:()=>te(r,e),children:t.jsx(je,{size:24})}),t.jsx(b,{size:"sm",variant:"destructive",onClick:re(r),children:t.jsx(ge,{size:24})})]})]},r)})}),t.jsx(me,{children:t.jsxs(v,{children:[t.jsx(n,{colSpan:4,className:"text-right font-bold",children:"Total"}),t.jsx(n,{className:"text-right font-bold",children:t.jsx(k,{amount:((M=a.items)==null?void 0:M.reduce((e,r)=>e+(parseFloat(r.total||"0")||0),0))||0})}),t.jsx(n,{colSpan:2})]})})]}),t.jsx(b,{className:"w-full",onClick:ee,children:t.jsx(Ie,{})})]})]}),t.jsx(b,{type:"button",onClick:Z,children:I?"Ubah":"Simpan"}),t.jsx(fe,{show:j.show,isEdit:j.isEdit,item:l,errors:Q,warehouseId:a.warehouse_id??"",onClose:()=>x({...j,show:!1}),onSave:X,onItemChange:async e=>{var r;try{const i=await _.get(`/admin/item/${e.id}/units`),s={...e,units:i.data.data.units},m=s.units.find(z=>z.is_purchase_price===!0),d=m?m.name:((r=s.units[0])==null?void 0:r.name)||"",C=w(s,d);o({...l,item_id:e.id,item:s,unit:d,price:C}),F(m||s.units[0])}catch(i){console.error("Error fetching item units:",i);const s=w(e,e.unit||"");o({...l,item_id:e.id,item:e,unit:e.unit||"",price:s})}},onQuantityChange:e=>{o(r=>({...r,quantity:e}))},onUnitChange:e=>{var s,m;const r=(m=(s=l.item)==null?void 0:s.units)==null?void 0:m.find(d=>d.name===e);F(r);const i=w(l.item,e);console.log("Calculated price for unit",e,":",i),o(d=>({...d,unit:e,price:i}))},onPriceChange:e=>{o(r=>({...r,price:e}))},onRemarksChange:e=>{o(r=>({...r,remarks:e}))},onTotalChange:e=>{o(r=>({...r,total:e}))}})]})}_e.layout=g=>t.jsx(ne,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Barang Masuk",href:"/admin/item-in"},{label:"Form",href:"#"}],children:g});export{_e as default};
