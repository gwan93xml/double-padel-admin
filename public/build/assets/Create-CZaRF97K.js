import{W as U,r as n,j as e,a as W,y as _}from"./app-CQ-G37p-.js";import{S as me}from"./SearchChartOfAccount-0Jd4yGJY.js";import{S as he}from"./SearchDivision-Budjprvk.js";import{B as f}from"./button-ymMXdPy5.js";import{C as fe}from"./checkbox-DaA1krf_.js";import{C as x}from"./currency-formatter-D5vTOkIG.js";import{D as pe,a as xe,c as je,d as be}from"./dialog-CBBIkam9.js";import{F as l}from"./form-group-CHZXn8bM.js";import{I as N}from"./input-BXXA-PDa.js";import{L as ge}from"./label-Blk7FhF1.js";import{M as H}from"./money-input-Bb590VQ4.js";import{T as ve,a as De,b as w,c as u,d as _e,e as o,f as Ce}from"./table-BSdxGOLt.js";import{T as J}from"./textarea-BvykTLwI.js";import{A as ye}from"./AuthenticatedLayout-X6euxa7E.js";import{t as Q}from"./use-toast-XJEkqv7A.js";import{P as Ee}from"./pencil-XLeJOTln.js";import{T as Te}from"./trash-C6VGYEst.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./file-text-vhY6aTSF.js";import"./index-D0iIn24t.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./tslib.es6-eMSY344_.js";import"./index-CZ_DqijM.js";import"./index-B9VoEdXn.js";import"./index-uJ2KZHf0.js";import"./index-BHS3gC_j.js";import"./index-C7S3ohsj.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./moment-C5S46NFB.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function Ne({division:j,payDebtHeader:C,purchase:y,purchaseDeposit:E,paid_to:X,total_debit:Y,description:Z,date:ee}){var M,z,V,$,G;const{data:i,setData:d,clearErrors:te,errors:m,setError:ae}=U({date:ee,paid_to:X,details:[],division_id:j.id,division:j,description:Z}),re=n.useRef(null),R=n.useRef(null),k=n.useRef(null),S=n.useRef(null),K=n.useRef(null),I=n.useRef(null),[O,F]=n.useState(!1),[b,A]=n.useState(!1);n.useEffect(()=>{async function t(){const a=localStorage.getItem("cash-out.print-dialog");A(a==="1")}t()},[]),n.useEffect(()=>{localStorage.setItem("cash-out.print-dialog",b?"1":"0")},[b]);async function ie(t){F(!0),te();try{const{data:a}=await W.post("/admin/cash-out",{...i,pay_debt_header_id:C?C.id:null,purchase_id:y?y.id:null,purchase_deposit_id:E?E.id:null});Q({variant:"default",title:"Berhasil",description:"Kas keluar berhasil disimpan"}),b&&window.open(`/admin/cash-out/${a.data.id}/print`,"_blank"),y?_.visit("/admin/purchase/create"):E?_.visit("/admin/purchase-deposit/create"):C?_.visit("/admin/pay-debt/create"):_.visit(`/admin/cash-out/create?date=${i.date}`)}catch(a){if(a.response.status===422){const r=a.response.data.errors;ae(r)}else Q({title:"Error",description:a.response.data.message,variant:"destructive"})}finally{F(!1)}}const[c,p]=n.useState({show:!1,isEdit:!1,detailIndex:-1}),{data:s,setData:h,errors:g,setError:se,clearErrors:ne}=U({});function T(){p({show:!0,isEdit:!1,detailIndex:-1}),h({chart_of_account:{id:"",name:"",code:""},chart_of_account_id:"",debit:"0",credit:"0",description:""})}const oe=async()=>{try{return await W.post("/admin/cash-out/validate",s),ne(),!0}catch(t){return se(t.response.data.errors),!1}},v=n.useRef(!1);async function q(){if(!await oe())return v.current=!1,"error";const t=c.isEdit;return c.isEdit?d(a=>{const r=[...a.details];return r[c.detailIndex]=s,{...a,details:r}}):d(a=>({...a,details:[...a.details,s]})),p({...c,show:!1,isEdit:!1,detailIndex:-1}),v.current=!1,t?"updated":"created"}async function le(t){p({show:!0,isEdit:!0,detailIndex:t}),h(i.details[t])}function de(t){d(a=>{const r=[...a.details];return r.splice(t,1),{...a,details:r}})}function ce(){return e.jsx("span",{className:"font-bold",children:e.jsx(x,{amount:P()})})}function ue(){return e.jsx("span",{className:"font-bold",children:e.jsx(x,{amount:B()})})}function P(){var a;let t=((a=i.details)==null?void 0:a.reduce((r,D)=>r+parseFloat(D.debit),0))??0;return t=t+Y,t}function B(){var t;return((t=i.details)==null?void 0:t.reduce((a,r)=>a+parseFloat(r.credit),0))??0}function L(){const t=P(),a=B();return t-a}return e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[e.jsx(l,{label:"Divisi",name:"division_id",required:!0,error:m.division_id,children:e.jsx(he,{value:{id:i.division_id,name:(M=i.division)==null?void 0:M.name,code:(z=i.division)==null?void 0:z.code},onChange:t=>{d({...i,division_id:t.id,division:t})}})}),e.jsx(l,{label:"Nomor",name:"number",required:!0,error:m.number,children:e.jsx(N,{disabled:!0,value:"KK???",onChange:t=>{d({...i,number:t.target.value})}})}),e.jsx(l,{label:"Tanggal",name:"date",required:!0,error:m.date,children:e.jsx(N,{type:"date",value:i.date,onChange:t=>{d({...i,date:t.target.value})}})}),e.jsx(l,{label:"Dibayar Kepada",name:"paid_to",required:!0,error:m.paid_to,children:e.jsx(N,{type:"text",value:i.paid_to,ref:re,onChange:t=>{d({...i,paid_to:t.target.value})},onKeyDown:t=>{var a;t.key==="Enter"&&(t.preventDefault(),(a=R.current)==null||a.focus())}})}),e.jsx("div",{className:"col-span-3",children:e.jsx(l,{label:"Catatan",name:"description",required:!0,error:m.description,children:e.jsx(J,{ref:R,value:i.description,onChange:t=>{d({...i,description:t.target.value})},onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),T())}})})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(l,{error:m.details,children:e.jsxs(ve,{children:[e.jsx(De,{children:e.jsxs(w,{children:[e.jsx(u,{className:"w-[10px]",children:"NO."}),e.jsx(u,{children:"KODE"}),e.jsx(u,{children:"PERKIRAAN"}),e.jsx(u,{className:"text-end",children:"DEBET"}),e.jsx(u,{className:"text-end",children:"KREDIT"}),e.jsx(u,{children:"CATATAN"}),e.jsx(u,{className:"w-[50px]",children:"AKSI"})]})}),e.jsx(_e,{children:(V=i.details)==null?void 0:V.map((t,a)=>{var r,D;return e.jsxs(w,{children:[e.jsx(o,{className:"text-center",children:a+1}),e.jsx(o,{children:(r=t.chart_of_account)==null?void 0:r.code}),e.jsx(o,{children:(D=t.chart_of_account)==null?void 0:D.name}),e.jsx(o,{children:e.jsx(x,{amount:parseFloat(t.debit)??0})}),e.jsx(o,{children:e.jsx(x,{amount:parseFloat(t.credit)??0})}),e.jsx(o,{children:t.description}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(f,{variant:"link",size:"sm",onClick:()=>le(a),children:e.jsx(Ee,{})}),e.jsx(f,{variant:"destructive",size:"sm",onClick:()=>de(a),children:e.jsx(Te,{})})]})})]},a)})}),e.jsx(Ce,{children:e.jsxs(w,{children:[e.jsx(o,{colSpan:3,className:"text-right font-bold",children:"Total"}),e.jsx(o,{className:"text-end font-bold",children:ce()}),e.jsx(o,{className:"text-end font-bold",children:ue()}),e.jsx(o,{colSpan:2,className:"text-end font-bold",children:L()!==0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Selisih:"}),e.jsx(x,{amount:L()})]}):null})]})})]})}),e.jsx(f,{className:"w-full",onClick:T,children:"Tambah Detail"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs(ge,{className:"",children:[e.jsx(fe,{className:"mr-2",checked:b,onCheckedChange:t=>{A(t)}}),e.jsx("span",{children:"Print"})]})}),e.jsx("div",{className:"col-span-3",children:e.jsx(f,{onClick:ie,disabled:O,children:O?"Menyimpan...":"Simpan"})})]}),e.jsx(pe,{open:c.show,onOpenChange:t=>{p({...c,show:t})},children:e.jsxs(xe,{className:" max-h-[80vh] overflow-y-auto",children:[e.jsx(je,{children:"Detail"}),e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Perkiraan",error:g.chart_of_account_id,required:!0,children:e.jsx(me,{value:{id:s.chart_of_account_id,name:($=s.chart_of_account)==null?void 0:$.name,code:(G=s.chart_of_account)==null?void 0:G.code},onChange:t=>{h({...s,chart_of_account:t,chart_of_account_id:t.id})},nextRef:S,accountCodeRef:k})}),e.jsx(l,{label:"Debet",name:"debit",required:!0,error:g.debit,children:e.jsx(H,{ref:S,value:s.debit,onValueChange:t=>{h({...s,debit:t})},onKeyDown:t=>{var a;t.key==="Enter"&&(t.preventDefault(),(a=K.current)==null||a.focus())}})}),e.jsx(l,{label:"Kredit",name:"credit",required:!0,error:g.credit,children:e.jsx(H,{ref:K,value:s.credit,onValueChange:t=>{h({...s,credit:t})},onKeyDown:t=>{var a;t.key==="Enter"&&(t.preventDefault(),(a=I.current)==null||a.focus())}})}),e.jsx(l,{label:"Keterangan",name:"description",required:!0,error:g.description,children:e.jsx(J,{ref:I,value:s.description,onChange:t=>{h({...s,description:t.target.value})},onKeyDown:async t=>{var a;if(t.key==="Enter"){if(t.preventDefault(),v.current)return;v.current=!0;const r=await q();if(r==="error"||r==="updated")return;r==="created"&&(T(),(a=k.current)==null||a.focus())}}})})]}),e.jsxs(be,{children:[e.jsx(f,{variant:"outline",onClick:()=>{p({...c,show:!1})},children:"Tutup"}),e.jsx(f,{onClick:q,children:c.isEdit?"Simpan":"Tambah"})]})]})})]})}Ne.layout=j=>e.jsx(ye,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Akuntansi",href:"#"},{label:"Kas Keluar",href:"/admin/cash-out"},{label:"Tambah",href:"#"}],children:j});export{Ne as default};
