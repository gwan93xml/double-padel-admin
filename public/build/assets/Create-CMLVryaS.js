import{W,r as n,j as e,a as H,y as C}from"./app-CQ-G37p-.js";import{S as fe}from"./SearchChartOfAccount-0Jd4yGJY.js";import{S as he}from"./SearchDivision-Budjprvk.js";import{B as h}from"./button-ymMXdPy5.js";import{C as pe}from"./checkbox-DaA1krf_.js";import{C as x}from"./currency-formatter-D5vTOkIG.js";import{D as xe,a as je,c as be,d as ve}from"./dialog-CBBIkam9.js";import{F as l}from"./form-group-CHZXn8bM.js";import{I}from"./input-BXXA-PDa.js";import{L as ge}from"./label-Blk7FhF1.js";import{M as J}from"./money-input-Bb590VQ4.js";import{T as De,a as Ce,b as k,c as u,d as _e,e as o,f as ye}from"./table-BSdxGOLt.js";import{T as Q}from"./textarea-BvykTLwI.js";import{A as Ee}from"./AuthenticatedLayout-X6euxa7E.js";import{t as X}from"./use-toast-XJEkqv7A.js";import{P as Te}from"./pencil-XLeJOTln.js";import{T as Ne}from"./trash-C6VGYEst.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./file-text-vhY6aTSF.js";import"./index-D0iIn24t.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./tslib.es6-eMSY344_.js";import"./index-CZ_DqijM.js";import"./index-B9VoEdXn.js";import"./index-uJ2KZHf0.js";import"./index-BHS3gC_j.js";import"./index-C7S3ohsj.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./moment-C5S46NFB.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function we({division:j,accountReceivableHeader:_,sale:y,date:Y,total_credit:Z,description:ee,received_from:re,salesDeposit:E}){var z,V,$,G,U;const{data:i,setData:c,clearErrors:ae,errors:m,setError:te}=W({date:Y,received_from:re,details:[],division_id:j.id,division:j,description:ee}),ie=n.useRef(null),R=n.useRef(null),T=n.useRef(null),S=n.useRef(null),K=n.useRef(null),F=n.useRef(null),[A,q]=n.useState(!1),b=n.useRef(!1),[v,P]=n.useState(!1);n.useEffect(()=>{async function r(){const a=localStorage.getItem("cash-in.print-dialog");P(a==="1")}r()},[]),n.useEffect(()=>{localStorage.setItem("cash-in.print-dialog",v?"1":"0")},[v]);async function se(r){q(!0),ae();try{const{data:a}=await H.post("/admin/cash-in",{...i,account_receivable_header_id:_?_.id:null,sale_id:y?y.id:null,sales_deposit_id:E?E.id:null});X({variant:"default",title:"Berhasil",description:"Kas masuk berhasil disimpan"}),v&&window.open(`/admin/cash-in/${a.data.id}/print`,"_blank"),y?C.visit("/admin/sale/create"):E?C.visit("/admin/sales-deposit/create"):_?C.visit("/admin/account-receivable/create"):C.visit(`/admin/cash-in/create?date=${i.date}`)}catch(a){if(a.response.status===422){const t=a.response.data.errors;te(t)}else X({title:"Error",description:a.response.data.message,variant:"destructive"})}finally{q(!1)}}const[d,p]=n.useState({show:!1,isEdit:!1,detailIndex:-1}),{data:s,setData:f,errors:g,setError:ne,clearErrors:oe}=W({});function N(){p({show:!0,isEdit:!1,detailIndex:-1}),f({chart_of_account:{id:"",name:"",code:""},chart_of_account_id:"",debit:"0",credit:"0",description:""})}const w=n.useRef(!1),le=async()=>{if(w.current)return!1;try{return await H.post("/admin/cash-in/validate",s),oe(),w.current=!1,!0}catch(r){return ne(r.response.data.errors),w.current=!1,!1}};async function B(){if(!await le())return b.current=!1,"error";const r=d.isEdit;return d.isEdit?c(a=>{const t=[...a.details];return t[d.detailIndex]=s,{...a,details:t}}):c(a=>({...a,details:[...a.details,s]})),p({...d,show:!1,isEdit:!1,detailIndex:-1}),b.current=!1,r?"updated":"created"}async function ce(r){p({show:!0,isEdit:!0,detailIndex:r}),f(i.details[r])}function de(r){c(a=>{const t=[...a.details];return t.splice(r,1),{...a,details:t}})}function ue(){return e.jsx("span",{className:"font-bold",children:e.jsx(x,{amount:L()})})}function me(){return e.jsx("span",{className:"font-bold",children:e.jsx(x,{amount:M()})})}function M(){var a;let r=((a=i.details)==null?void 0:a.reduce((t,D)=>t+parseFloat(D.credit),0))??0;return r=r+Z,r}function L(){var r;return((r=i.details)==null?void 0:r.reduce((a,t)=>a+parseFloat(t.debit),0))??0}function O(){const r=L(),a=M();return r-a}return e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[e.jsx(l,{label:"Divisi",name:"division_id",required:!0,error:m.division_id,children:e.jsx(he,{value:{id:i.division_id,name:(z=i.division)==null?void 0:z.name,code:(V=i.division)==null?void 0:V.code},onChange:r=>{c({...i,division_id:r.id,division:r})}})}),e.jsx(l,{label:"Nomor",name:"number",required:!0,error:m.number,children:e.jsx(I,{disabled:!0,value:"KM???",onChange:r=>{c({...i,number:r.target.value})}})}),e.jsx(l,{label:"Tanggal",name:"date",required:!0,error:m.date,children:e.jsx(I,{type:"date",value:i.date,onChange:r=>{c({...i,date:r.target.value})}})}),e.jsx(l,{label:"Terima Dari",name:"recipient",required:!0,error:m.received_from,children:e.jsx(I,{type:"text",value:i.received_from,ref:ie,onChange:r=>{c({...i,received_from:r.target.value})},onKeyDown:r=>{var a;r.key==="Enter"&&(r.preventDefault(),(a=R.current)==null||a.focus())}})}),e.jsx("div",{className:"col-span-3",children:e.jsx(l,{label:"Catatan",name:"description",required:!0,error:m.description,children:e.jsx(Q,{value:i.description,ref:R,onChange:r=>{c({...i,description:r.target.value})},onKeyDown:r=>{var a;r.key==="Enter"&&(r.preventDefault(),N(),(a=T.current)==null||a.focus())}})})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(l,{error:m.details,children:e.jsxs(De,{children:[e.jsx(Ce,{children:e.jsxs(k,{children:[e.jsx(u,{className:"w-[10px]",children:"NO."}),e.jsx(u,{children:"KODE"}),e.jsx(u,{children:"PERKIRAAN"}),e.jsx(u,{className:"text-end",children:"DEBET"}),e.jsx(u,{className:"text-end",children:"KREDIT"}),e.jsx(u,{children:"CATATAN"}),e.jsx(u,{className:"w-[50px]",children:"AKSI"})]})}),e.jsx(_e,{children:($=i.details)==null?void 0:$.map((r,a)=>{var t,D;return e.jsxs(k,{children:[e.jsx(o,{className:"text-center",children:a+1}),e.jsx(o,{children:(t=r.chart_of_account)==null?void 0:t.code}),e.jsx(o,{children:(D=r.chart_of_account)==null?void 0:D.name}),e.jsx(o,{children:e.jsx(x,{amount:parseFloat(r.debit)??0})}),e.jsx(o,{children:e.jsx(x,{amount:parseFloat(r.credit)??0})}),e.jsx(o,{children:r.description}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(h,{variant:"link",size:"sm",onClick:()=>ce(a),children:e.jsx(Te,{})}),e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>de(a),children:e.jsx(Ne,{})})]})})]},a)})}),e.jsx(ye,{children:e.jsxs(k,{children:[e.jsx(o,{colSpan:3,className:"text-right font-bold",children:"Total"}),e.jsx(o,{className:"text-end font-bold",children:ue()}),e.jsx(o,{className:"text-end font-bold",children:me()}),e.jsx(o,{colSpan:2,className:"text-end font-bold",children:O()!==0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Selisih:"}),e.jsx(x,{amount:O()})]}):null})]})})]})}),e.jsx(h,{className:"w-full",onClick:N,children:"Tambah Detail"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs(ge,{className:"",children:[e.jsx(pe,{className:"mr-2",checked:v,onCheckedChange:r=>{P(r)}}),e.jsx("span",{children:"Print"})]})}),e.jsx("div",{className:"col-span-3",children:e.jsx(h,{onClick:se,disabled:A,children:A?"Menyimpan...":"Simpan"})})]}),e.jsx(xe,{open:d.show,onOpenChange:r=>{p({...d,show:r})},children:e.jsxs(je,{className:" max-h-[80vh] overflow-y-auto",children:[e.jsx(be,{children:"Detail"}),e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Perkiraan",error:g.chart_of_account_id,required:!0,children:e.jsx(fe,{value:{id:s.chart_of_account_id,name:(G=s.chart_of_account)==null?void 0:G.name,code:(U=s.chart_of_account)==null?void 0:U.code},onChange:r=>{f({...s,chart_of_account:r,chart_of_account_id:r.id})},nextRef:S,accountCodeRef:T})}),e.jsx(l,{label:"Debet",name:"debit",required:!0,error:g.debit,children:e.jsx(J,{value:s.debit,ref:S,onValueChange:r=>{f({...s,debit:r})},onKeyDown:r=>{var a;r.key==="Enter"&&(r.preventDefault(),(a=K.current)==null||a.focus())}})}),e.jsx(l,{label:"Kredit",name:"credit",required:!0,error:g.credit,children:e.jsx(J,{ref:K,value:s.credit,onValueChange:r=>{f({...s,credit:r})},onKeyDown:r=>{var a;r.key==="Enter"&&(r.preventDefault(),(a=F.current)==null||a.focus())}})}),e.jsx(l,{label:"Keterangan",name:"description",required:!0,error:g.description,children:e.jsx(Q,{ref:F,value:s.description,onChange:r=>{f({...s,description:r.target.value})},onKeyDown:async r=>{var a;if(r.key==="Enter"){if(r.preventDefault(),b.current)return;b.current=!0;const t=await B();if(t==="error"||t==="updated")return;t==="created"&&(N(),(a=T.current)==null||a.focus())}}})})]}),e.jsxs(ve,{children:[e.jsx(h,{variant:"outline",onClick:()=>{p({...d,show:!1})},children:"Tutup"}),e.jsx(h,{onClick:B,children:d.isEdit?"Simpan":"Tambah"})]})]})})]})}we.layout=j=>e.jsx(Ee,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Akuntansi",href:"#"},{label:"Kas Masuk",href:"/admin/cash-in"},{label:"Tambah",href:"#"}],children:j});export{we as default};
