import{W as D,r as B,j as t,a as g,y as Y}from"./app-CQ-G37p-.js";import{B as j}from"./button-ymMXdPy5.js";import{I as q}from"./input-BXXA-PDa.js";import{T as $}from"./textarea-BvykTLwI.js";import{T as K,a as L,b as I,c as d,d as V,e as o}from"./table-BSdxGOLt.js";import{F as c}from"./form-group-CHZXn8bM.js";import{S as X}from"./SearchDivision-Budjprvk.js";import{S as Z}from"./SearchWarehouse-Bw-VGbhg.js";import{S as ee}from"./SearchChartOfAccount-0Jd4yGJY.js";import{t as b}from"./use-toast-XJEkqv7A.js";import{h as F}from"./moment-C5S46NFB.js";import te from"./ItemForm-CtGGH5Gb.js";import{P as ae}from"./pencil-XLeJOTln.js";import{T as ie}from"./trash-C6VGYEst.js";import{P as re}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./label-Blk7FhF1.js";import"./index-DqZ46QiR.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./badge-CsIJHFj0.js";import"./file-text-vhY6aTSF.js";import"./dialog-CBBIkam9.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchSubUnit-CTrUekdR.js";import"./select-BSIJzAmS.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";function He({mode:A,initialData:w,division:h,warehouse:u}){var k,C,v,E,S,T,N,O;const p=A==="edit",M=p&&w?w:{date:F().format("YYYY-MM-DD"),division_id:(h==null?void 0:h.id)||"",division:h||null,warehouse_id:(u==null?void 0:u.id)||"",warehouse:u||null,chart_of_account_id:"",chart_of_account:null,remarks:"",items:[]},{data:a,setData:r,errors:n,setError:P,clearErrors:R}=D(M),{data:x,setData:s}=D({}),[G,y]=B.useState({}),[l,m]=B.useState({show:!1,isEdit:!1,itemOutItemIndex:0}),z=async()=>{try{return await g.post("/admin/item-out/validate",x),y({}),!0}catch(e){return y(e.response.data.errors),!1}},H=async()=>{if(await z())if(l.isEdit){const e=a.items;e[l.itemOutItemIndex]=x,r({...a,items:e}),m({show:!1,isEdit:!1,itemOutItemIndex:0})}else r("items",[...a.items,x]),s({item_id:"",item:void 0,quantity:"0",unit:"",remarks:""}),m({show:!1,isEdit:!1,itemOutItemIndex:0}),setTimeout(()=>{m({show:!0,isEdit:!1,itemOutItemIndex:0})},300)},U=async()=>{try{R();const e={...a,date:F(a.date).format("YYYY-MM-DD")};p?(await g.put(`/admin/item-out/${a.id}`,e),Y.visit("/admin/item-out"),b({title:"Berhasil",description:"Barang keluar berhasil diubah"})):(await g.post("/admin/item-out",e),Y.visit("/admin/item-out/create"),b({title:"Berhasil",description:"Barang keluar berhasil disimpan"}))}catch(e){e.response.status==422?P(e.response.data.errors):b({title:"Gagal",description:e.response.data.message,variant:"destructive"})}},W=()=>{s({item_id:"",item:void 0,quantity:"0",unit:"",remarks:""}),m({show:!0,isEdit:!1,itemOutItemIndex:0})},J=(e,i)=>{s(i),m({show:!0,isEdit:!0,itemOutItemIndex:e})},Q=e=>()=>{var i;r({...a,items:(i=a.items)==null?void 0:i.filter((_,f)=>e!=f)})};return t.jsxs("div",{className:"pt-5 px-5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-x-4 gap-y-4 mb-3",children:[t.jsx(c,{name:"division_id",label:"Divisi",required:!0,error:n.division_id,children:t.jsx(X,{value:{id:a.division_id??"",code:((k=a.division)==null?void 0:k.code)??"",name:((C=a.division)==null?void 0:C.name)??""},onChange:e=>{r({...a,division_id:e.id,division:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(c,{name:"number",label:"Nomor",required:!0,error:n.number,children:t.jsx(q,{disabled:!0,type:"text",value:p?a.number??"":"???",onChange:e=>r("number",e.target.value)})}),t.jsx(c,{name:"date",label:"Tanggal",required:!0,error:n.date,children:t.jsx(q,{type:"date",value:a.date,onChange:e=>r("date",e.target.value)})}),t.jsx(c,{label:"Gudang",error:n.warehouse_id,name:"warehouse_id",children:t.jsx(Z,{value:{id:a.warehouse_id??"",code:((v=a.warehouse)==null?void 0:v.code)??"",name:((E=a.warehouse)==null?void 0:E.name)??""},onChange:e=>{r({...a,warehouse_id:e.id,warehouse:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(c,{label:"Akun Biaya",error:n.chart_of_account_id,name:"chart_of_account_id",children:t.jsx(ee,{value:{id:a.chart_of_account_id??"",code:((S=a.chart_of_account)==null?void 0:S.code)??"",name:((T=a.chart_of_account)==null?void 0:T.name)??""},onChange:e=>{r({...a,chart_of_account_id:e.id,chart_of_account:{id:e.id,code:e.code,name:e.name}})}})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(c,{label:"Catatan",error:n.remarks,name:"remarks",children:t.jsx($,{value:a.remarks,onChange:e=>{r({...a,remarks:e.target.value})}})}),t.jsxs(K,{children:[t.jsx(L,{children:t.jsxs(I,{children:[t.jsx(d,{className:"w-[10px]",children:"#"}),t.jsx(d,{children:"Item"}),t.jsx(d,{children:"Jumlah"}),t.jsx(d,{children:"Satuan"}),t.jsx(d,{children:"Catatan"}),t.jsx(d,{className:"w-[100px]",children:"Aksi"})]})}),t.jsx(V,{children:((N=a.items)==null?void 0:N.length)==0?t.jsx(I,{children:t.jsx(o,{colSpan:6,className:"text-center py-4 text-gray-500",children:"Belum ada item yang ditambahkan"})}):(O=a.items)==null?void 0:O.map((e,i)=>{var _,f;return t.jsxs(I,{children:[t.jsx(o,{children:i+1}),t.jsxs(o,{children:[(_=e.item)==null?void 0:_.name," (",(f=e.item)==null?void 0:f.code,")"]}),t.jsx(o,{className:"text-right",children:e.quantity}),t.jsx(o,{children:e.unit}),t.jsx(o,{children:e.remarks}),t.jsx(o,{children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(j,{size:"sm",variant:"outline",onClick:()=>J(i,e),children:t.jsx(ae,{className:"w-4 h-4"})}),t.jsx(j,{size:"sm",variant:"outline",onClick:Q(i),children:t.jsx(ie,{className:"w-4 h-4"})})]})})]},i)})})]}),t.jsxs(j,{className:"w-full mt-4",onClick:W,children:[t.jsx(re,{className:"w-4 h-4 mr-2"}),"Tambah Item"]})]})]}),t.jsx(j,{type:"button",onClick:U,children:p?"Ubah":"Simpan"}),t.jsx(te,{show:l.show,isEdit:l.isEdit,item:x,errors:G,warehouseId:a.warehouse_id??"",onClose:()=>m({...l,show:!1}),onSave:H,onItemChange:e=>{s(i=>({...i,item_id:e.id,item:{id:e.id,code:e.code,name:e.name,unit:e.unit,purchase_price:e.purchase_price,selling_price:e.selling_price}}))},onQuantityChange:e=>{s(i=>({...i,quantity:e}))},onUnitChange:e=>{s(i=>({...i,unit:e}))},onRemarksChange:e=>{s(i=>({...i,remarks:e}))}})]})}export{He as default};
