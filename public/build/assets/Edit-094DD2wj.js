import{W as I,r as s,j as t,a as h,y as _}from"./app-CQ-G37p-.js";import{h as R}from"./moment-C5S46NFB.js";import{t as x}from"./use-toast-XJEkqv7A.js";import{A as Y}from"./AuthenticatedLayout-X6euxa7E.js";import{P as G}from"./PinButton-Dxqdf0Ds.js";import{B as k}from"./button-ymMXdPy5.js";import{A as U,a as V}from"./alert-QQ3yNdZx.js";import{I as d}from"./input-BXXA-PDa.js";import{F as n}from"./form-group-CHZXn8bM.js";import{S as W}from"./select-remote-C3ahzpc3.js";import{T as J}from"./textarea-BvykTLwI.js";import{S as O}from"./SearchVendor-DVTa9TJs.js";import{S as H}from"./SearchWarehouse-Bw-VGbhg.js";import{S as z}from"./SearchDivision-Budjprvk.js";import{C as K}from"./CashCredit-BZxMHD02.js";import Q from"./PurchaseItemForm-CoK8QZd3.js";import X from"./PurchaseTotal-CaWbvIxL.js";import Z from"./PurchaseItemList-DIyn9dWX.js";import{I as ee}from"./InputWithHistory-DuCNlgmq.js";import{P as ae}from"./ProcessingButton-Da7kiAJ4.js";import{D as te}from"./detail-audit-dialog-D71KXIhT.js";import{T as re}from"./triangle-alert-byTh5Szo.js";import{P as ie}from"./plus-gEoqNGty.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./calendar-BV_-Gsoc.js";import"./label-Blk7FhF1.js";import"./select-BSIJzAmS.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./index-CwCPKFMf.js";import"./card-Bq41eL_q.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./SearchChartOfAccount-0Jd4yGJY.js";import"./file-text-vhY6aTSF.js";import"./SearchItem-DGpcvLrN.js";import"./package-Cd0mGsRo.js";import"./SearchItemNonStock-BQ2Ydllm.js";import"./SearchSubUnit-CTrUekdR.js";import"./dialog-CBBIkam9.js";import"./money-input-Bb590VQ4.js";import"./auto-manual-toggle-Drq7Gsew.js";import"./settings-BIxmfjj-.js";import"./lodash-Caeo88pO.js";import"./pencil-XLeJOTln.js";import"./EmptyTable-CjEJGtgb.js";import"./table-BSdxGOLt.js";import"./trash-C6VGYEst.js";import"./scroll-area-Db0TZtic.js";import"./circle-alert-DNqBTniX.js";function ne({purchase:u}){var g,v,y,j,P,C;const{data:a,setData:r,errors:i,setError:D,clearErrors:S}=I(u),{data:l,setData:c}=I({}),[A,f]=s.useState(!1),[E,b]=s.useState({}),[N,T]=s.useState();s.useEffect(()=>{async function e(){const o=await h.get(`/admin/type-of-tax/${a.type_of_tax_id}`);T(o.data.data)}e()},[a.type_of_tax_id]),s.useEffect(()=>{a.payment_status==="paid"&&x({variant:"default",title:"Informasi Pembelian",description:"Pembelian ini sudah lunas/dibayar. Perubahan data mungkin memerlukan penyesuaian pembayaran.",duration:8e3})},[]);const[m,p]=s.useState({open:!1,isEdit:!1,index:0}),w=async()=>{try{return await h.post("/admin/purchase/validate",l),b({}),!0}catch(e){return b(e.response.data.errors),!1}},B=async()=>{if(await w()){if(m.isEdit){const e=a.items;e[m.index]=l,r({...a,items:e})}else r("items",[...a.items,l]);p({...m,open:!1})}},F=async()=>{if(!(a.payment_status==="paid"&&!window.confirm("Pembelian ini sudah dalam status LUNAS/DIBAYAR. Mengubah data pembelian yang sudah dibayar dapat mempengaruhi catatan keuangan dan mungkin memerlukan penyesuaian pembayaran. Apakah Anda yakin ingin melanjutkan?"))){f(!0);try{S();const e=await h.put(`/admin/purchase/${a.id}`,{...a,purchase_date:R(a.purchase_date).format("YYYY-MM-DD")});a.payment_method=="Cash"?a.cash_out?_.visit(`/admin/cash-out/${a.cash_out.id}/edit`):_.visit(`/admin/cash-out/create?purchase_id=${e.data.data.id}`):_.visit("/admin/purchase"),x({title:"Berhasil",description:"Pembelian berhasil diubah"})}catch(e){e.response.status==422?D(e.response.data.errors):x({variant:"destructive",title:"Gagal",description:e.response.data.message})}finally{f(!1)}}},$=()=>{c({item_id:"",item:{code:"",name:""},chart_of_account_id:"",chart_of_account:{code:"",name:""},is_stock:!0,price:"0",quantity:"0",discount_percent:0,subtotal:"0",notes:""}),p({open:!0,isEdit:!1,index:0})},q=(e,o)=>{c(o),p({open:!0,isEdit:!0,index:e})},L=e=>{var o;r({...a,items:(o=a.items)==null?void 0:o.filter((oe,M)=>e!=M)})};return t.jsxs("div",{className:"pt-5  px-5",children:[t.jsx(G,{isPinned:a.is_pinned||!1,onToggle:()=>{r({...a,is_pinned:!a.is_pinned})}}),a.payment_status==="paid"&&t.jsxs(U,{className:"mb-4 border-amber-200 bg-amber-50",children:[t.jsx(re,{className:"h-4 w-4 text-amber-600"}),t.jsxs(V,{className:"text-amber-800",children:[t.jsx("strong",{children:"Perhatian:"})," Pembelian ini sudah dalam status ",t.jsx("strong",{children:"LUNAS/DIBAYAR"}),". Perubahan pada data pembelian ini dapat mempengaruhi catatan keuangan dan mungkin memerlukan penyesuaian pembayaran."]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(n,{label:"Vendor",error:i.vendor_id,name:"vendor_id",children:t.jsx(O,{value:{id:a.vendor_id,code:(g=a.vendor)==null?void 0:g.code,name:(v=a.vendor)==null?void 0:v.name},onChange:e=>{r({...a,vendor_id:e.id,vendor:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(n,{label:"Jenis Pajak",error:i.type_of_tax_id,name:"type_of_tax_id",children:t.jsx(W,{value:a.type_of_tax_id,remoteConfig:{url:"/admin/type-of-tax/list",label:e=>e.name,value:e=>e.id.toString()},onValueChange:e=>{r({...a,type_of_tax_id:e})}})}),t.jsx(n,{label:"Gudang",error:i.warehouse_id,name:"warehouse_id",required:!0,children:t.jsx(H,{value:{id:`${a.warehouse_id}`,code:`${(y=a.warehouse)==null?void 0:y.code}`,name:`${(j=a.warehouse)==null?void 0:j.name}`},onChange:e=>{r({...a,warehouse_id:e.id,warehouse:{id:e.id,code:e.code,name:e.name}})}})}),t.jsx(n,{label:"Divisi",error:i.division_id,name:"division_id",children:t.jsx(z,{value:{id:a.division_id,code:(P=a.division)==null?void 0:P.code,name:(C=a.division)==null?void 0:C.name},onChange:e=>{r({...a,division_id:e.id,division:e})},clearable:!0})}),t.jsx(n,{label:"Tanggal",error:i.purchase_date,name:"purchase_date",children:t.jsx(d,{type:"date",value:a.purchase_date,onChange:e=>{r({...a,purchase_date:e.target.value})}})}),t.jsx(n,{label:"Nomor",error:i.no,name:"no",required:!0,children:t.jsx(d,{type:"text",value:a.no,onChange:e=>{r({...a,no:e.target.value})}})}),t.jsx(n,{label:"Nomor Invoice",error:i.invoice_number,name:"invoice_number",required:!0,children:t.jsx(ee,{value:a.invoice_number??"",onChange:e=>{r({...a,invoice_number:e})},endpoint:"/admin/purchase/invoices",historyColumns:["invoice_number","number"]})}),t.jsx(n,{label:"No. PO",error:i.purchase_order_number,name:"purchase_order_number",children:t.jsx(d,{type:"text",value:a.purchase_order_number,onChange:e=>{r({...a,purchase_order_number:e.target.value})}})}),t.jsx(n,{label:"Metode Pembayaran",error:i.payment_method,name:"payment_method",required:!0,children:t.jsx(K,{value:a.payment_method??"Credit",onChange:e=>{r({...a,payment_method:e})}})}),t.jsx(n,{label:"Faktur Pajak",error:i.tax_invoice_number,name:"tax_invoice_number",required:!0,children:t.jsx(d,{type:"text",value:a.tax_invoice_number,onChange:e=>{r({...a,tax_invoice_number:e.target.value})}})}),a.payment_method=="Credit"&&t.jsx(n,{label:"Jatuh Tempo",error:i.due_date,name:"due_date",children:t.jsx(d,{type:"date",value:a.due_date,onChange:e=>{r({...a,due_date:e.target.value})}})}),t.jsx("div",{className:"col-span-3",children:t.jsx(n,{label:"Catatan",error:i.note,name:"note",children:t.jsx(J,{value:a.note,onChange:e=>{r({...a,note:e.target.value})}})})}),t.jsxs("div",{className:"col-span-3",children:[t.jsx(te,{auditableType:"App\\Models\\PurchaseItem",keyField:"purchase_id",valueField:a.id||"",trigger:t.jsx(k,{className:"mt-5",children:"Riwayat Item"}),title:"Riwayat Perubahan Item Pembelian",description:"Lihat semua perubahan pada item-item pembelian ini"}),t.jsx(Z,{items:a.items??[],onEdit:q,onDelete:L}),t.jsx(k,{className:"w-full",onClick:$,children:t.jsx(ie,{})})]}),t.jsx("div",{className:"col-span-3",children:t.jsx(X,{data:a,setData:r,type_ofTax:N})})]}),t.jsx(ae,{label:"Ubah",processingLabel:"Mengubah...",processing:A,onClick:F}),t.jsx(Q,{formDialog:m,onOpenChange:e=>{p({...m,open:e})},data:l,setData:c,errors:E,onSave:B})]})}ne.layout=u=>t.jsx(Y,{breadcrumbs:[{label:"Dashboard",href:"/admin/"},{label:"Transaksi",href:"#"},{label:"Pembelian",href:"/admin/purchase"},{label:"Edit",href:"#"}],children:u});export{ne as default};
