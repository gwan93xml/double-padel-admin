import{r as o,a as q,j as e,W as K}from"./app-CQ-G37p-.js";import{A as Q}from"./AuthenticatedLayout-X6euxa7E.js";import{C as P,a as D,b as W,c as A,d as F}from"./card-Bq41eL_q.js";import{h as _}from"./moment-C5S46NFB.js";import{B as f}from"./button-ymMXdPy5.js";import{T as U,a as V,b as I,c as Y,d as X,e as L}from"./table-BSdxGOLt.js";import{F as B}from"./form-group-CHZXn8bM.js";import{I as z}from"./input-BXXA-PDa.js";import{L as $}from"./label-Blk7FhF1.js";import{B as R}from"./badge-CsIJHFj0.js";import{C as J}from"./checkbox-DaA1krf_.js";import{C as Z,a as ee,b as re,c as ae,d as se,e as te}from"./command-BCd-qebN.js";import{P as de,a as oe,b as le}from"./popover-BMGWAYFn.js";import{C as ie}from"./chevron-down-BOk5s691.js";import{C as O}from"./index-B9VoEdXn.js";import{X as ne}from"./x-D2Pel9EU.js";import{P as H}from"./package-Cd0mGsRo.js";import{S as G}from"./search-B9EA-nRY.js";import{C as ce}from"./calendar-BV_-Gsoc.js";import{W as me}from"./warehouse-DEv1PKrL.js";import{F as xe}from"./file-text-vhY6aTSF.js";import{D as he}from"./download-o5rqL5cq.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./index-C7S3ohsj.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./use-toast-XJEkqv7A.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./index-CZ_DqijM.js";import"./dialog-CBBIkam9.js";function ge({selectedWarehouses:g=[],onSelectionChange:t,placeholder:b="Cari warehouse...",className:j=""}){const[n,k]=o.useState([]),[N,m]=o.useState([]),[x,S]=o.useState(""),[E,p]=o.useState(!1),[c,i]=o.useState(new Set(g.map(r=>r.id).filter(r=>r!==void 0)));o.useEffect(()=>{w()},[]),o.useEffect(()=>{i(new Set(g.map(r=>r.id).filter(r=>r!==void 0)))},[g]),o.useEffect(()=>{if(!x.trim())m(n);else{const r=n.filter(a=>{var d,l;return((d=a.name)==null?void 0:d.toLowerCase().includes(x.toLowerCase()))||((l=a.code)==null?void 0:l.toLowerCase().includes(x.toLowerCase()))});m(r)}},[n,x]);const w=async()=>{p(!0);try{const{data:r}=await q.get("/admin/warehouse/list",{params:{take:100}});k(r.data.map(a=>({id:a.id,name:a.name,code:a.code}))||[])}catch(r){console.error("Failed to load warehouses:",r),k([])}finally{p(!1)}},u=r=>{if(!r.id)return;const a=new Set(c);a.has(r.id)?a.delete(r.id):a.add(r.id),i(a);const d=n.filter(l=>a.has(l.id));t==null||t(d)},v=()=>{const r=new Set(n.map(a=>a.id).filter(a=>a!==void 0));i(r),t==null||t(n)},T=()=>{i(new Set),t==null||t([])},M=n.length>0&&c.size===n.length,s=c.size===0;return e.jsx("div",{className:j,children:e.jsxs(de,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[c.size===0?"Pilih warehouse...":`${c.size} warehouse dipilih`,e.jsx(ie,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(le,{className:"w-full p-0",align:"start",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(f,{type:"button",size:"sm",onClick:v,disabled:M,children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"All"]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:T,disabled:s,children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Clear"]})]}),e.jsxs(Z,{className:"rounded-lg",children:[e.jsx(ee,{placeholder:b,value:x,onValueChange:S}),e.jsxs(re,{className:"max-h-64",children:[e.jsx(ae,{children:E?"Loading warehouses...":x?"No warehouses found":"No warehouses available"}),e.jsx(se,{children:N.map(r=>e.jsxs(te,{onSelect:()=>u(r),className:"flex items-center space-x-3 p-2 cursor-pointer",children:[e.jsx(J,{checked:c.has(r.id),onCheckedChange:()=>u(r),onClick:a=>a.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:r.name}),e.jsx("div",{className:"text-gray-500 text-xs",children:r.code})]}),c.has(r.id)&&e.jsx(O,{className:"h-4 w-4 text-green-600"})]},r.id))})]})]})]})})]})})}function pe({warehouses:g}){const{data:t,setData:b,errors:j,setError:n,clearErrors:k}=K({from_date:_().startOf("month").format("YYYY-MM"),to_date:_().endOf("month").format("YYYY-MM"),warehouses:[]}),N=o.useRef(null),[m,x]=o.useState([]),[S,E]=o.useState(1),[p,c]=o.useState(!0),[i,w]=o.useState(!1);async function u(s=!1){var a,d;if(i)return;const r=s?1:S+1;if(!(!s&&!p)){k(),w(!0);try{const h=(await q.get("/admin/stock-report-monthly/list",{params:{warehouse_id:t.warehouses.map(C=>C.id),from_date:t.from_date,to_date:t.to_date,page:r}})).data,y=h.data;x(C=>s?y:[...C,...y]),E(h.current_page),c(h.next_page_url!==null)}catch(l){n(((d=(a=l.response)==null?void 0:a.data)==null?void 0:d.errors)??{})}finally{w(!1)}}}o.useEffect(()=>{u(!0)},[]),o.useEffect(()=>{const s=N.current;if(!s)return;const r=new IntersectionObserver(a=>{a.forEach(d=>{d.isIntersecting&&p&&!i&&(console.log("Loading more items..."),u(!1))})},{threshold:1});return r.observe(s),()=>r.disconnect()},[p,i]);function v(s){const r=new URLSearchParams;return Object.entries(s).forEach(([a,d])=>{d!=null&&(Array.isArray(d)?d.forEach(l=>r.append(`${a}[]`,String(l))):typeof d=="object"?Object.entries(d).forEach(([l,h])=>{r.append(`${a}[${l}]`,String(h))}):r.append(a,String(d)))}),r.toString()}function T(){if(i)return;const s=`/admin/stock-report-monthly/export-pdf?${v({from_date:t.from_date,to_date:t.to_date,warehouse_id:t.warehouses.map(r=>r.id)})}`;window.open(s)}function M(){if(i)return;const s=`/admin/stock-report-monthly/export-excel?${v({from_date:t.from_date,to_date:t.to_date,warehouse_id:t.warehouses.map(r=>r.id)})}`;window.open(s)}return e.jsxs("div",{className:"p-4 md:p-6 bg-gradient-to-br min-h-screen",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",children:e.jsx(H,{className:"h-6 w-6 "})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold ",children:"Laporan Rekap Stok"}),e.jsx("p",{className:"",children:"Monitoring pergerakan stok bulanan per gudang"})]})]})}),e.jsxs(P,{className:"mb-6 shadow-lg",children:[e.jsxs(D,{className:"bg-gradient-to-r rounded-t-lg border-b",children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Filter Pencarian"]}),e.jsx(A,{className:"",children:"Tentukan kriteria pencarian untuk laporan stok"})]}),e.jsxs(F,{className:"p-6 ",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(ce,{className:"h-4 w-4"}),"Periode Laporan"]}),e.jsxs(B,{error:j.from_date,children:[e.jsx($,{htmlFor:"from_date",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Dari Bulan"}),e.jsx(z,{id:"from_date",type:"month",value:t.from_date,onChange:s=>b("from_date",s.target.value),className:"mt-1  text-gray-900 dark:text-gray-100"})]}),e.jsxs(B,{error:j.to_date,children:[e.jsx($,{htmlFor:"to_date",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Sampai Bulan"}),e.jsx(z,{id:"to_date",type:"month",value:t.to_date,onChange:s=>b("to_date",s.target.value),className:"mt-1 text-gray-900 dark:text-gray-100"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(me,{className:"h-4 w-4"}),"Filter Gudang"]}),e.jsx(B,{error:j.warehouses,children:e.jsx(ge,{selectedWarehouses:t.warehouses,onSelectionChange:s=>{b("warehouses",s)},placeholder:"Cari warehouse..."})})]})]}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(f,{onClick:()=>u(!0),disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Tampilkan Laporan"]})})})]})]}),m.length>0&&e.jsx(e.Fragment,{children:e.jsxs(P,{className:"shadow-lg border-0 dark:border dark:border-gray-700",children:[e.jsx(D,{className:"bg-white dark:bg-black border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{className:"text-xl text-gray-900 dark:text-gray-100",children:"Detail Pergerakan Stok"}),e.jsxs(A,{className:"text-gray-600 dark:text-gray-400",children:["Menampilkan ",m.length," gudang untuk periode"," ",_(t.from_date).format("MMMM YYYY")," - ",_(t.to_date).format("MMMM YYYY")]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 md:mt-0",children:[e.jsxs(f,{variant:"outline",size:"sm",className:"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",onClick:T,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Export PDF"]}),e.jsxs(f,{variant:"outline",size:"sm",className:"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",onClick:M,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Export Excel"]})]})]})}),e.jsx(F,{className:"p-0 bg-white dark:bg-black",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(I,{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 border-b border-gray-200 dark:border-gray-600",children:[e.jsx(Y,{className:"font-semibold text-gray-900 dark:text-gray-100 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:"Item"})}),t.warehouses.map((s,r)=>e.jsx(Y,{className:"text-center font-semibold text-gray-900 dark:text-gray-100",children:s.name})),e.jsx(Y,{className:"text-center font-semibold text-gray-900 dark:text-gray-100",children:"Total"})]})}),e.jsx(X,{children:m.map((s,r)=>{const a=s.category,d=m[r-1],l=d?d.category:null,h=!l||a.id!==l.id;return e.jsxs(e.Fragment,{children:[h&&e.jsx(I,{className:"bg-gray-50 dark:bg-gray-800",children:e.jsx(L,{colSpan:t.warehouses.length+2,className:"py-2",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.name})})})}),e.jsxs(I,{className:"hover:bg-blue-50/50 dark:hover:bg-gray-700/50 transition-colors border-b border-gray-200 dark:border-gray-600",children:[e.jsx(L,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.code})]})}),s.warehouses.map((y,C)=>e.jsx(e.Fragment,{children:e.jsx(L,{className:"text-right",children:e.jsx(R,{className:`font-bold ${y.ending_balance>0?"bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 border-purple-200 dark:border-purple-700":"bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600"}`,variant:"outline",children:y.ending_balance})})})),e.jsx(L,{className:"text-right",children:e.jsx(R,{className:`font-bold ${s.total>0?"bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 border-purple-200 dark:border-purple-700":"bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600"}`,variant:"outline",children:s.total})})]},r)]})})})]}),e.jsx("div",{ref:N,className:"h-2"})]})})]})}),m.length===0&&!i&&e.jsx(P,{className:"text-center py-12 border-0 dark:border dark:border-gray-700",children:e.jsx(F,{className:"bg-white dark:bg-black",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center",children:e.jsx(H,{className:"h-8 w-8 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Belum Ada Data"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:'Klik tombol "Tampilkan Laporan" untuk melihat data stok'})]})]})})})]})}pe.layout=g=>e.jsx(Q,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Laporan",href:"#"},{label:"Stok per Bulan",href:"#"}],children:g});export{pe as default};
