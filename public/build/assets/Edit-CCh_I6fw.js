import{W as k,r as y,j as e,a as g,y as ue}from"./app-CQ-G37p-.js";import{S as xe}from"./SearchChartOfAccount-0Jd4yGJY.js";import{S as _e}from"./SearchDivision-Budjprvk.js";import{S as fe}from"./SearchItem-DGpcvLrN.js";import{S as pe}from"./SearchSubUnit-CTrUekdR.js";import{S as je}from"./SearchWarehouse-Bw-VGbhg.js";import{B as h}from"./button-ymMXdPy5.js";import{C as ge}from"./currency-formatter-D5vTOkIG.js";import{D as we,a as be,d as Ie}from"./dialog-CBBIkam9.js";import{F as d}from"./form-group-CHZXn8bM.js";import{I as S}from"./input-BXXA-PDa.js";import{M as ve}from"./money-input-Bb590VQ4.js";import{S as Ce,a as ke,b as ye,c as Se,d as J}from"./select-BSIJzAmS.js";import{T as V,a as H,b as w,c as s,d as L,e as b}from"./table-BSdxGOLt.js";import{T as Ne}from"./textarea-BvykTLwI.js";import{A as Ee}from"./AuthenticatedLayout-X6euxa7E.js";import{u as Ae}from"./use-toast-XJEkqv7A.js";import{h as De}from"./moment-C5S46NFB.js";import Oe from"./ItemForm-_Wtip2OZ.js";import{P as W}from"./pencil-XLeJOTln.js";import{T as Q}from"./trash-C6VGYEst.js";import"./card-Bq41eL_q.js";import"./createLucideIcon-iWXofaGH.js";import"./badge-CsIJHFj0.js";import"./loader-circle-i2ANfqrZ.js";import"./search-B9EA-nRY.js";import"./x-D2Pel9EU.js";import"./file-text-vhY6aTSF.js";import"./package-Cd0mGsRo.js";import"./index-D0iIn24t.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./index-DqZ46QiR.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./label-Blk7FhF1.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";function Te({production:I}){var D,O,T,q,B,P,F,M,$,z,G,K,R,U;const{data:a,setData:c,clearErrors:X,errors:u,setError:Z}=k({...I}),{toast:N}=Ae();y.useEffect(()=>{async function t(){const{data:r}=await g.get(`/admin/item/stock/${a.item_id}?warehouse_id=${a.warehouse_id}`);c({...a,stock:r.data.stock})}t()},[a.item_id,a.warehouse_id]);async function E(t){const{data:r}=await g.get(`/admin/item/stock/${t}?warehouse_id=${a.warehouse_id}`);return r.data.stock}const{data:i,setData:p,errors:A}=k({id:"",code:"",name:"",amount:"0"}),[m,f]=y.useState({show:!1,isEdit:!1,chartOfAccountIndex:-1}),ee=()=>{p({id:"",chart_of_account:{id:"",code:"",name:""},amount:"0"}),f({...m,show:!0,isEdit:!1,chartOfAccountIndex:-1})},te=()=>{var t,r,n,x,l,Y;if(m.isEdit){const C=[...a.chart_of_accounts];C[m.chartOfAccountIndex]={...C[m.chartOfAccountIndex],chart_of_account:{id:i.id,code:(t=i.chart_of_account)==null?void 0:t.code,name:(r=i.chart_of_account)==null?void 0:r.name},chart_of_account_id:(n=i.chart_of_account)==null?void 0:n.id,amount:i.amount},c({...a,chart_of_accounts:C})}else c({...a,chart_of_accounts:[...a.chart_of_accounts,{chart_of_account:{id:i.id,code:(x=i.chart_of_account)==null?void 0:x.code,name:(l=i.chart_of_account)==null?void 0:l.name},chart_of_account_id:(Y=i.chart_of_account)==null?void 0:Y.id,amount:i.amount}]});f({...m,show:!1,isEdit:!1})},ae=t=>{var r,n;p({...i,chart_of_account:{id:a.chart_of_accounts[t].chart_of_account_id??"",code:((r=a.chart_of_accounts[t].chart_of_account)==null?void 0:r.code)??"",name:((n=a.chart_of_accounts[t].chart_of_account)==null?void 0:n.name)??""},amount:a.chart_of_accounts[t].amount}),f({...m,show:!0,isEdit:!0,chartOfAccountIndex:t})},re=t=>{const r=[...a.chart_of_accounts];r.splice(t,1),c({...a,chart_of_accounts:r})},se=async()=>{try{X(),await g.put(`/admin/production/${a.id}`,{...a,date:De(a.date).format("YYYY-MM-DD")}),ue.visit("/admin/production"),N({title:"Berhasil",description:"Produksi berhasil diubah"})}catch(t){t.response.status==422?Z(t.response.data.errors):N({title:"Gagal",description:t.response.data.message})}},[_,j]=y.useState({show:!1,isEdit:!1,itemIndex:-1}),{data:o,setData:v,errors:oe,setError:ie,clearErrors:ce}=k({item_id:"",quantity:"0"}),ne=()=>{j({..._,show:!0,isEdit:!1,itemIndex:-1}),v({item_id:"",item:{id:"",code:"",name:"",purchase_price:"0",selling_price:"0"},quantity:"0"})},de=async()=>{ce();try{return await g.post("/admin/production/validate",o),!0}catch(t){return ie(t.response.data.errors),!1}},me=async()=>{var t,r,n,x;if(await de()){if(_.isEdit){const l=[...a.items];l[_.itemIndex]={...l[_.itemIndex],item:{id:o.item_id,code:(t=o.item)==null?void 0:t.code,name:(r=o.item)==null?void 0:r.name},item_id:o.item_id,quantity:o.quantity,unit:o.unit,remarks:o.remarks,warehouse_id:a.warehouse_id,stock:await E(o.item_id),notes:o.notes},c({...a,items:l})}else c({...a,items:[...a.items,{item:{id:o.item_id,code:(n=o.item)==null?void 0:n.code,name:(x=o.item)==null?void 0:x.name},item_id:o.item_id,quantity:o.quantity,unit:o.unit,remarks:o.remarks,warehouse_id:a.warehouse_id,stock:await E(o.item_id),notes:o.notes}]});j({..._,show:!1,itemIndex:-1,isEdit:!1})}},le=(t,r)=>{v(r),j({..._,show:!0,isEdit:!0,itemIndex:t})},he=t=>{const r=[...a.items];r.splice(t,1),c({...a,items:r})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-5  px-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[e.jsx(d,{label:"Divisi",error:u.division_id,children:e.jsx(_e,{value:{id:a.division_id,code:(D=a.division)==null?void 0:D.code,name:(O=a.division)==null?void 0:O.name},onChange:t=>{c({...a,division_id:t.id,division:{code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Gudang",error:u.warehouse_id,children:e.jsx(je,{value:{id:a.warehouse_id,code:(T=a.warehouse)==null?void 0:T.code,name:(q=a.warehouse)==null?void 0:q.name},onChange:t=>{c({...a,warehouse_id:t.id,warehouse:{code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Tanggal",error:u.date,children:e.jsx(S,{type:"date",value:a.date,onChange:t=>{c({...a,date:t.target.value})}})}),e.jsx(d,{label:"Barang Diproduksi",error:u.item_id,children:e.jsx(fe,{value:{id:a.item_id??"",code:((B=a.item)==null?void 0:B.code)??"",name:((P=a.item)==null?void 0:P.name)??"",purchase_price:((F=a.item)==null?void 0:F.purchase_price)??"",selling_price:((M=a.item)==null?void 0:M.selling_price)??"",unit:(($=a.item)==null?void 0:$.unit)??""},onChange:t=>{c({...a,item_id:t.id,item:{code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Sisa Stok",children:e.jsx(S,{type:"text",disabled:!0,value:a.stock})}),e.jsx(d,{label:"Jumlah",error:u.quantity,children:e.jsx(S,{type:"number",value:a.quantity,onChange:t=>{c({...a,quantity:t.target.value})}})}),e.jsx(d,{label:"Satuan",required:!0,error:u.unit,children:e.jsx(pe,{itemId:a.item_id,value:a.unit,onChange:t=>{c({...a,unit:t})}})}),e.jsx(d,{label:"Status",error:u.status,children:e.jsxs(Ce,{value:a.status,onValueChange:t=>{c({...a,status:t})},children:[e.jsx(ke,{children:e.jsx(ye,{placeholder:"Pilih Status"})}),e.jsxs(Se,{children:[e.jsx(J,{value:"completed",children:"Selesai"}),e.jsx(J,{value:"pending",children:"Pending"})]})]})}),e.jsx(d,{label:"Catatan",error:u.notes,children:e.jsx(Ne,{value:a.notes,onChange:t=>{c({...a,notes:t.target.value})}})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("h4",{className:"bg-blue-300 text-center",children:"Item/Stock yang berkurang"}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(w,{children:[e.jsx(s,{children:"No"}),e.jsx(s,{children:"Kode"}),e.jsx(s,{children:"Nama"}),e.jsx(s,{children:"Keterangan"}),e.jsx(s,{className:"text-right",children:"Jumlah"}),e.jsx(s,{children:"Catatan"}),e.jsx(s,{children:"Gudang"}),e.jsx(s,{className:"text-right",children:"Item Sisa"}),e.jsx(s,{className:"text-right",children:"Aksi"})]})}),e.jsx(L,{children:(z=a.items)==null?void 0:z.map((t,r)=>{var n,x,l;return e.jsxs(w,{children:[e.jsx(s,{className:"w-[10px]",children:r+1}),e.jsx(s,{children:(n=t.item)==null?void 0:n.code}),e.jsx(s,{children:(x=t.item)==null?void 0:x.name}),e.jsx(s,{children:t.remarks}),e.jsxs(s,{className:"text-right",children:[t.quantity," ",t.unit]}),e.jsx(s,{children:t.notes}),e.jsx(s,{children:(l=a.warehouse)==null?void 0:l.name}),e.jsx(s,{className:"text-right",children:t.stock}),e.jsxs(s,{className:"text-right",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>le(r,t),children:e.jsx(W,{})}),e.jsx(h,{variant:"destructive",onClick:()=>he(r),size:"sm",children:e.jsx(Q,{})})]})]},r)})})]}),e.jsx(h,{onClick:ne,className:"w-full",children:"Tambah Item"})]}),e.jsx("div",{className:"col-span-3",children:e.jsx("hr",{})}),e.jsxs("div",{className:"col-span-3 mb-3",children:[e.jsx("h4",{className:"bg-blue-300 text-center",children:"Tambahan Cost/Biaya dari"}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(w,{children:[e.jsx(s,{children:"NO."}),e.jsx(s,{children:"AKUN"}),e.jsx(s,{className:"w-[200px]",children:"NILAI"}),e.jsx(s,{className:"w-[100px]",children:"AKSI"})]})}),e.jsx(L,{children:(G=a.chart_of_accounts)==null?void 0:G.map((t,r)=>e.jsxs(w,{children:[e.jsx(b,{className:"w-[10px]",children:r+1}),e.jsxs(b,{children:[t.chart_of_account.code," - ",t.chart_of_account.name]}),e.jsx(b,{className:"text-right",children:e.jsx(ge,{amount:t.amount})}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ae(r),children:e.jsx(W,{})}),e.jsx(h,{variant:"destructive",onClick:()=>re(r),size:"sm",children:e.jsx(Q,{})})]})})]},r))})]}),e.jsx(h,{onClick:ee,className:"w-full",children:"Tambah Cost/Biaya Dari"})]})]}),e.jsx(we,{open:m.show,onOpenChange:t=>{f({...m,show:t})},children:e.jsxs(be,{className:" max-h-[80vh] overflow-y-auto",children:[e.jsx(d,{label:"Akun",error:A.chart_of_account_id,children:e.jsx(xe,{value:{id:(K=i.chart_of_account)==null?void 0:K.id,code:(R=i.chart_of_account)==null?void 0:R.code,name:(U=i.chart_of_account)==null?void 0:U.name},onChange:t=>{p({...i,chart_of_account_id:t.id,chart_of_account:{id:t.id,code:t.code,name:t.name}})}})}),e.jsx(d,{label:"Jumlah",error:A.amount,children:e.jsx(ve,{value:i.amount,onValueChange:t=>{p({...i,amount:t})}})}),e.jsxs(Ie,{children:[e.jsx(h,{variant:"secondary",onClick:()=>{f({...m,show:!1})},children:"Batal"}),e.jsx(h,{onClick:te,children:m.isEdit?"Ubah":"Tambah"})]})]})}),e.jsx(Oe,{onSave:me,errors:oe,formDialog:_,setFormDialog:j,item:o,setItem:v,data:a}),e.jsx(h,{type:"button",onClick:se,children:"Ubah"})]})})}Te.layout=I=>e.jsx(Ee,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Transaksi",href:"#"},{label:"Produksi",href:"/admin/production"},{label:"Edit",href:"#"}],children:I});export{Te as default};
