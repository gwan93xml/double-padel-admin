import{r as a,j as e,a as N}from"./app-CQ-G37p-.js";import{B as u}from"./button-ymMXdPy5.js";import{I as p}from"./input-BXXA-PDa.js";import{D as R,a as A,b as F,c as L}from"./dialog-CBBIkam9.js";import{T as G,a as M,b as S,c as r,d as Y}from"./table-BSdxGOLt.js";import{C as H}from"./currency-formatter-D5vTOkIG.js";import{h as _}from"./moment-C5S46NFB.js";import{S as w}from"./search-B9EA-nRY.js";import{F as $}from"./folder-BoHnSs8n.js";function X({onChange:g,value:d,customerId:y=""}){const[n,c]=a.useState({id:"",number:""}),[t,x]=a.useState(!1),[i,l]=a.useState(""),C=a.useRef(!1);a.useRef(d),a.useEffect(()=>{d&&c({id:d.id||"",number:d.number||""})},[]),a.useEffect(()=>{g(n)},[n]);const v=s=>{c({...n,number:s.target.value}),l("")},j=async s=>{if(s.trim()){x(!0),l("");try{const{data:o}=await N.get(`/admin/sales-order/search-by-number?search=${s}`);o.data?(C.current=!0,c({id:o.data.id,number:o.data.number})):l("Sales order not found")}catch(o){l("Failed to search sales order"),console.error(o)}finally{x(!1)}}},B=s=>{s.key==="Enter"&&j(n.number)},D=()=>{n.number&&j(n.number)},[O,m]=a.useState(!1),[f,T]=a.useState(""),[E,k]=a.useState([]),I=()=>{m(!0),h()},h=async()=>{try{const s=await N.get(`/admin/sales-order/list?search=${f}&customer_id=${y}`);k(s.data.data)}catch(s){console.error(s)}};return a.useEffect(()=>{h()},[]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-full",children:e.jsx(p,{className:"rounded-r-none",placeholder:"Nomor Sales Order",value:n.number,onChange:v,onKeyDown:B,disabled:t})}),e.jsxs("div",{className:"flex",children:[e.jsx(u,{className:"rounded-none",onClick:D,disabled:t,children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx(u,{className:"rounded-none",onClick:I,disabled:t,children:e.jsx($,{className:"h-4 w-4"})})]})]}),t&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Searching..."}),i&&e.jsx("div",{className:"text-sm text-destructive",children:i}),n.id&&!t&&!i&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Sales Order found: ",n.number]}),e.jsx(R,{open:O,onOpenChange:m,children:e.jsxs(A,{className:"min-w-[70%]",children:[e.jsx(F,{children:e.jsx(L,{children:"Browse Sales Order"})}),e.jsxs("div",{className:"flex",children:[e.jsx(p,{className:"rounded-r-none",value:f,onChange:s=>T(s.target.value)}),e.jsx(u,{className:"rounded-l-none",onClick:h,children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsxs(G,{children:[e.jsx(M,{children:e.jsxs(S,{children:[e.jsx(r,{children:"NOMOR"}),e.jsx(r,{children:"NOMOR PO"}),e.jsx(r,{children:"DIVISI"}),e.jsx(r,{children:"TANGGAL"}),e.jsx(r,{children:"PELANGGAN"}),e.jsx(r,{children:"TOTAL"})]})}),e.jsx(Y,{children:E.map(s=>{var o,b;return e.jsxs(S,{onClick:()=>{c(s),m(!1)},className:"cursor-pointer hover:bg-muted",children:[e.jsx(r,{children:s.number}),e.jsx(r,{children:s.purchase_order_number}),e.jsx(r,{children:(o=s.division)==null?void 0:o.name}),e.jsx(r,{children:_(s.date).format("DD/MM/YYYY")}),e.jsx(r,{children:(b=s.customer)==null?void 0:b.name}),e.jsx(r,{children:e.jsx(H,{amount:parseFloat(s.total??"0")})})]},s.id)})})]})]})})]})}export{X as S};
