import{r as h,j as s,a as G}from"./app-CQ-G37p-.js";import{A as C}from"./AuthenticatedLayout-X6euxa7E.js";import{B as D}from"./button-ymMXdPy5.js";import{C as R,d as S,a as H,b as U}from"./card-Bq41eL_q.js";import{D as $}from"./date-filter-BrNgVtk9.js";import{h as x}from"./moment-C5S46NFB.js";import{S as V,a as K,b as J,c as z,d as Q}from"./select-BSIJzAmS.js";import{T as W}from"./trash-C6VGYEst.js";import{F as q}from"./form-group-CHZXn8bM.js";import{b as k,i as X}from"./build-query-params-CFlHKNGq.js";import{L as M}from"./loader-circle-i2ANfqrZ.js";import{F as Z}from"./file-text-vhY6aTSF.js";import{D as ii}from"./download-o5rqL5cq.js";import{f as si}from"./format-DzEUF7Jh.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./input-BXXA-PDa.js";import"./index-DqZ46QiR.js";import"./index-BHS3gC_j.js";import"./index-B9C1SM0Q.js";import"./tslib.es6-eMSY344_.js";import"./index-uJ2KZHf0.js";import"./x-D2Pel9EU.js";import"./index-C7S3ohsj.js";import"./index-B9VoEdXn.js";import"./can-DARgw7Bo.js";import"./chevron-right-DWL5tPD-.js";import"./use-toast-XJEkqv7A.js";import"./badge-CsIJHFj0.js";import"./currency-formatter-D5vTOkIG.js";import"./triangle-alert-byTh5Szo.js";import"./calendar-BV_-Gsoc.js";import"./index-Cu_r977E.js";import"./index-D-8iXXsP.js";import"./calendar-days-CaBtbxTM.js";import"./index-CZ_DqijM.js";import"./chevron-down-BOk5s691.js";import"./label-Blk7FhF1.js";function ei({divisions:j,onChange:r}){const N=[{code:"GABUNGAN",name:"GABUNGAN",id:0},...j],[b,v]=h.useState([]),[p,_]=h.useState(""),y=o=>{const u=N.find(n=>n.id===parseInt(o));if(u&&!b.some(n=>n.id===u.id)){const n=[...b,u];v(n),r==null||r(n)}_("")},w=o=>{const u=b.filter(n=>n.id!==o.id);v(u),r==null||r(u)};return s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(V,{onValueChange:y,value:p,children:[s.jsx(K,{children:s.jsx(J,{placeholder:"Pilih Divisi"})}),s.jsx(z,{children:N.map(o=>s.jsx(Q,{value:`${o.id}`,children:o.name},o.id))})]}),b.map(o=>s.jsxs("div",{className:"flex items-center border px-2 py-1 rounded gap-x-2",children:[s.jsx(D,{variant:"destructive",size:"sm",onClick:w.bind(null,o),children:s.jsx(W,{className:"h-4 w-4"})}),s.jsx("span",{children:o.name})]},o.id))]})}const F=["bg-red-500","bg-green-500","bg-blue-500","bg-yellow-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-cyan-500","bg-amber-500","bg-lime-500","bg-emerald-500","bg-fuchsia-500","bg-violet-500","bg-rose-500"];function ti({divisions:j}){const[r,N]=h.useState({amounts:[],startDate:"",endDate:"",divisions:[]}),[b,v]=h.useState(!1),[p,_]=h.useState({dateType:"month",year:x().year(),monthFrom:x().month(0).format("MM"),monthTo:x().month(11).format("MM"),dateFrom:x().startOf("month").format("YYYY-MM-DD"),dateTo:x().endOf("month").format("YYYY-MM-DD"),date:x().format("YYYY-MM-DD"),divisions_id:[]}),[y,w]=h.useState(!1),[o,u]=h.useState(!1),n=i=>{const t=new Intl.NumberFormat("id-ID",{style:"decimal",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.abs(i));return i<0?`(${t})`:t},A=i=>i===0?"-":`(${new Intl.NumberFormat("id-ID",{style:"decimal",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.abs(i))})`,Y=()=>{window.open(`/admin/income-statement/export-pdf?${k(p)}`,"_blank")},L=()=>{window.open(`/admin/income-statement/export-excel?${k(p)}`,"_blank")};h.useEffect(()=>{(async()=>{v(!0);const t=await G.get("/admin/income-statement/list",{params:{...p}});N(t.data.data),v(!1)})()},[p]);const E=i=>typeof i=="number"&&isFinite(i)?i:Number(i)||0,a=i=>i.reduce((t,e)=>t+E(e),0);function l(i,t,e){const d=new Set(Array.isArray(t)?t:[t]);return a(i.amounts.filter(c=>d.has(c.group)).map(c=>{if(!Array.isArray(c.divisions))return 0;if(e==null)return a(c.divisions.map(m=>m==null?void 0:m.amount));const f=c.divisions.find(m=>(m==null?void 0:m.division_id)==e);return E(f==null?void 0:f.amount)}))}const O=["beginningInventories","purchases","purchaseDiscounts","shippingFees","purchaseReturns","stockCorrections"],T="endingInventories";function g(i,t){const e=l(i,O,t),d=l(i,T,t);return e-d}function P(i,t){const e=l(i,"sales",t),d=g(i,t);return e-d}function I(i,t){const e=l(i,"sales",t),d=g(i,t),c=l(i,"expenses",t),f=l(i,"otherRevenues",t),m=l(i,"otherExpenses",t);return e-d-c+f-m}function B(i){const t=l(i,"sales"),e=g(i),d=l(i,"expenses"),c=l(i,"otherRevenues"),f=l(i,"otherExpenses");return t-e-d+c-f}return s.jsxs("div",{className:"min-h-screen  p-4 md:p-6",children:[s.jsx(R,{className:"mb-6",children:s.jsx(S,{className:"pt-6",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[s.jsxs("div",{className:"flex gap-2 items-start flex-1",children:[s.jsx("div",{className:"flex-1",children:s.jsx($,{f:p,setF:_})}),s.jsx("div",{className:"flex-1 pt-3",children:s.jsx(q,{label:"Divisi :",children:s.jsx(ei,{divisions:j,onChange:i=>{_(t=>({...t,divisions_id:i.map(e=>e.id)}))}})})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(D,{onClick:Y,disabled:y,className:"bg-red-600 hover:bg-red-700",children:[y?s.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(Z,{className:"mr-2 h-4 w-4"}),"Export PDF"]}),s.jsxs(D,{onClick:L,disabled:o,className:"bg-green-600 hover:bg-green-700",children:[o?s.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(ii,{className:"mr-2 h-4 w-4"}),"Export Excel"]})]})]})})}),b?s.jsx(s.Fragment,{children:"Loading..."}):s.jsxs(s.Fragment,{children:[s.jsxs(R,{className:"mb-6",children:[s.jsx(H,{children:s.jsxs(U,{children:["LAPORAN LABA RUGI PERIODE ",x(r.startDate).format("DD MMMM YYYY")," s/d ",x(r.endDate).format("DD MMMM YYYY")]})}),s.jsx(S,{children:s.jsx("table",{className:"w-full",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"w-[30%]"}),r.divisions.map((i,t)=>s.jsx("td",{style:{width:"15%"},className:`border-b border-black text-center ${F[t%F.length]} text-white font-semibold`,children:i.name})),s.jsx("td",{style:{width:"15%"},className:"border-b border-black text-center"})]}),r.amounts.filter(i=>i.group==="sales").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"TOTAL PENDAPATAN : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:a(r.amounts.filter(t=>t.group==="sales").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0))===0?"-":n(a(r.amounts.filter(t=>t.group==="sales").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0)))})),s.jsx("td",{className:"border-t border-b border-black text-right",children:n(a(r.amounts.filter(i=>i.group==="sales").map(i=>a(i.divisions.map(t=>t.amount)))))}),r.amounts.filter(i=>i.group==="beginningInventories").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),r.amounts.filter(i=>i.group==="purchases").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),r.amounts.filter(i=>i.group==="purchaseDiscounts").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),r.amounts.filter(i=>i.group==="shippingFees").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),r.amounts.filter(i=>i.group==="purchaseReturns").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),r.amounts.filter(i=>i.group==="stockCorrections").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),r.amounts.filter(i=>i.group==="endingInventories").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?A(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:A(a(i.divisions.map(e=>e.amount)))})]})),s.jsxs("tr",{children:[s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"TOTAL HARGA POKOK PENJUALAN : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:(()=>{const t=g(r,i.id);return t===0?"-":n(t)})()})),s.jsx("td",{className:"border-t border-b border-black text-right",children:(()=>{const i=g(r);return n(i)})()})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"LABA (RUGI) KOTOR  : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:(()=>{const t=P(r,i.id);return t===0?"-":n(t)})()})),s.jsx("td",{className:"border-t border-b border-black text-right",children:(()=>{const i=P(r);return n(i)})()})]}),r.amounts.filter(i=>i.group==="expenses").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),s.jsxs("tr",{children:[s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"TOTAL BIAYA/BEBAN  : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:a(r.amounts.filter(t=>t.group==="expenses").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0))===0?"-":n(a(r.amounts.filter(t=>t.group==="expenses").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0)))})),s.jsx("td",{className:"border-t border-b border-black text-right",children:n(a(r.amounts.filter(i=>i.group==="expenses").map(i=>a(i.divisions.map(t=>t.amount)))))})]}),r.amounts.filter(i=>i.group==="otherRevenues").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),s.jsxs("tr",{children:[s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"TOTAL PENDAPATAN LAINNYA  : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:a(r.amounts.filter(t=>t.group==="otherRevenues").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0))===0?"-":n(a(r.amounts.filter(t=>t.group==="otherRevenues").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0)))})),s.jsx("td",{className:"border-t border-b border-black text-right",children:n(a(r.amounts.filter(i=>i.group==="otherRevenues").map(i=>a(i.divisions.map(t=>t.amount)))))})]}),r.amounts.filter(i=>i.group==="otherExpenses").map((i,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:i.account_name}),r.divisions.map(e=>s.jsx("td",{style:{width:"15%"},className:" text-end",children:i.divisions.find(d=>d.division_id==e.id)?n(i.divisions.find(d=>d.division_id==e.id).amount):"-"})),s.jsx("td",{style:{width:"15%"},className:" text-end",children:n(a(i.divisions.map(e=>e.amount)))})]})),s.jsxs("tr",{children:[s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"TOTAL BIAYA/BEBAN LAINNYA  : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:a(r.amounts.filter(t=>t.group==="otherExpenses").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0))===0?"-":n(a(r.amounts.filter(t=>t.group==="otherExpenses").map(t=>t.divisions.find(e=>e.division_id==i.id)?t.divisions.find(e=>e.division_id==i.id).amount:0)))})),s.jsx("td",{className:"border-t border-b border-black text-right",children:n(a(r.amounts.filter(i=>i.group==="otherExpenses").map(i=>a(i.divisions.map(t=>t.amount)))))})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"text-right",children:s.jsx("strong",{children:"LABA (RUGI) PERIODE BERJALAN  : "})}),r.divisions.map(i=>s.jsx("td",{className:"border-t border-b border-black text-right",children:n(I(r,i.id))})),s.jsx("td",{className:"border-t border-b border-black text-right",children:n(B(r))})]})]})})})]}),s.jsxs("div",{className:"mt-8 text-center text-gray-500 text-sm",children:["Generated at ",si(new Date,"dd MMMM yyyy 'pukul' HH:mm",{locale:X})]})]})]})}ti.layout=j=>s.jsx(C,{breadcrumbs:[{label:"Dashboard",href:"/admin"},{label:"Laporan",href:"#"},{label:"Laba Rugi",href:"#"}],children:j});export{ti as default};
