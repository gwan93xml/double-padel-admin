import{r as a,a as D,j as t}from"./app-CQ-G37p-.js";import{B as H}from"./button-ymMXdPy5.js";import{I as R}from"./input-BXXA-PDa.js";import{C as Z,d as ee}from"./card-Bq41eL_q.js";import{L as q}from"./loader-circle-i2ANfqrZ.js";import{S as ne}from"./search-B9EA-nRY.js";import{F as K}from"./form-group-CHZXn8bM.js";import"./index-D0iIn24t.js";import"./createLucideIcon-iWXofaGH.js";import"./label-Blk7FhF1.js";import"./index-DqZ46QiR.js";function te({onChange:s,value:u,clearable:j}){const[r,l]=a.useState({id:"",code:"",name:""}),[c,h]=a.useState(!1),[$,i]=a.useState(""),[N,f]=a.useState([]),[P,o]=a.useState(!1),[x,g]=a.useState(1),[B,p]=a.useState(!0),[k,M]=a.useState(!1),[ae,L]=a.useState(""),m=a.useRef(null),Q=200,I=a.useRef(null),E=a.useRef(null),T=a.useRef(!1),y=a.useRef(null),C=a.useRef(null),[w,b]=a.useState(null);a.useEffect(()=>{u&&!T.current&&l({id:u.id||"",code:u.code||"",name:u.name||""})},[u]),a.useEffect(()=>{},[r,s]),a.useEffect(()=>{if(!c&&!k&&w){const n=setTimeout(()=>{w==="code"&&y.current?y.current.focus():w==="name"&&C.current&&C.current.focus()},0);return()=>clearTimeout(n)}},[c,k,w]),a.useEffect(()=>{const n=e=>{I.current&&!I.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const U=n=>{const e=n.target.value;b("code"),l({...r,code:e}),L(e),A(e,!0),i("")},G=n=>{const e=n.target.value;b("name"),l({...r,name:e}),L(e),A(e,!0),i("")},O=async n=>{if(n.trim()){h(!0),i("");try{const{data:e}=await D.get(`/admin/bank/search-by-code?search=${n}`);e.data?(T.current=!0,l({id:e.data.id,code:e.data.code,name:e.data.name}),s({id:e.data.id,code:e.data.code,name:e.data.name}),o(!1)):i("Bank not found")}catch(e){i("Failed to search bank"),console.error(e)}finally{h(!1)}}},z=async n=>{if(n.trim()){h(!0),i("");try{const{data:e}=await D.get(`/admin/bank/search-by-name?search=${n}`);e.data?(T.current=!0,l({id:e.data.id,code:e.data.code,name:e.data.name}),s({id:e.data.id,code:e.data.code,name:e.data.name}),o(!1)):i("Bank not found")}catch(e){i("Failed to search bank"),console.error(e)}finally{h(!1)}}},Y=n=>{n.key==="Enter"&&(O(r.code??""),o(!1),f([]))},J=n=>{n.key==="Enter"&&(z(r.name??""),o(!1),f([]))},V=()=>{r.code?O(r.code):r.name&&z(r.name)},v=a.useCallback(async(n,e,F=!1)=>{e===1?h(!0):M(!0);try{const{data:d}=await D.get(`/admin/bank/browse?search=${n}&page=${e}&limit=20`);f(F||e===1?d.data||[]:S=>[...S,...d.data||[]]),p(d.next_page_url!==null),o(d.data&&d.data.length>0)}catch(d){console.error("Error fetching banks:",d),i("Failed to load banks")}finally{h(!1),M(!1)}},[]),A=a.useCallback((n,e=!1)=>{if(m.current&&clearTimeout(m.current),n.length<2){f([]),o(!1),g(1),p(!0);return}m.current=setTimeout(()=>{e&&(g(1),p(!0)),v(n,e?1:x,e)},Q)},[v,x]);a.useCallback((n,e=!1)=>{if(m.current&&clearTimeout(m.current),n.length<2){f([]),o(!1),g(1),p(!0);return}e&&(g(1),p(!0)),v(n,e?1:x,e)},[v,x]);const _=a.useCallback(()=>{if(!E.current||k||!B)return;const{scrollTop:n,scrollHeight:e,clientHeight:F}=E.current;if(n+F>=e-5){const d=r.code||r.name;if(d&&d.length>=2){const S=x+1;g(S),v(d,S,!1)}}},[k,B,r.code,r.name,x,v]);a.useEffect(()=>{const n=E.current;if(n)return n.addEventListener("scroll",_),()=>n.removeEventListener("scroll",_)},[_]);const W=n=>{const e=w;l({id:n.id,code:n.code,name:n.name}),s({id:n.id,code:n.code,name:n.name}),f([]),o(!1),i(""),setTimeout(()=>{e==="code"&&y.current?y.current.focus():e==="name"&&C.current&&C.current.focus()},0)},X=()=>{m.current&&clearTimeout(m.current),l({id:"",code:"",name:""}),s({id:"",code:"",name:""}),L(""),f([]),o(!1),i(""),g(1),p(!0)};return a.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),t.jsxs("div",{className:"space-y-2 relative",ref:I,children:[t.jsxs("div",{className:"flex items-center space-x-0 border rounded-lg overflow-hidden bg-background",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(R,{ref:y,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kode Bank",value:r.code,onChange:U,onKeyDown:Y,onFocus:()=>{b("code"),N.length>0&&o(!0)},onBlur:()=>{setTimeout(()=>b(null),150)}})}),t.jsx("div",{className:"border-l border-r",children:t.jsx(H,{variant:"ghost",size:"sm",className:"rounded-none px-3",onClick:V,disabled:c,children:c?t.jsx(q,{className:"h-4 w-4 animate-spin"}):t.jsx(ne,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex-[2] min-w-0",children:t.jsx(R,{ref:C,className:"border-0 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Nama Bank",value:r.name,onChange:G,onKeyDown:J,onFocus:()=>{b("name"),N.length>0&&o(!0)},onBlur:()=>{setTimeout(()=>b(null),150)}})}),j&&t.jsx("div",{className:"border-l",children:t.jsx(H,{variant:"ghost",size:"sm",className:"rounded-none  px-3",onClick:X,children:"Semua Bank"})})]}),P&&N.length>0&&t.jsx(Z,{className:"absolute top-full left-0 right-0 z-50 mt-1 shadow-lg border",children:t.jsx(ee,{className:"p-0",children:t.jsxs("div",{ref:E,className:"max-h-64 overflow-y-auto",children:[t.jsx("div",{className:"sticky top-0 bg-muted/50 border-b px-4 py-2",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-muted-foreground",children:[t.jsx("div",{children:"Kode"}),t.jsx("div",{children:"Nama"})]})}),t.jsxs("div",{className:"divide-y",children:[N.map((n,e)=>t.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>W(n),children:[t.jsx("div",{className:"text-sm font-medium truncate",children:n.code}),t.jsx("div",{className:"text-sm truncate col-span-3",children:n.name})]},`${n.id}-${e}`)),k&&t.jsxs("div",{className:"flex items-center justify-center py-4",children:[t.jsx(q,{className:"h-4 w-4 animate-spin mr-2"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more..."})]}),!B&&N.length>0&&t.jsx("div",{className:"text-center py-4 text-sm text-muted-foreground",children:"No more banks to load"})]})]})})}),$&&t.jsx("div",{className:"text-sm text-destructive bg-destructive/10 px-3 py-2 rounded-md",children:$})]})}function xe({data:s,setData:u,errors:j}){var r,l;return t.jsxs("div",{className:"grid grid-cols-3 gap-x-4  gap-y-4",children:[t.jsx(K,{label:"Bank",error:j.bank_id,required:!0,children:t.jsx(te,{value:{id:s.bank_id,code:(r=s.bank)==null?void 0:r.code,name:(l=s.bank)==null?void 0:l.name},onChange:c=>{u({...s,bank_id:c.id,bank:c})}})}),t.jsx(K,{label:"Nomor Rekening",error:j.account_number,required:!0,children:t.jsx(R,{type:"text",value:s.account_number,onChange:c=>{u("account_number",c.target.value)}})}),t.jsx(K,{label:"Nama Rekening",error:j.account_name,required:!0,children:t.jsx(R,{type:"text",value:s.account_name,onChange:c=>{u("account_name",c.target.value)}})})]})}export{xe as default};
